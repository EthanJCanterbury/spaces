{% extends "base.html" %}

{% block head %}
{{ super() }}
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
{% endblock %}

{% block content %}
<div class="club-dashboard-container">
    {% if club %}
    <!-- Sidebar Navigation -->
    <div class="club-sidebar">
        <div class="club-profile">
            <div class="profile-avatar">
                <i class="fas fa-users"></i>
            </div>
            <div class="profile-info">
                <h3>{{ club.name }}</h3>
                <span class="club-badge">{% if current_user.id == club.leader_id %}Club Leader{% else %}Member{% endif %}</span>
            </div>
        </div>

        <nav class="club-nav">
            <ul>
                <li>
                    <a href="#dashboard" class="nav-link active" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>

<style>
    /* Button styles for modals */
    .modal-footer {
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 10px;
        padding: 15px;
    }
    
    .btn-primary {
        background-color: #ec3750;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 10px 20px;
        font-weight: 500;
        cursor: pointer;
        display: inline-block;
        font-size: 14px;
        text-align: center;
        min-width: 120px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .btn-secondary {
        background-color: transparent;
        color: #333;
        border: none;
        padding: 10px 20px;
        font-weight: 500;
        cursor: pointer;
        display: inline-block;
        font-size: 14px;
        text-align: center;
    }
    
    /* System fonts only (to avoid CSP issues) */
    :root {
        --font-sans: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
        --font-mono: SFMono-Regular, Menlo, Monaco, Consolas, 'Courier New', monospace;
    }
    
    body, button, input, select, textarea {
        font-family: var(--font-sans);
    }
    
    code, pre {
        font-family: var(--font-mono);
    }
    
    /* Meeting styles */
    .meeting-item {
        background-color: #fff;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        border: 1px solid var(--border-color);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .meeting-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .meeting-item h3 {
        margin-top: 0;
        margin-bottom: 8px;
        color: var(--primary);
        font-size: 1.1rem;
    }
    
    .meeting-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-top: 8px;
        font-size: 0.9rem;
        color: var(--text-secondary);
    }
    
    .meeting-meta span {
        display: flex;
        align-items: center;
    }
    
    .meeting-meta i {
        margin-right: 5px;
        width: 16px;
        color: var(--primary);
    }
    
    .meeting-actions {
        margin-top: 12px;
        display: flex;
        gap: 8px;
    }
    
    /* Event modal styling */
    .event-detail-row {
        margin-bottom: 16px;
    }
    
    .event-detail-label {
        font-weight: 500;
        margin-right: 8px;
        display: inline-block;
        width: 100px;
        color: #555;
    }
    
    .event-detail-label i {
        width: 16px;
        margin-right: 6px;
        color: #ec3750;
    }
    
    #eventModalDescription {
        margin-top: 8px;
        line-height: 1.5;
        color: #333;
    }
</style>

                <li>
                    <a href="#stream" class="nav-link" data-section="stream">
                        <i class="fas fa-stream"></i>
                        <span>Stream</span>
                    </a>
                </li>
                <li>
                    <a href="#assignments" class="nav-link" data-section="assignments">
                        <i class="fas fa-tasks"></i>
                        <span>Assignments</span>
                    </a>
                </li>
                <li>
                    <a href="#members" class="nav-link" data-section="members">
                        <i class="fas fa-user-friends"></i>
                        <span>Members</span>
                    </a>
                </li>
                <li>
                    <a href="#projects" class="nav-link" data-section="projects">
                        <i class="fas fa-code"></i>
                        <span>Spaces Projects</span>
                    </a>
                </li>
                <li>

<script>
    let currentEventId = null;
    
    function openEventModal(eventData) {
        try {
            currentEventId = eventData.eventId;
            const titleEl = document.getElementById('eventModalTitle');
            const dateEl = document.getElementById('eventDate');
            const timeEl = document.getElementById('eventTime');
            const locationEl = document.getElementById('eventLocation');
            const descriptionEl = document.getElementById('eventDescription');
            
            if (titleEl) titleEl.textContent = eventData.eventTitle;
            if (dateEl) dateEl.textContent = new Date(eventData.eventDate).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            if (timeEl) timeEl.textContent = eventData.eventTime;
            if (locationEl) locationEl.textContent = eventData.eventLocation;
            if (descriptionEl) descriptionEl.textContent = eventData.eventDescription;
            
            openModal('eventDetailsModal');
        } catch (error) {
            console.error('Error in openEventModal:', error);
            showToast('error', 'Failed to open event details');
        }
    }
    
    function closeEventModal() {
        closeModal('eventDetailsModal');
        currentEventId = null;
    }
    function formatDate(dateStr) {
        try {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        } catch (e) {
            return dateStr;
        }
    }
</script>


                    <a href="#resources" class="nav-link" data-section="resources">
                        <i class="fas fa-link"></i>
                        <span>Resources</span>
                    </a>
                </li>
                <li>
                    <a href="#schedule" class="nav-link" data-section="schedule">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Schedule</span>
                    </a>
                </li>
                <li>
                    <a href="#rewards" class="nav-link" data-section="rewards">
                        <i class="fas fa-gift"></i>
                        <span>Rewards</span>
                    </a>
                </li>
                {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                <li>
                    <a href="#hackatime" class="nav-link" data-section="hackatime">
                        <i class="fas fa-clock"></i>
                        <span>Hackatime</span>
                    </a>
                </li>
                {% endif %}
                <li>
                    <a href="#pizza" class="nav-link" data-section="pizza">
                        <i class="fas fa-pizza-slice"></i>
                        <span>Pizza Grants</span>
                    </a>
                </li>
                {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                <li>
                    <a href="#settings" class="nav-link" data-section="settings">
                        <i class="fas fa-cogs"></i>
                        <span>Settings</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>

        <div class="club-sidebar-footer">
            <div class="sidebar-collapse-btn" id="sidebarCollapseBtn">
                <i class="fas fa-chevron-left"></i>
            </div>
            <a href="/logout" class="logout-link">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Main Content Area -->
    <div class="club-content">
        <!-- Horizontal Navbar -->
        <div class="horizontal-navbar">
            <div class="navbar-title">
                <h1><i class="fas fa-users"></i> {% if club %}{{ club.name }}{% else %}Club Dashboard{% endif %}</h1>
            </div>
            <div class="navbar-actions">
                {% if club %}
                    {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                        <button class="btn-edit" onclick="openClubSettings()">
                            <i class="fas fa-edit"></i> Edit Club
                        </button>
                        <script>
                            function openClubSettings() {
                                // Switch to the settings tab
                                const settingsTab = document.querySelector('a[href="#settings"]');
                                if (settingsTab) {
                                    settingsTab.click();
                                } else {
                                    // Fallback if tab navigation doesn't work
                                    const settingsSection = document.getElementById('settings');
                                    if (settingsSection) {
                                        // Hide all sections
                                        document.querySelectorAll('.club-section').forEach(section => {
                                            section.classList.remove('active');
                                        });
                                        // Show settings section
                                        settingsSection.classList.add('active');
                                        // Update nav links
                                        document.querySelectorAll('.nav-link').forEach(link => {
                                            link.classList.remove('active');
                                        });
                                        document.querySelector('a[href="#settings"]').classList.add('active');
                                    }
                                }
                            }
                        </script>
                        <div class="join-options" style="display: flex; gap: 10px; align-items: center;">
                            <button class="btn-join-code" onclick="generateJoinCode()">
                                <i class="fas fa-key"></i> Join Code: <span id="join-code-display">{{ club.join_code }}</span>
                            </button>
                        </div>
                    {% else %}
                        <div class="club-info">
                            <span class="join-code-display-only"><i class="fas fa-users"></i> Member since: {{ current_user.club_memberships|selectattr('club_id', 'eq', club.id)|map(attribute='joined_at')|first|default('', true)|string|truncate(10, True, '') }}</span>
                        </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>

        {% if not club %}
        <!-- Empty State -->
        <div class="club-empty-state">
            <div class="empty-icon">
                <i class="fas fa-users-slash"></i>
            </div>
            <h2>You haven't joined any clubs yet</h2>
            <p>To get started, join an existing club with a join code!</p>
            <div class="empty-actions">
                <button class="btn-secondary" onclick="openJoinClubModal()">
                    <i class="fas fa-sign-in-alt"></i> Join Club
                </button>
            </div>
            
            <script>
                function createClub() {
                    const clubName = document.getElementById('clubName').value;
                    const clubLocation = document.getElementById('clubLocation').value;
                    const clubDescription = document.getElementById('clubDescription').value;
                    
                    if (!clubName) {



                    {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                    <button class="btn-primary" onclick="showQRCodeModal()">
                        <i class="fas fa-qrcode"></i> QR Code to Join
                    </button>
                    {% endif %}


                        showToast('error', 'Please enter a club name');
                        return;
                    }
                    
                    const clubData = {
                        name: clubName,
                        location: clubLocation, 
                        description: clubDescription
                    };
                    
                    fetch('/api/clubs', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(clubData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            showToast('error', data.error);
                        } else {
                            showToast('success', 'Club created successfully!');
                            closeCreateClubModal();
                            // Redirect to the new club dashboard
                            window.location.href = `/club-dashboard/${data.club_id}`;
                        }
                    })
                    .catch(error => {
                        showToast('error', 'Failed to create club');
                        console.error('Error:', error);
                    });
                }
                
                function joinClub() {
                    const joinCode = document.getElementById('joinCode').value;
                    
                    if (!joinCode) {
                        showToast('error', 'Please enter a join code');
                        return;
                    }
                    
                    fetch('/api/clubs/join', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ join_code: joinCode })
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.error) {
                            showToast('error', data.error);
                        } else {
                            showToast('success', 'Joined club successfully!');
                            closeJoinClubModal();
                            // Redirect to the club dashboard
                            window.location.href = `/club-dashboard/${data.club_id}`;
                        }
                    })
                    .catch(error => {
                        showToast('error', 'Failed to join club');
                        console.error('Error:', error);
                    });
                }
            </script>
        </div>

        {% elif current_user.club_memberships|length > 0 and not club %}
        <!-- Member View of Clubs -->
        <div class="my-clubs-section">
            <h2>My Clubs</h2>
            <div class="clubs-grid">
                {% for membership in current_user.club_memberships %}
                <div class="club-card" onclick="viewClub({{ membership.club.id }})">
                    <div class="club-card-header">
                        <h3>{{ membership.club.name }}</h3>
                        <span class="role-badge {% if membership.role == 'co-leader' %}role-badge-leader{% endif %}">
                            {{ membership.role|capitalize }}
                        </span>
                    </div>
                    <div class="club-card-body">
                        <p>{{ membership.club.description or 'No description available' }}</p>
                        <div class="club-meta">
                            <span><i class="fas fa-map-marker-alt"></i> {{ membership.club.location or 'No location' }}</span>
                            <span><i class="fas fa-user-friends"></i> {{ membership.club.members|length }} members</span>
                        </div>
                    </div>
                    <div class="club-card-footer">
                        <button class="btn-primary">View Club</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}

        <!-- Dashboard Section -->
        <section id="dashboard" class="club-section active">
            <div class="section-header" style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <h2 style="text-align: center;"><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                <p style="text-align: center; width: 100%;">Welcome to {% if club %}{{ club.name }}{% else %}your club{% endif %}</p>
                <p class="club-subtitle" style="text-align: center; width: 100%;">Manage your hack club and empower your members with coding skills</p>
            </div>

            <div class="club-info-bar">
                <div class="club-code-box">
                    <span class="club-code-label"><i class="fas fa-key"></i> Join Code:</span>
                    <span class="club-code-value">{{ club.join_code }}</span>
                    <button class="refresh-code-btn" onclick="generateJoinCode()" title="Refresh Join Code">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                    <button class="btn-share" onclick="copyJoinLink()" title="Copy Join Link">
                        <i class="fas fa-link"></i> Copy Link
                    </button>
                    <button class="btn-qr" onclick="showQRCodeModal()" title="Show QR Code">
                        <i class="fas fa-qrcode"></i> QR Code
                    </button>
                    {% endif %}
                </div>
                
                <div class="club-balance-box">
                    <span class="club-balance-label"><i class="fas fa-dollar-sign"></i> Grant Balance:</span>
                    <span class="club-balance-value">${{ "%.2f"|format(club.balance|float) }}</span>
                </div>
            </div>
            
            <script>
                function copyJoinLink() {
                    const joinUrl = `${window.location.origin}/join-club?code={{ club.join_code }}`;
                    navigator.clipboard.writeText(joinUrl).then(() => {
                        showToast('success', 'Join link copied to clipboard!');
                    }).catch(err => {
                        console.error('Failed to copy join link:', err);
                        showToast('error', 'Failed to copy join link');
                    });
                }
                
                function showJoinQRCode() {
                    try {
                        const joinUrl = `${window.location.origin}/join-club?code={{ club.join_code }}`;
                        const qrCodeElement = document.getElementById('qrCode');
                        const joinUrlDisplay = document.getElementById('join-url-display');
                        
                        // Clear previous QR code
                        qrCodeElement.innerHTML = '';
                        
                        // Update join URL display
                        joinUrlDisplay.textContent = joinUrl;
                        
                        // Generate new QR code
                        const qr = new QRCode(qrCodeElement, {
                            text: joinUrl,
                            width: 200,
                            height: 200,
                            colorDark: '#000000',
                            colorLight: '#ffffff',
                            correctLevel: QRCode.CorrectLevel.H
                        });
                        
                        // Show the modal
                        openModal('joinQRCodeModal');
                    } catch (error) {
                        console.error('Error generating QR code:', error);
                        showToast('error', 'Failed to generate QR code');
                    }
                }
                
                function copyJoinUrl() {
                    const joinUrl = `${window.location.origin}/join-club?code={{ club.join_code }}`;
                    navigator.clipboard.writeText(joinUrl).then(() => {
                        showToast('success', 'Join link copied to clipboard!');
                    }).catch(err => {
                        console.error('Failed to copy: ', err);
                        showToast('error', 'Failed to copy join link');
                    });
                }
            </script>

            <div class="dashboard-card-grid">
                <!-- Club Members Card -->
                <div class="dashboard-feature-card">
                    <div class="card-icon member-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-header">
                            <h3>Club Members</h3>
                            <span class="card-subtitle">{% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}Manage Members{% else %}View Members{% endif %}</span>
                        </div>
                        <div class="card-metric">
                            <span class="metric-value">{{ club.members|length + 1 }}</span> total members
                        </div>
                        <p class="card-description">{% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}View and manage all your club members{% else %}View club members{% endif %}</p>
                        <div class="card-action">
                            <a href="#members" class="btn-action" onclick="openTab('members')">
                                <i class="fas fa-{% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}plus{% else %}users{% endif %}"></i> {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}Add & View Members{% else %}View Members{% endif %}
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Club Meetings Card -->
                <div class="dashboard-feature-card">
                    <div class="card-icon meeting-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-header">
                            <h3>Club Meetings</h3>
                            <span class="card-subtitle">{% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}Schedule Meetings{% else %}View Meetings{% endif %}</span>
                        </div>
                        <p class="card-description">{% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}Planning your next club meeting{% else %}View upcoming club meetings{% endif %}</p>
                        <div class="card-action">
                            <a href="#schedule" class="btn-action" onclick="openTab('schedule')">
                                <i class="fas fa-{% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}plus{% else %}calendar-alt{% endif %}"></i> {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}Schedule Meeting{% else %}View Meetings{% endif %}
                            </a>
                        </div>
                    </div>
                </div>

                {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                <!-- Club Budget Card (Leaders Only) -->
                <div class="dashboard-feature-card">
                    <div class="card-icon budget-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-header">
                            <h3>Club Budget</h3>
                            <span class="card-subtitle">Manage Finances</span>
                        </div>
                        <p class="card-description">Track your club expenses and funding</p>
                        <div class="card-action">
                            <a href="#resources" class="btn-action" onclick="openTab('resources')">
                                <i class="fas fa-eye"></i> View Resources
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Club Tasks Card -->
                <div class="dashboard-feature-card">
                    <div class="card-icon task-icon">
                        <i class="fas fa-tasks"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-header">
                            <h3>Club Tasks</h3>
                            <span class="card-subtitle">{% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}Manage Tasks{% else %}View Tasks{% endif %}</span>
                        </div>
                        <p class="card-description">{% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}Assign coding challenges to members{% else %}View assigned coding challenges{% endif %}</p>
                        <div class="card-action">
                            <a href="#assignments" class="btn-action" onclick="openTab('assignments')">
                                <i class="fas fa-{% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}plus{% else %}list-ul{% endif %}"></i> {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}Create Task{% else %}View Tasks{% endif %}
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Learning Pathways Card -->
                <div class="dashboard-feature-card">
                    <div class="card-icon pathway-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-header">
                            <h3>Learning Pathways</h3>
                            <span class="card-subtitle">Member Progress</span>
                        </div>
                        <p class="card-description">Track member coding project progress</p>
                        <div class="card-action">
                            <a href="#projects" class="btn-action" onclick="openTab('projects')">
                                <i class="fas fa-eye"></i> View Pathways
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Resources Card -->
                <div class="dashboard-feature-card">
                    <div class="card-icon resources-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="card-content">
                        <div class="card-header">
                            <h3>{% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}Leader Resources{% else %}Club Resources{% endif %}</h3>
                            <span class="card-subtitle">Hack Club Resources</span>
                        </div>
                        <p class="card-description">Access Hack Club workshops and resources</p>
                        <div class="card-action">
                            <a href="#resources" class="btn-action" onclick="openTab('resources')">
                                <i class="fas fa-link"></i> Access Resources
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-secondary-row">
                <div class="dashboard-card upcoming-meetings">
                    <div class="card-header">
                        <h3><i class="fas fa-calendar"></i> Upcoming Meetings</h3>
                        <a href="#schedule" class="card-link" onclick="openTab('schedule')">Schedule</a>
                    </div>
                    <div class="card-content" id="upcoming-meetings-mini">
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            <p>Loading upcoming meetings...</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card active-assignments">
                    <div class="card-header">
                        <h3><i class="fas fa-clipboard-list"></i> Active Assignments</h3>
                        <a href="#assignments" class="card-link" onclick="openTab('assignments')">View All</a>
                    </div>
                    <div class="card-content" id="active-assignments-mini">
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            <p>Loading active assignments...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hidden counters for dashboard stats -->
            <div style="display: none;">
                <span id="projectCount">0</span>
                <span id="assignmentCount">0</span>
            </div>

            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // Load mini dashboards when the dashboard is active
                    loadMiniDashboards();
                });

                function loadMiniDashboards() {
                    try {
                        // Load upcoming meetings mini dashboard
                        fetch(`/api/clubs/{{ club.id }}/meetings?limit=2&upcoming=true`)
                        .then(response => response.json())
                        .then(data => {
                            const container = document.getElementById('upcoming-meetings-mini');
                            if (!container) return;
                        
                        container.innerHTML = '';
                        
                        if (data.meetings && data.meetings.length > 0) {
                            data.meetings.forEach(meeting => {
                                const meetingDate = new Date(meeting.meeting_date);
                                const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                                
                                const meetingEl = document.createElement('div');
                                meetingEl.className = 'upcoming-meeting';
                                meetingEl.innerHTML = `
                                    <div class="meeting-date">
                                        <span class="date-num">${meetingDate.getDate()}</span>
                                        <span class="date-month">${monthNames[meetingDate.getMonth()]}</span>
                                    </div>
                                    <div class="meeting-details">
                                        <h4>${meeting.title}</h4>
                                        <p><i class="fas fa-clock"></i> ${meeting.start_time}${meeting.end_time ? ` - ${meeting.end_time}` : ''}</p>
                                        <p><i class="fas fa-map-marker-alt"></i> ${meeting.location || 'No location set'}</p>
                                    </div>
                                `;
                                container.appendChild(meetingEl);
                            });
                        } else {
                            container.innerHTML = '<div class="empty-state">No upcoming meetings. <a href="#schedule" onclick="openTab(\'schedule\')">Schedule one!</a></div>';
                        }
                    })
                    .catch(error => {
                        console.error('Error loading meetings:', error);
                        const container = document.getElementById('upcoming-meetings-mini');
                        if (container) {
                            container.innerHTML = '<div class="error-state">Failed to load meetings.</div>';
                        }
                    });
                    } catch (err) {
                        console.log("Error loading mini dashboards:", err);
                    }
                    
                    try {
                        // Load active assignments mini dashboard
                    fetch(`/api/clubs/{{ club.id }}/assignments?limit=2&active=true`)
                    .then(response => response.json())
                    .then(data => {
                        const container = document.getElementById('active-assignments-mini');
                        if (!container) return;
                        
                        container.innerHTML = '';
                        
                        if (data.assignments && data.assignments.length > 0) {
                            data.assignments.forEach(assignment => {
                                const assignmentEl = document.createElement('div');
                                assignmentEl.className = 'assignment-item';
                                assignmentEl.innerHTML = `
                                    <div class="assignment-status">
                                        <span class="status-badge status-active">Active</span>
                                    </div>
                                    <div class="assignment-details">
                                        <h4>${assignment.title}</h4>
                                        <p>${assignment.description.length > 80 ? assignment.description.substring(0, 80) + '...' : assignment.description}</p>
                                        <div class="assignment-meta">
                                            ${assignment.due_date ? 
                                            `<span><i class="fas fa-calendar-alt"></i> Due: ${new Date(assignment.due_date).toLocaleDateString()}</span>` : 
                                            '<span><i class="fas fa-infinity"></i> No due date</span>'}
                                        </div>
                                    </div>
                                `;
                                container.appendChild(assignmentEl);
                            });
                        } else {
                            container.innerHTML = '<div class="empty-state">No active assignments. <a href="#assignments" onclick="openTab(\'assignments\')">Create one!</a></div>';
                        }
                    })
                    .catch(error => {
                        console.error('Error loading assignments:', error);
                        const container = document.getElementById('active-assignments-mini');
                        if (container) {
                            container.innerHTML = '<div class="error-state">Failed to load assignments.</div>';
                        }
                    });
                    } catch (err) {
                        console.log("Error loading assignments dashboard:", err);
                    }
                }
            </script>

            <style>
                .club-subtitle {
                    color: #666;
                    margin-top: 0;
                    font-size: 0.9rem;
                    text-align: center;
                }
                
                .club-info-bar {
                    display: flex;
                    justify-content: space-between;
                    background-color: #f8f9fa;
                    padding: 15px;
                    border-radius: 8px;
                    margin-bottom: 24px;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                }
                
                .club-code-box {
                    display: flex;
                    align-items: center;
                }
                
                .club-balance-box {
                    display: flex;
                    align-items: center;
                    background-color: #e8f5e9;
                    padding: 8px 12px;
                    border-radius: 6px;
                    border-left: 4px solid #4caf50;
                }
                
                .club-balance-label {
                    font-weight: 500;
                    margin-right: 10px;
                    color: #2e7d32;
                }
                
                .club-balance-value {
                    background-color: #4caf50;
                    color: white;
                    padding: 4px 12px;
                    border-radius: 4px;
                    font-family: monospace;
                    font-weight: bold;
                    font-size: 16px;
                }
                
                .club-code-label {
                    font-weight: 500;
                    margin-right: 10px;
                    color: #555;
                }
                
                .club-code-value {
                    background-color: #ec3750;
                    color: white;
                    padding: 3px 10px;
                    border-radius: 4px;
                    font-family: monospace;
                    font-weight: bold;
                    letter-spacing: 1px;
                }
                
                .refresh-code-btn {
                    background: none;
                    border: none;
                    color: #666;
                    cursor: pointer;
                    padding: 5px;
                    margin-left: 10px;
                    border-radius: 50%;
                    transition: all 0.2s;
                }
                
                .refresh-code-btn:hover {
                    background-color: #eee;
                    color: #ec3750;
                }
                
                .btn-share,
                .btn-qr {
                    background-color: #ec3750;
                    color: white;
                    border: none;
                    padding: 6px 12px;
                    border-radius: 4px;
                    margin-left: 8px;
                    cursor: pointer;
                    font-size: 14px;
                    font-weight: 500;
                    display: inline-flex;
                    align-items: center;
                    gap: 5px;
                    transition: background-color 0.2s ease;
                }
                
                .btn-share:hover,
                .btn-qr:hover {
                    background-color: #d32f2f;
                }
                
                .join-url-container {
                    margin-top: 20px;
                }
                
                .join-url-box {
                    display: flex;
                    align-items: center;
                    background-color: #f5f5f5;
                    padding: 8px 12px;
                    border-radius: 4px;
                    border: 1px solid #ddd;
                    margin-top: 5px;
                }
                
                #join-url-display {
                    flex: 1;
                    word-break: break-all;
                    font-family: monospace;
                    font-size: 14px;
                }
                
                .btn-copy {
                    background: none;
                    border: none;
                    color: #666;
                    cursor: pointer;
                    padding: 5px;
                    border-radius: 50%;
                    transition: all 0.2s;
                }
                
                .btn-copy:hover {
                    background-color: #eee;
                    color: #ec3750;
                }
                
                .dashboard-card-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                    margin-bottom: 24px;
                }
                
                .dashboard-feature-card {
                    display: block;
                    background-color: white;
                    border-radius: 8px;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
                    overflow: hidden;
                    transition: transform 0.2s ease, box-shadow 0.2s ease;
                    height: 100%;
                    text-align: center;
                    padding: 20px;
                    border: 1px solid #f0f0f0;
                }
                
                .dashboard-feature-card:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
                }
                
                .dashboard-feature-card .card-icon {
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-size: 24px;
                    width: 50px;
                    height: 50px;
                    border-radius: 50%;
                    margin-bottom: 15px;
                }
                
                .dashboard-feature-card .card-content {
                    text-align: center;
                }
                
                .dashboard-feature-card .card-header {
                    margin-bottom: 10px;
                    text-align: center;
                }
                
                .dashboard-feature-card .card-header h3 {
                    margin: 0;
                    font-size: 18px;
                    color: #333;
                    font-weight: 600;
                }
                
                .dashboard-feature-card .card-subtitle {
                    font-size: 12px;
                    color: #666;
                    display: block;
                }
                
                .dashboard-feature-card .card-metric {
                    margin-bottom: 10px;
                    font-size: 14px;
                    color: #555;
                }
                
                .dashboard-feature-card .metric-value {
                    font-weight: bold;
                    font-size: 20px;
                    color: #333;
                }
                
                .dashboard-feature-card .card-description {
                    font-size: 14px;
                    color: #666;
                    margin: 5px 0 16px;
                }
                
                .dashboard-feature-card .card-action {
                    margin-top: 15px;
                    text-align: center;
                }
                
                .dashboard-feature-card .btn-action {
                    display: inline-flex;
                    align-items: center;
                    padding: 8px 16px;
                    background-color: #f8f9fa;
                    color: #ec3750;
                    border-radius: 4px;
                    text-decoration: none;
                    font-size: 14px;
                    transition: background-color 0.2s;
                    border: 1px solid #f0f0f0;
                }
                
                .dashboard-feature-card .btn-action:hover {
                    background-color: #e0e0e0;
                }
                
                .dashboard-feature-card .btn-action i {
                    margin-right: 6px;
                }
                
                .dashboard-secondary-row {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 20px;
                }
                
                .dashboard-card {
                    background-color: white;
                    border-radius: 8px;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
                    overflow: hidden;
                }
                
                .dashboard-card .card-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 16px;
                    border-bottom: 1px solid #eee;
                }
                
                .dashboard-card .card-header h3 {
                    margin: 0;
                    font-size: 16px;
                    display: flex;
                    align-items: center;
                }
                
                .dashboard-card .card-header h3 i {
                    margin-right: 8px;
                    color: #ec3750;
                }
                
                .dashboard-card .card-link {
                    font-size: 14px;
                    color: #ec3750;
                    text-decoration: none;
                }
                
                .dashboard-card .card-link:hover {
                    text-decoration: underline;
                }
                
                .dashboard-card .card-content {
                    padding: 16px;
                }
                
                .empty-state {
                    text-align: center;
                    padding: 20px;
                    color: #666;
                    font-size: 14px;
                }
                
                .error-state {
                    text-align: center;
                    padding: 20px;
                    color: #d32f2f;
                    font-size: 14px;
                }
                
                .upcoming-meeting {
                    display: flex;
                    margin-bottom: 12px;
                    padding-bottom: 12px;
                    border-bottom: 1px solid #eee;
                }
                
                .upcoming-meeting:last-child {
                    margin-bottom: 0;
                    padding-bottom: 0;
                    border-bottom: none;
                }
                
                .meeting-date {
                    flex: 0 0 50px;
                    background-color: #ec3750;
                    color: white;
                    border-radius: 6px;
                    text-align: center;
                    margin-right: 12px;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    padding: 8px 0;
                }
                
                .date-num {
                    font-size: 18px;
                    font-weight: bold;
                }
                
                .date-month {
                    font-size: 12px;
                    text-transform: uppercase;
                }
                
                .meeting-details {
                    flex: 1;
                }
                
                .meeting-details h4 {
                    margin: 0 0 5px 0;
                    font-size: 16px;
                }
                
                .meeting-details p {
                    margin: 0 0 3px 0;
                    font-size: 12px;
                    color: #666;
                }
                
                .assignment-item {
                    display: flex;
                    margin-bottom: 12px;
                    padding-bottom: 12px;
                    border-bottom: 1px solid #eee;
                }
                
                .assignment-item:last-child {
                    margin-bottom: 0;
                    padding-bottom: 0;
                    border-bottom: none;
                }
                
                .assignment-status {
                    flex: 0 0 auto;
                    margin-right: 12px;
                }
                
                .status-badge {
                    display: inline-block;
                    padding: 3px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: 600;
                }
                
                .status-pending {
                    background-color: #fff3cd;
                    color: #856404;
                }
                
                .status-completed {
                    background-color: #d4edda;
                    color: #155724;
                }
                
                .status-overdue {
                    background-color: #f8d7da;
                    color: #721c24;
                }

<style>
    /* QR Code Modal Styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        overflow: auto;
    }
    
    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 25px;
        border-radius: 8px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        position: relative;
    }
    
    .modal-header {
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #eaeaea;
    }
    
    .modal-header h2 {
        margin: 0;
        font-size: 1.5rem;
        color: #333;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .close {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        color: #aaa;
        cursor: pointer;
    }
    
    .modal-body {
        margin-bottom: 20px;
    }
    
    .modal-body p {
        color: #555;
        margin-bottom: 20px;
        line-height: 1.5;
    }
    
    #qr-code-display {
        color: #2c5282;
        background: #ebf8ff;
        padding: 2px 6px;
        border-radius: 4px;
    }
    
    .qr-code-container {
        text-align: center;
        margin: 20px 0;
    }
    
    #qrcode {
        margin: 0 auto;
        width: 200px;
        height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .join-url-container {
        margin-top: 25px;
    }
    
    .join-url-container p {
        margin: 0 0 10px 0;
        color: #555;
        font-weight: 500;
    }
    
    .join-url-box {
        display: flex;
        gap: 10px;
    }
    
    #join-url-display {
        flex: 1;
        padding: 10px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 0.9rem;
        background: #f9f9f9;
    }
    
    .btn-copy {
        padding: 10px 15px;
        background: #f0f0f0;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: background 0.2s;
    }
    
    .btn-copy:hover {
        background: #e0e0e0;
    }
    
    .info-box {
        margin-top: 20px;
        padding: 12px 15px;
        background: #f8f9fa;
        border-radius: 6px;
        border-left: 4px solid #4a90e2;
        display: flex;
        gap: 10px;
        align-items: flex-start;
    }
    
    .info-box i {
        color: #4a90e2;
        margin-top: 2px;
    }
    
    .info-box p {
        margin: 0;
        color: #2c5282;
        font-size: 0.9rem;
        line-height: 1.4;
    }
    
    .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid #eaeaea;
    }
    
    .btn-primary {
        background: #4a90e2;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        transition: background 0.2s;
    }
    
    .btn-primary:hover {
        background: #3a7bc8;
    }
    
    .btn-secondary {
        background: #f0f0f0;
        color: #333;
        border: 1px solid #ddd;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .btn-secondary:hover {
        background: #e0e0e0;
    }
</style>

<!-- QR Code Modal -->
<div id="joinQRCodeModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>
                <i class="fas fa-qrcode"></i>
                <span>Join {{ club.name }}</span>
            </h2>
            <span class="close" onclick="closeModal('joinQRCodeModal')">&times;</span>
        </div>
        
        <div class="modal-body">
            <p>
                Share this QR code with your members. They can scan it to join <strong>{{ club.name }}</strong> using the code: 
                <strong id="qr-code-display">{{ club.join_code }}</strong>
            </p>
            
            <div class="qr-code-container">
                <div id="qrcode"></div>
            </div>
            
            <div class="join-url-container">
                <p>Or share this link:</p>
                <div class="join-url-box">
                    <input type="text" id="join-url-display" readonly>
                    <button class="btn-copy" onclick="copyJoinUrl()">
                        <i class="far fa-copy"></i> Copy
                    </button>
                </div>
            </div>
            
            <div class="info-box">
                <i class="fas fa-info-circle"></i>
                <p>When members scan this code, they'll be asked to sign in or create an account to join the club.</p>
            </div>
        </div>
        
        <div class="modal-actions">
            <button class="btn-primary" onclick="downloadQRCode()">
                <i class="fas fa-download"></i> Download QR Code
            </button>
            <button class="btn-secondary" onclick="closeModal('joinQRCodeModal')">
                Close
            </button>
        </div>
    </div>
</div>

<!-- QR Code library is already included in the head section -->

<script>
    // QR Code functions
    function showQRCodeModal() {
        // Generate QR code before showing modal
        generateQRCode();
        // Use the site's common modal opening function
        openModal('joinQRCodeModal');
    }
    
    function generateQRCode() {
        const qrcodeContainer = document.getElementById('qrcode');
        const joinUrlDisplay = document.getElementById('join-url-display');
        
        if (qrcodeContainer) {
            const joinCode = '{{ club.join_code }}';
            const joinUrl = `${window.location.origin}/join-club?code=${joinCode}`;
            console.log('Generating QR code for URL:', joinUrl);
            
            // Update join URL display
            if (joinUrlDisplay) {
                joinUrlDisplay.value = joinUrl;
            }
            
            // Clear previous QR code if any
            qrcodeContainer.innerHTML = '';
            
            try {
                // Use QRCode library from head section (qrcode@1.5.1)
                QRCode.toCanvas(qrcodeContainer, joinUrl, {
                    width: 200,
                    margin: 2,
                    color: {
                        dark: '#4a90e2',
                        light: '#ffffff'
                    }
                }, function(error) {
                    if (error) {
                        console.error('Error generating QR code:', error);
                        qrcodeContainer.innerHTML = '<p>Error generating QR code. Please try again.</p>';
                    } else {
                        console.log('QR code generated successfully');
                    }
                });
            } catch (error) {
                console.error('Error with QR library:', error);
                // Fallback to a simpler method if the first one fails
                try {
                    const img = document.createElement('img');
                    img.src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(joinUrl)}`;
                    img.alt = 'Club join QR code';
                    img.style.maxWidth = '100%';
                    qrcodeContainer.appendChild(img);
                    console.log('Generated QR code using fallback method');
                } catch (fallbackError) {
                    console.error('Fallback QR generation failed:', fallbackError);
                    qrcodeContainer.innerHTML = '<p>Could not generate QR code. Please share the join link directly.</p>';
                }
            }
        }
    }
    
    function copyJoinUrl() {
        try {
            const joinCode = '{{ club.join_code }}';
            const joinUrl = `${window.location.origin}/join-club?code=${joinCode}`;
            const joinUrlDisplay = document.getElementById('join-url-display');
            
            if (joinUrlDisplay) {
                // Try the modern clipboard API first
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    navigator.clipboard.writeText(joinUrl)
                        .then(() => {
                            // Show success feedback
                            updateCopyButton(true);
                            showToast('success', 'Join link copied to clipboard!');
                        })
                        .catch(err => {
                            console.error('Could not copy text with Clipboard API:', err);
                            // Fall back to the older method
                            fallbackCopy();
                        });
                } else {
                    // Fall back to the older method for browsers without clipboard API
                    fallbackCopy();
                }
            }
            
            function fallbackCopy() {
                // Create a temporary input element
                const tempInput = document.createElement('input');
                tempInput.value = joinUrl;
                document.body.appendChild(tempInput);
                
                // Select and copy the text
                tempInput.select();
                const success = document.execCommand('copy');
                document.body.removeChild(tempInput);
                
                if (success) {
                    updateCopyButton(true);
                    showToast('success', 'Join link copied to clipboard!');
                } else {
                    updateCopyButton(false);
                    showToast('error', 'Failed to copy join link');
                }
            }
            
            function updateCopyButton(success) {
                const copyBtn = document.querySelector('.btn-copy');
                if (copyBtn) {
                    const originalText = copyBtn.innerHTML;
                    if (success) {
                        copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                        copyBtn.style.background = '#4caf50';
                        copyBtn.style.color = 'white';
                    } else {
                        copyBtn.innerHTML = '<i class="fas fa-times"></i> Failed';
                        copyBtn.style.background = '#f44336';
                        copyBtn.style.color = 'white';
                    }
                    
                    // Reset button after 2 seconds
                    setTimeout(() => {
                        copyBtn.innerHTML = originalText;
                        copyBtn.style.background = '';
                        copyBtn.style.color = '';
                    }, 2000);
                }
            }
        } catch (error) {
            console.error('Error copying join URL:', error);
            showToast('error', 'Failed to copy join link');
        }
    }
    
    function downloadQRCode() {
        try {
            const qrCodeCanvas = document.querySelector('#qrcode canvas');
            const qrCodeImg = document.querySelector('#qrcode img');
            let dataUrl;
            
            if (qrCodeCanvas) {
                // If we have a canvas element (primary method)
                dataUrl = qrCodeCanvas.toDataURL('image/png');
            } else if (qrCodeImg) {
                // If we have an img element (fallback method)
                dataUrl = qrCodeImg.src;
            } else {
                showToast('error', 'Could not find QR code to download');
                return;
            }
            
            // Create a link element to download the image
            const link = document.createElement('a');
            const clubName = '{{ club.name|lower|replace(" ", "-")|safe }}';
            link.download = `join-club-${clubName}.png`;
            link.href = dataUrl;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showToast('success', 'QR Code downloaded successfully');
        } catch (error) {
            console.error('Error downloading QR code:', error);
            showToast('error', 'Failed to download QR code');
        }
    }
</script>

<style>
                .assignment-details {
                    display: inline-block;
                    padding: 3px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: 500;
                }
                
                .status-active {
                    background-color: #e8f5e9;
                    color: #2e7d32;
                }
                
                .assignment-details {
                    flex: 1;
                }
                
                .assignment-details h4 {
                    margin: 0 0 5px 0;
                    font-size: 16px;
                }
                
                .assignment-details p {
                    margin: 0 0 8px 0;
                    font-size: 13px;
                    color: #666;
                }
                
                .assignment-meta {
                    font-size: 12px;
                    color: #888;
                }
                
                .assignment-meta span {
                    display: inline-flex;
                    align-items: center;
                }
                
                .assignment-meta i {
                    margin-right: 4px;
                }
                
                .loading-state {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    padding: 20px;
                }
                
                .loading-spinner {
                    width: 24px;
                    height: 24px;
                    border: 3px solid rgba(236, 55, 80, 0.2);
                    border-radius: 50%;
                    border-top-color: #ec3750;
                    animation: spin 1s ease-in-out infinite;
                    margin-bottom: 10px;
                }
                
                @keyframes spin {
                    to { transform: rotate(360deg); }
                }
            </style>
        </section>

        <!-- Stream Tab Content -->
        <section id="stream" class="club-section">
            <div class="section-header" style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <h2 style="text-align: center;"><i class="fas fa-stream"></i> Stream</h2>
                <p style="text-align: center; width: 100%;">Announcements and updates for club members</p>
            </div>

            <div class="stream-container">
                <div class="post-composer">
                    <div class="composer-header">
                        <h3><i class="fas fa-pen"></i> Create Announcement</h3>
                    </div>
                    <div class="composer-body">
                        <textarea id="post-content" placeholder="Share an announcement with your club..."></textarea>
                        <div class="composer-actions">
                            <button class="btn-primary" onclick="createPost()">
                                <i class="fas fa-paper-plane"></i> Post
                            </button>
                    <script>
                        function createPost() {
                            const content = document.getElementById('post-content').value;
                            if (!content) {
                                showToast('error', 'Post content cannot be empty');
                                return;
                            }
                            
                            fetch(`/api/clubs/{{ club.id }}/posts`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({ content: content })
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.error) {
                                    showToast('error', data.error);
                                } else {
                                    showToast('success', 'Post created successfully');
                                    document.getElementById('post-content').value = '';
                                    loadPosts();
                                }
                            })
                            .catch(error => {
                                showToast('error', 'Failed to create post');
                                console.error('Error:', error);
                            });
                        }
                        
                        function loadPosts() {
                            fetch(`/api/clubs/{{ club.id }}/posts`)
                            .then(response => response.json())
                            .then(data => {
                                const postsContainer = document.querySelector('.posts-list');
                                postsContainer.innerHTML = '';
                                
                                if (data.posts && data.posts.length > 0) {
                                    data.posts.forEach(post => {
                                        const postElement = createPostElement(post);
                                        postsContainer.appendChild(postElement);
                                    });
                                } else {
                                    postsContainer.innerHTML = '<div class="empty-posts">No posts yet. Be the first to create a post!</div>';
                                }
                            })
                            .catch(error => {
                                console.error('Error loading posts:', error);
                            });
                        }
                        
                        function createPostElement(post) {
                            const postCard = document.createElement('div');
                            postCard.className = 'post-card';
                            postCard.innerHTML = `
                                <div class="post-header">
                                    <img src="/static/images/logo-rounded.png" alt="Profile" class="avatar">
                                    <div class="post-info">
                                        <h3>${post.user.username}</h3>
                                        <span class="post-date">${formatDate(post.created_at)}</span>
                                    </div>
                                    <div class="post-actions">
                                        <button class="btn-icon"><i class="fas fa-ellipsis-v"></i></button>
                                    </div>
                                </div>
                                <div class="post-content">
                                    <p>${post.content}</p>
                                </div>
                                <div class="post-footer">
                                    <button class="post-action" onclick="toggleLike(${post.id})">
                                        <i class="${post.user_liked ? 'fas' : 'far'} fa-heart"></i> Like${post.likes > 0 ? ` (${post.likes})` : ''}
                                    </button>
                                </div>
                            `;
                            return postCard;
                        }
                        
                        function formatDate(dateString) {
                            const date = new Date(dateString);
                            const now = new Date();
                            const diffTime = Math.abs(now - date);
                            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                            
                            if (diffDays === 0) {
                                const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
                                if (diffHours === 0) {
                                    const diffMinutes = Math.floor(diffTime / (1000 * 60));
                                    if (diffMinutes === 0) {
                                        return 'Just now';
                                    }
                                    return `${diffMinutes} minute${diffMinutes !== 1 ? 's' : ''} ago`;
                                }
                                return `${diffHours} hour${diffHours !== 1 ? 's' : ''} ago`;
                            } else if (diffDays === 1) {
                                return 'Yesterday';
                            } else if (diffDays < 7) {
                                return `${diffDays} days ago`;
                            } else {
                                return date.toLocaleDateString();
                            }
                        }
                        
                        function toggleLike(postId) {
                            fetch(`/api/clubs/{{ club.id }}/posts/${postId}/like`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.error) {
                                    showToast('error', data.error);
                                } else {
                                    loadPosts();
                                }
                            })
                            .catch(error => {
                                showToast('error', 'Failed to process like');
                                console.error('Error:', error);
                            });
                        }
                        
                        // Load posts when the stream tab is shown
                        document.querySelector('a[data-section="stream"]').addEventListener('click', function() {
                            loadPosts();
                        });
                    </script>
                        </div>
                    </div>
                </div>

                <div class="posts-list">
                    <div class="post-card">
                        <div class="post-header">
                            <img src="{{ url_for('static', filename='images/logo-rounded.png') }}" alt="Profile" class="avatar">
                            <div class="post-info">
                                <h3>Club Leader</h3>
                                <span class="post-date">Just now</span>
                            </div>
                            <div class="post-actions">
                                <button class="btn-icon"><i class="fas fa-ellipsis-v"></i></button>
                            </div>
                        </div>
                        <div class="post-content">
                            <p>Welcome to our club! This is a sample announcement. Real announcements will appear here once you create them.</p>
                        </div>
                        <div class="post-footer">
                            <button class="post-action"><i class="far fa-heart"></i> Like</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Assignments Tab Content -->
        <section id="assignments" class="club-section">
            <div class="section-header" style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <h2 style="text-align: center;"><i class="fas fa-tasks"></i> Assignments</h2>
                <p style="text-align: center; width: 100%;">View and manage assignments for club members</p>
            </div>

            <div class="assignments-container">
                <div class="assignments-header">
                    <h3>Club Assignments</h3>
                    {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                    <button class="btn-primary" onclick="openCreateAssignmentModal()">
                        <i class="fas fa-plus"></i> New Assignment
                    </button>
                    {% endif %}
                </div>

                <div class="assignment-cards" id="assignments-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading assignments...</p>
                    </div>
                </div>
                
                <script>
                    function loadAssignments() {
                        const container = document.getElementById('assignments-container');
                        container.innerHTML = '<div class="loading-state"><div class="loading-spinner"></div><p>Loading assignments...</p></div>';
                        
                        fetch(`/api/clubs/{{ club.id }}/assignments`)
                        .then(response => response.json())
                        .then(data => {
                            container.innerHTML = '';
                            
                            if (data.assignments && data.assignments.length > 0) {
                                data.assignments.forEach(assignment => {
                                    const assignmentCard = createAssignmentCard(assignment);
                                    container.appendChild(assignmentCard);
                                });
                                
                                // Update count on dashboard safely
                                const activeAssignments = data.assignments.filter(a => a.status === 'active').length;
                                try {
                                    const assignmentCountEl = document.getElementById('assignmentCount');
                                    if (assignmentCountEl) {
                                        assignmentCountEl.textContent = activeAssignments;
                                    }
                                } catch (err) {
                                    console.log("Assignment count element not available");
                                }
                            } else {
                                container.innerHTML = '<div class="empty-state">No assignments yet. Create your first assignment!</div>';
                                const assignmentCountEl = document.getElementById('assignmentCount');
                                if (assignmentCountEl) {
                                    assignmentCountEl.textContent = '0';
                                }
                            }
                        })
                        .catch(error => {
                            container.innerHTML = '<div class="error-state">Error loading assignments. Please try again.</div>';
                            console.error('Error loading assignments:', error);
                        });
                    }
                    
                    function createAssignmentCard(assignment) {
                        const card = document.createElement('div');
                        card.className = 'assignment-card';
                        
                        const statusClass = assignment.status === 'active' ? 'status-active' : 'status-completed';
                        
                        card.innerHTML = `
                            <div class="assignment-status">
                                <span class="status-badge ${statusClass}">${assignment.status === 'active' ? 'Active' : 'Completed'}</span>
                            </div>
                            <div class="assignment-body">
                                <h3>${assignment.title}</h3>
                                <p>${assignment.description}</p>
                                <div class="assignment-meta">
                                    <span><i class="fas fa-calendar-alt"></i> Due: ${assignment.due_date ? new Date(assignment.due_date).toLocaleDateString() : 'No due date'}</span>
                                    <span><i class="fas fa-users"></i> For: ${assignment.for_all_members ? 'All members' : 'Selected members'}</span>
                                </div>
                            </div>
                            <div class="assignment-actions">
                                <button class="btn-primary btn-sm" onclick="viewAssignment(${assignment.id})"><i class="fas fa-eye"></i> View</button>
                                {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                                <button class="btn-secondary btn-sm" onclick="editAssignment(${assignment.id})"><i class="fas fa-edit"></i> Edit</button>
                                <button class="btn-danger btn-sm" onclick="deleteAssignment(${assignment.id})"><i class="fas fa-trash"></i></button>
                                {% endif %}
                            </div>
                        `;
                        
                        return card;
                    }
                    
                    function createAssignment() {
                        const title = document.getElementById('assignmentTitle').value;
                        const description = document.getElementById('assignmentDescription').value;
                        const dueDate = document.getElementById('assignmentDueDate').value;
                        const forAllMembers = document.getElementById('assignAllMembers').checked;
                        
                        if (!title || !description) {
                            showToast('error', 'Please fill out all required fields');
                            return;
                        }
                        
                        const assignmentData = {
                            title: title,
                            description: description,
                            due_date: dueDate,
                            for_all_members: forAllMembers
                        };
                        
                        fetch(`/api/clubs/{{ club.id }}/assignments`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(assignmentData)
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                showToast('error', data.error);
                            } else {
                                showToast('success', 'Assignment created successfully');
                                closeCreateAssignmentModal();
                                loadAssignments();
                            }
                        })
                        .catch(error => {
                            showToast('error', 'Failed to create assignment');
                            console.error('Error:', error);
                        });
                    }
                    
                    function viewAssignment(assignmentId) {
                        // Redirect to assignment details page or show details modal
                        showToast('info', 'View assignment functionality coming soon');
                    }
                    
                    function editAssignment(assignmentId) {
                        // Open edit assignment modal
                        showToast('info', 'Edit assignment functionality coming soon');
                    }
                    
                    function deleteAssignment(assignmentId) {
                        if (confirm('Are you sure you want to delete this assignment?')) {
                            fetch(`/api/clubs/{{ club.id }}/assignments/${assignmentId}`, {
                                method: 'DELETE'
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.error) {
                                    showToast('error', data.error);
                                } else {
                                    showToast('success', 'Assignment deleted successfully');
                                    loadAssignments();
                                }
                            })
                            .catch(error => {
                                showToast('error', 'Failed to delete assignment');
                                console.error('Error:', error);
                            });
                        }
                    }
                    
                    // Load assignments when the tab is shown
                    document.querySelector('a[data-section="assignments"]').addEventListener('click', function() {
                        loadAssignments();
                    });
                </script>
            </div>
        </section>

        <!-- Members Tab Content -->
        <section id="members" class="club-section">
            <div class="section-header" style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <h2 style="text-align: center;"><i class="fas fa-user-friends"></i> Members</h2>
                <p style="text-align: center; width: 100%;">Manage club members and their roles</p>
            </div>

            <div class="members-container">
                <div class="members-header">
                    <h3>Club Members</h3>
                    {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                    <button class="btn-primary" onclick="openAddMemberModal()">
                        <i class="fas fa-user-plus"></i> Add Member
                    </button>
                    {% endif %}
                    <script>
                        function generateJoinCode() {
                            console.log('Generating join code for club ID:', {{ club.id }});
                            // Show a loading toast
                            showToast('info', 'Generating new join code...');
                            
                            fetch(`/api/clubs/{{ club.id }}/join-code`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'X-Requested-With': 'XMLHttpRequest'
                                },
                                // Include credentials to ensure cookies are sent
                                credentials: 'same-origin'
                            })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error('Network response was not ok');
                                }
                                return response.json();
                            })
                            .then(data => {
                                if (data.error) {
                                    throw new Error(data.error);
                                }
                                
                                // Update all join code displays
                                const codeDisplays = [
                                    document.getElementById('join-code-display'),
                                    document.querySelector('.club-code-value'),
                                    document.querySelector('.code-box')
                                ];
                                
                                codeDisplays.forEach(element => {
                                    if (element) {
                                        element.textContent = data.join_code;
                                    }
                                });
                                
                                showToast('success', 'Join code regenerated successfully');
                            })
                            .catch(error => {
                                console.error('Error generating join code:', error);
                                showToast('error', `Failed to generate join code: ${error.message}`);
                            });
                        }
                        
                        function changeRole() {
                            const membershipId = document.getElementById('membershipIdForRole').value;
                            const newRole = document.querySelector('input[name="memberRole"]:checked').value;
                            
                            fetch(`/api/memberships/${membershipId}/role`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ role: newRole })
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.error) {
                                    showToast('error', data.error);
                                } else {
                                    showToast('success', 'Role updated successfully');
                                    closeChangeRoleModal();
                                    window.location.reload(); // Refresh to show updated roles
                                }
                            })
                            .catch(error => {
                                showToast('error', 'Failed to update role');
                                console.error('Error:', error);
                            });
                        }
                        
                        function openRemoveMemberModal(membershipId, username) {
                            if (confirm(`Are you sure you want to remove ${username} from the club?`)) {
                                fetch(`/api/memberships/${membershipId}/remove`, {
                                    method: 'POST'
                                })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.error) {
                                        showToast('error', data.error);
                                    } else {
                                        showToast('success', data.message || 'Member removed successfully');
                                        window.location.reload(); // Refresh to update member list
                                    }
                                })
                                .catch(error => {
                                    showToast('error', 'Failed to remove member');
                                    console.error('Error:', error);
                                });
                            }
                        }
                    </script>
                </div>

                <div class="members-table-container">
                    <table class="members-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Joined</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for membership in club.members %}
                                <tr>
                                    <td>{{ membership.user.username }}</td>
                                    <td>{{ membership.user.email }}</td>
                                    <td>
                                        <span class="role-badge {% if membership.role == 'co-leader' %}role-badge-leader{% endif %}">
                                            {{ membership.role|capitalize }}
                                        </span>
                                    </td>
                                    <td>{{ membership.joined_at.strftime('%Y-%m-%d') }}</td>
                                    <td>
                                        <div class="action-buttons">
                                            {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                                            <button class="btn-icon" onclick="openChangeRoleModal({{ membership.id }}, '{{ membership.user.username }}', '{{ membership.role }}')">
                                                <i class="fas fa-user-tag"></i>
                                            </button>
                                            <button class="btn-icon delete-action" onclick="openRemoveMemberModal({{ membership.id }}, '{{ membership.user.username }}')">
                                                <i class="fas fa-user-minus"></i>
                                            </button>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Projects Tab Content -->
        <section id="projects" class="club-section">
            <div class="section-header" style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <h2 style="text-align: center;"><i class="fas fa-code"></i> Spaces Projects</h2>
                <p style="text-align: center; width: 100%;">Browse and showcase member projects</p>
            </div>

            <div class="projects-container">
                <div class="projects-header">
                    <h3>Club Member Projects</h3>
                    <div class="projects-actions">
                        <button class="btn-secondary btn-sm" id="toggle-featured">
                            <i class="fas fa-star"></i> Show Featured Only
                        </button>
                        <div class="search-box">
                            <input type="text" id="project-search" placeholder="Search projects...">
                            <i class="fas fa-search"></i>
                        </div>
                    </div>
                </div>

                <div class="projects-grid" id="projects-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading member projects...</p>
                    </div>
                </div>
                
                <style>
                    .projects-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                        gap: 20px;
                        margin-top: 20px;
                    }
                    
                    .project-card {
                        background-color: white;
                        border-radius: 10px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
                        overflow: hidden;
                        transition: transform 0.2s ease, box-shadow 0.2s ease;
                        display: flex;
                        flex-direction: column;
                        border: 1px solid #eee;
                    }
                    
                    .project-card:hover {
                        transform: translateY(-5px);
                        box-shadow: 0 6px 12px rgba(0,0,0,0.12);
                    }
                    
                    .project-header {
                        padding: 15px;
                        border-bottom: 1px solid #f0f0f0;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    }
                    
                    .project-header h3 {
                        margin: 0;
                        font-size: 18px;
                        font-weight: 600;
                        color: #333;
                    }
                    
                    .featured-badge {
                        background-color: #fff4e6;
                        color: #ff9800;
                        font-size: 12px;
                        font-weight: 500;
                        padding: 4px 8px;
                        border-radius: 4px;
                        display: flex;
                        align-items: center;
                        gap: 4px;
                    }
                    
                    .project-body {
                        padding: 15px;
                        flex: 1;
                    }
                    
                    .project-body p {
                        margin: 0 0 15px;
                        color: #666;
                        font-size: 14px;
                    }
                    
                    .project-meta {
                        display: flex;
                        flex-wrap: wrap;
                        gap: 12px;
                        margin-bottom: 15px;
                        font-size: 13px;
                        color: #777;
                    }
                    
                    .project-meta span {
                        display: flex;
                        align-items: center;
                        gap: 6px;
                    }
                    
                    .project-meta i {
                        color: #ec3750;
                    }
                    
                    .project-actions {
                        display: flex;
                        justify-content: space-between;
                        padding: 15px;
                        border-top: 1px solid #f0f0f0;
                        background-color: #fafafa;
                    }
                    
                    .btn-sm {
                        padding: 6px 12px;
                        font-size: 13px;
                        font-weight: 500;
                    }
                    
                    .view-button {
                        display: block;
                        text-align: center;
                        background-color: #ec3750;
                        color: white;
                        text-decoration: none;
                        padding: 8px 16px;
                        border-radius: 6px;
                        font-weight: 500;
                        font-size: 14px;
                        transition: background-color 0.2s;
                    }
                    
                    .view-button:hover {
                        background-color: #d63146;
                    }
                    
                    .feature-button {
                        display: inline-flex;
                        align-items: center;
                        gap: 6px;
                        background-color: transparent;
                        border: 1px solid #ddd;
                        color: #555;
                        padding: 6px 12px;
                        border-radius: 6px;
                        font-size: 13px;
                        font-weight: 500;
                        cursor: pointer;
                        transition: background-color 0.2s;
                    }
                    
                    .feature-button:hover {
                        background-color: #f0f0f0;
                    }
                </style>
                
                <script>
                    function loadProjects() {
                        const container = document.getElementById('projects-container');
                        container.innerHTML = '<div class="loading-state"><div class="loading-spinner"></div><p>Loading member projects...</p></div>';
                        
                        const showFeaturedOnly = document.getElementById('toggle-featured').innerText.includes('Show All');
                        const searchQuery = document.getElementById('project-search').value;
                        
                        let url = `/api/clubs/{{ club.id }}/projects`;
                        if (showFeaturedOnly) {
                            url += '?featured=true';
                        }
                        if (searchQuery) {
                            url += (url.includes('?') ? '&' : '?') + `search=${encodeURIComponent(searchQuery)}`;
                        }
                        
                        fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            container.innerHTML = '';
                            
                            if (data.projects && data.projects.length > 0) {
                                data.projects.forEach(project => {
                                    const projectCard = createProjectCard(project);
                                    container.appendChild(projectCard);
                                });
                                
                                // Update count on dashboard safely
                                try {
                                    const projectCountEl = document.getElementById('projectCount');
                                    if (projectCountEl) {
                                        projectCountEl.textContent = data.projects.length;
                                    }
                                } catch (err) {
                                    console.log("Project count element not available");
                                }
                            } else {
                                container.innerHTML = '<div class="empty-state">No projects found. Members can start creating projects on their dashboard.</div>';
                                const projectCountEl = document.getElementById('projectCount');
                                if (projectCountEl) {
                                    projectCountEl.textContent = '0';
                                }
                            }
                        })
                        .catch(error => {
                            container.innerHTML = '<div class="error-state">Error loading projects. Please try again.</div>';
                            console.error('Error loading projects:', error);
                        });
                    }
                    
                    function createProjectCard(project) {
                        const card = document.createElement('div');
                        card.className = 'project-card';
                        
                        card.innerHTML = `
                            <div class="project-header">
                                <h3>${project.name}</h3>
                                ${project.featured ? '<span class="featured-badge"><i class="fas fa-star"></i> Featured</span>' : ''}
                            </div>
                            <div class="project-body">
                                <p>${project.description || 'No description available'}</p>
                                <div class="project-meta">
                                    <span><i class="fas fa-user"></i> ${project.owner.username}</span>
                                    <span><i class="fas fa-calendar-alt"></i> ${new Date(project.updated_at).toLocaleDateString()}</span>
                                </div>
                            </div>
                            <div class="project-actions">
                                <a href="/project/${project.slug}" target="_blank" class="view-button">View</a>
                                ${isClubLeaderOrCoLeader() ? 
                                  (project.featured ? 
                                    `<button class="feature-button" onclick="toggleProjectFeatured(${project.id}, false)"><i class="fas fa-star-half-alt"></i> Unfeature</button>` :
                                    `<button class="feature-button" onclick="toggleProjectFeatured(${project.id}, true)"><i class="fas fa-star"></i> Feature</button>`) : 
                                  ''
                                }
                            </div>
                        `;
                        
                        return card;
                    }
                    
                    function toggleProjectFeatured(projectId, featured) {
                        fetch(`/api/clubs/{{ club.id }}/projects/${projectId}/feature`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ featured: featured })
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                showToast('error', data.error);
                            } else {
                                showToast('success', featured ? 'Project featured successfully' : 'Project unfeatured successfully');
                                loadProjects();
                            }
                        })
                        .catch(error => {
                            showToast('error', 'Failed to update project');
                            console.error('Error:', error);
                        });
                    }
                    
                    // Search projects
                    document.getElementById('project-search').addEventListener('input', function() {
                        loadProjects();
                    });
                    
                    // Toggle featured projects
                    document.getElementById('toggle-featured').addEventListener('click', function() {
                        const button = document.getElementById('toggle-featured');
                        if (button.innerText.includes('Show Featured Only')) {
                            button.innerHTML = '<i class="fas fa-list"></i> Show All Projects';
                        } else {
                            button.innerHTML = '<i class="fas fa-star"></i> Show Featured Only';
                        }
                        loadProjects();
                    });
                    
                    // Load projects when the tab is shown
                    document.querySelector('a[data-section="projects"]').addEventListener('click', function() {
                        loadProjects();
                    });
                </script>
            </div>
        </section>



        <!-- Resources Tab Content -->
        <section id="resources" class="club-section">
            <div class="section-header" style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <h2 style="text-align: center;"><i class="fas fa-link"></i> Resources</h2>
                <p style="text-align: center; width: 100%;">Useful links and resources for club members</p>
            </div>

            <div class="resources-container">
                <div class="resources-header">
                    <h3>Quick Links & Resources</h3>
                    {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                    <button class="btn-primary" onclick="openAddResourceModal()">
                        <i class="fas fa-plus"></i> Add Resource
                    </button>
                    {% endif %}
                </div>

                <div class="resources-grid" id="resources-container">
                    <div class="loading-state">
                        <div class="loading-spinner"></div>
                        <p>Loading resources...</p>
                    </div>
                </div>
                
                <script>
                    function loadResources() {
                        const container = document.getElementById('resources-container');
                        container.innerHTML = '<div class="loading-state"><div class="loading-spinner"></div><p>Loading resources...</p></div>';
                        
                        fetch(`/api/clubs/{{ club.id }}/resources`)
                        .then(response => response.json())
                        .then(data => {
                            container.innerHTML = '';
                            
                            if (data.resources && data.resources.length > 0) {
                                data.resources.forEach(resource => {
                                    const resourceCard = createResourceCard(resource);
                                    container.appendChild(resourceCard);
                                });
                            } else {
                                container.innerHTML = '<div class="empty-state">No resources yet. Add your first resource!</div>';
                            }
                        })
                        .catch(error => {
                            container.innerHTML = '<div class="error-state">Error loading resources. Please try again.</div>';
                            console.error('Error loading resources:', error);
                        });
                    }
                    
                    function createResourceCard(resource) {
                        const card = document.createElement('div');
                        card.className = 'resource-card';
                        
                        let iconClass = 'book';
                        if (resource.icon) {
                            iconClass = resource.icon;
                        }
                        
                        card.innerHTML = `
                            <div class="resource-icon">
                                <i class="fas fa-${iconClass}"></i>
                            </div>
                            <div class="resource-content">
                                <h3>${resource.title}</h3>
                                <p>${resource.description || ''}</p>
                            </div>
                            <div class="resource-actions">
                                <a href="${resource.url}" target="_blank" class="btn-primary btn-sm">Visit</a>
                                {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                                <button class="btn-icon" onclick="deleteResource(${resource.id})"><i class="fas fa-trash"></i></button>
                                {% endif %}
                            </div>
                        `;
                        
                        return card;
                    }
                    
                    function addResource() {
                        const title = document.getElementById('resourceTitle').value;
                        const url = document.getElementById('resourceUrl').value;
                        const description = document.getElementById('resourceDescription').value;
                        const icon = document.getElementById('resourceIcon').value;
                        
                        if (!title || !url) {
                            showToast('error', 'Please fill out all required fields');
                            return;
                        }
                        
                        // Add proper URL protocol if missing
                        let formattedUrl = url;
                        if (!url.startsWith('http://') && !url.startsWith('https://')) {
                            formattedUrl = 'https://' + url;
                        }
                        
                        const resourceData = {
                            title: title,
                            url: formattedUrl,
                            description: description,
                            icon: icon
                        };
                        
                        fetch(`/api/clubs/{{ club.id }}/resources`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(resourceData)
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                showToast('error', data.error);
                            } else {
                                showToast('success', 'Resource added successfully');
                                closeAddResourceModal();
                                loadResources();
                            }
                        })
                        .catch(error => {
                            showToast('error', 'Failed to add resource');
                            console.error('Error:', error);
                        });
                    }
                    
                    function deleteResource(resourceId) {
                        if (confirm('Are you sure you want to delete this resource?')) {
                            fetch(`/api/clubs/{{ club.id }}/resources/${resourceId}`, {
                                method: 'DELETE'
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.error) {
                                    showToast('error', data.error);
                                } else {
                                    showToast('success', 'Resource deleted successfully');
                                    loadResources();
                                }
                            })
                            .catch(error => {
                                showToast('error', 'Failed to delete resource');
                                console.error('Error:', error);
                            });
                        }
                    }
                    
                    // Load resources when the tab is shown
                    document.querySelector('a[data-section="resources"]').addEventListener('click', function() {
                        loadResources();
                    });
                </script>
            </div>
        </section>

        <!-- Schedule Tab Content -->
        <section id="schedule" class="club-section">
            <div class="section-header" style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <h2 style="text-align: center;"><i class="fas fa-calendar-alt"></i> Schedule</h2>
                <p style="text-align: center; width: 100%;">View and manage club meetings and events</p>
            </div>

            <div class="schedule-container">
                <div class="schedule-header">
                    <h3>Club Meeting Schedule</h3>
                    {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                    <button class="btn-primary" onclick="openCreateMeetingModal()">
                        <i class="fas fa-plus"></i> New Meeting
                    </button>
                    {% endif %}
                </div>

                <div class="meetings-container">
                    <div class="meetings-header">
                        <h3>All Scheduled Meetings</h3>
                        <div class="filter-controls">
                            <select id="meetingFilter" class="form-select">
                                <option value="all">All Meetings</option>
                                <option value="upcoming">Upcoming</option>
                                <option value="past">Past</option>
                            </select>
                        </div>
                    </div>
                    <div id="meetings-list" class="meetings-list-container">
                        <!-- Meetings will be loaded dynamically -->
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            <p>Loading meetings...</p>
                        </div>
                    </div>
                </div>

                <div class="meetings-list">
                    <h4>Upcoming Meetings</h4>
                    <div id="upcoming-meetings">
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            <p>Loading meetings...</p>
                        </div>
                    </div>
                    
                    <script>
                        function loadMeetings() {
                            const upcomingContainer = document.getElementById('upcoming-meetings');
                            const allMeetingsContainer = document.getElementById('meetings-list');
                            
                            if (upcomingContainer) {
                                upcomingContainer.innerHTML = '<div class="loading-state"><div class="loading-spinner"></div><p>Loading meetings...</p></div>';
                            }
                            
                            if (allMeetingsContainer) {
                                allMeetingsContainer.innerHTML = '<div class="loading-state"><div class="loading-spinner"></div><p>Loading meetings...</p></div>';
                            }
                            
                            fetch(`/api/clubs/{{ club.id }}/meetings`)
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`HTTP error! Status: ${response.status}`);
                                }
                                return response.json();
                            })
                            .then(data => {
                                if (upcomingContainer) {
                                    upcomingContainer.innerHTML = '';
                                    
                                    // Filter for upcoming meetings
                                    const today = new Date();
                                    today.setHours(0, 0, 0, 0);
                                    
                                    const upcomingMeetings = data.meetings ? data.meetings.filter(meeting => {
                                        const meetingDate = new Date(meeting.meeting_date);
                                        return meetingDate >= today;
                                    }) : [];
                                    
                                    if (upcomingMeetings.length > 0) {
                                        // Sort by date (closest first)
                                        upcomingMeetings.sort((a, b) => new Date(a.meeting_date) - new Date(b.meeting_date));
                                        
                                        // Show only the next 3 meetings
                                        upcomingMeetings.slice(0, 3).forEach(meeting => {
                                            const meetingElement = createMeetingElement(meeting);
                                            upcomingContainer.appendChild(meetingElement);
                                        });
                                    } else {
                                        upcomingContainer.innerHTML = '<div class="empty-state">No upcoming meetings. Schedule your first meeting!</div>';
                                    }
                                }
                                
                                // Update the main meetings list
                                if (allMeetingsContainer) {
                                    displayMeetings(data.meetings);
                                }
                            })
                            .catch(error => {
                                if (upcomingContainer) {
                                    upcomingContainer.innerHTML = '<div class="error-state">Error loading meetings. Please try again.</div>';
                                }
                                
                                if (allMeetingsContainer) {
                                    allMeetingsContainer.innerHTML = '<div class="error-state">Error loading meetings. Please try again.</div>';
                                }
                                
                                console.error('Error loading meetings:', error);
                            });
                        }
                        
                        function createMeetingElement(meeting) {
                            const meetingDate = new Date(meeting.meeting_date);
                            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                            
                            const element = document.createElement('div');
                            element.className = 'upcoming-meeting';
                            
                            let timeDisplay = meeting.start_time;
                            if (meeting.end_time) {
                                timeDisplay += ` - ${meeting.end_time}`;
                            }
                            
                            element.innerHTML = `
                                <div class="meeting-date">
                                    <span class="date-num">${meetingDate.getDate()}</span>
                                    <span class="date-month">${monthNames[meetingDate.getMonth()]}</span>
                                </div>
                                <div class="meeting-details">
                                    <h4>${meeting.title}</h4>
                                    <p><i class="fas fa-clock"></i> ${timeDisplay}</p>
                                    <p><i class="fas fa-map-marker-alt"></i> ${meeting.location || 'No location set'}</p>
                                    ${meeting.meeting_link ? `<p><i class="fas fa-link"></i> <a href="${meeting.meeting_link}" target="_blank">Meeting Link</a></p>` : ''}
                                </div>
                                <div class="meeting-actions">
                                    <button class="btn-icon" onclick="viewMeeting(${meeting.id})"><i class="fas fa-eye"></i></button>
                                    {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                                    <button class="btn-icon" onclick="editMeeting(${meeting.id})"><i class="fas fa-edit"></i></button>
                                    <button class="btn-icon" onclick="deleteMeeting(${meeting.id})"><i class="fas fa-trash"></i></button>
                                    {% endif %}
                                </div>
                            `;
                            
                            return element;
                        }
                        
                        function displayMeetings(meetings) {
                            const meetingsContainer = document.getElementById('meetings-list');
                            if (!meetingsContainer) return;
                            
                            // Clear existing meetings
                            meetingsContainer.innerHTML = '';
                            
                            if (!meetings || meetings.length === 0) {
                                meetingsContainer.innerHTML = `
                                    <div class="meetings-list-empty">
                                        <i class="fas fa-calendar-times"></i>
                                        <p>No meetings scheduled. Create your first meeting!</p>
                                    </div>
                                `;
                                return;
                            }
                            
                            // Sort meetings by date (newest first)
                            meetings.sort((a, b) => new Date(b.meeting_date) - new Date(a.meeting_date));
                            
                            // Create meeting items
                            meetings.forEach(meeting => {
                                const meetingDate = new Date(meeting.meeting_date);
                                const formattedDate = meetingDate.toLocaleDateString('en-US', { 
                                    weekday: 'short', 
                                    month: 'short', 
                                    day: 'numeric', 
                                    year: 'numeric' 
                                });
                                
                                const meetingItem = document.createElement('div');
                                meetingItem.className = 'meeting-item';
                                meetingItem.innerHTML = `
                                    <h3>${meeting.title}</h3>
                                    <div class="meeting-meta">
                                        <span><i class="fas fa-calendar"></i> ${formattedDate}</span>
                                        <span><i class="fas fa-clock"></i> ${meeting.start_time}${meeting.end_time ? ` - ${meeting.end_time}` : ''}</span>
                                        <span><i class="fas fa-map-marker-alt"></i> ${meeting.location || 'No location set'}</span>
                                    </div>
                                    <div class="meeting-actions">
                                        <button class="btn-icon" onclick="viewMeeting(${meeting.id})"><i class="fas fa-eye"></i></button>
                                        {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                                        <button class="btn-icon" onclick="editMeeting(${meeting.id})"><i class="fas fa-edit"></i></button>
                                        <button class="btn-icon" onclick="deleteMeeting(${meeting.id})"><i class="fas fa-trash"></i></button>
                                        {% endif %}
                                    </div>
                                `;
                                
                                meetingsContainer.appendChild(meetingItem);
                            });
                        }
                        
                        function createMeeting() {
                            const title = document.getElementById('meetingTitle').value;
                            const description = document.getElementById('meetingDescription').value;
                            const date = document.getElementById('meetingDate').value;
                            const startTime = document.getElementById('startTime').value;
                            const endTime = document.getElementById('endTime').value;
                            const location = document.getElementById('meetingLocation').value;
                            const meetingLink = document.getElementById('meetingLink').value;
                            
                            if (!title || !date || !startTime) {
                                showToast('error', 'Please fill out all required fields');
                                return;
                            }
                            
                            const meetingData = {
                                title: title,
                                description: description,
                                meeting_date: date,
                                start_time: startTime,
                                end_time: endTime,
                                location: location,
                                meeting_link: meetingLink
                            };
                            
                            fetch(`/api/clubs/{{ club.id }}/meetings`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(meetingData)
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.error) {
                                    showToast('error', data.error);
                                } else {
                                    showToast('success', 'Meeting scheduled successfully');
                                    closeCreateMeetingModal();
                                    loadMeetings();
                                }
                            })
                            .catch(error => {
                                showToast('error', 'Failed to schedule meeting');
                                console.error('Error:', error);
                            });
                        }
                        
                        window.editMeeting = function(meetingId) {
                            try {
                                // Fetch the meeting details first
                                fetch(`/api/clubs/{{ club.id }}/meetings/${meetingId}`)
                                .then(response => {
                                    if (!response.ok) {
                                        if (response.status === 404) {
                                            throw new Error('Meeting not found');
                                        } else {
                                            throw new Error(`Server error: ${response.status}`);
                                        }
                                    }
                                    
                                    // Check if response is JSON
                                    const contentType = response.headers.get('content-type');
                                    if (!contentType || !contentType.includes('application/json')) {
                                        throw new Error('Invalid response format');
                                    }
                                    
                                    return response.json();
                                })
                                .then(data => {
                                    if (data.meeting) {
                                        const meeting = data.meeting;
                                        
                                        // Populate the edit meeting form with null checks
                                        const idEl = document.getElementById('editMeetingId');
                                        const titleEl = document.getElementById('editMeetingTitle');
                                        const descEl = document.getElementById('editMeetingDescription');
                                        const dateEl = document.getElementById('editMeetingDate');
                                        const startTimeEl = document.getElementById('editStartTime');
                                        const endTimeEl = document.getElementById('editEndTime');
                                        const locationEl = document.getElementById('editMeetingLocation');
                                        const linkEl = document.getElementById('editMeetingLink');
                                        
                                        if (idEl) idEl.value = meeting.id;
                                        if (titleEl) titleEl.value = meeting.title;
                                        if (descEl) descEl.value = meeting.description || '';
                                        if (dateEl) dateEl.value = meeting.meeting_date;
                                        if (startTimeEl) startTimeEl.value = meeting.start_time;
                                        if (endTimeEl) endTimeEl.value = meeting.end_time || '';
                                        if (locationEl) locationEl.value = meeting.location || '';
                                        if (linkEl) linkEl.value = meeting.meeting_link || '';
                                        
                                        // Open the edit meeting modal
                                        openModal('editMeetingModal');
                                    } else {
                                        showToast('error', 'Meeting not found');
                                    }
                                })
                                .catch(error => {
                                    showToast('error', 'Error loading meeting details');
                                    console.error('Error:', error);
                                });
                            } catch (error) {
                                console.error('Error in editMeeting:', error);
                                showToast('error', 'Failed to edit meeting');
                            }
                        };
                        
                        window.updateMeeting = function() {
                            try {
                                // Get form elements with null checks
                                const idEl = document.getElementById('editMeetingId');
                                const titleEl = document.getElementById('editMeetingTitle');
                                const descEl = document.getElementById('editMeetingDescription');
                                const dateEl = document.getElementById('editMeetingDate');
                                const startTimeEl = document.getElementById('editStartTime');
                                const endTimeEl = document.getElementById('editEndTime');
                                const locationEl = document.getElementById('editMeetingLocation');
                                const linkEl = document.getElementById('editMeetingLink');
                                
                                // Check if elements exist
                                if (!idEl || !titleEl || !dateEl || !startTimeEl) {
                                    showToast('error', 'Form elements not found. Please try again later.');
                                    return;
                                }
                                
                                const meetingId = idEl.value;
                                const title = titleEl.value;
                                const description = descEl ? descEl.value : '';
                                const date = dateEl.value;
                                const startTime = startTimeEl.value;
                                const endTime = endTimeEl ? endTimeEl.value : '';
                                const location = locationEl ? locationEl.value : '';
                                const meetingLink = linkEl ? linkEl.value : '';
                                
                                if (!title || !date || !startTime) {
                                    showToast('error', 'Please fill out all required fields');
                                    return;
                                }
                            } catch (error) {
                                console.error('Error in updateMeeting:', error);
                                showToast('error', 'An error occurred while updating the meeting');
                                return;
                            }
                            
                            const meetingData = {
                                title: title,
                                description: description,
                                meeting_date: date,
                                start_time: startTime,
                                end_time: endTime,
                                location: location,
                                meeting_link: meetingLink
                            };
                            
                            fetch(`/api/clubs/{{ club.id }}/meetings/${meetingId}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(meetingData)
                            })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`HTTP error! Status: ${response.status}`);
                                }
                                return response.json();
                            })
                            .then(data => {
                                if (data.error) {
                                    showToast('error', data.error);
                                } else {
                                    showToast('success', 'Meeting updated successfully');
                                    closeModal('editMeetingModal');
                                    loadMeetings(); // Reload meetings to show the updated data
                                }
                            })
                            .catch(error => {
                                showToast('error', 'Failed to update meeting');
                                console.error('Error:', error);
                            });
                        };
                        
                        function deleteMeeting(meetingId) {
                            if (confirm('Are you sure you want to delete this meeting?')) {
                                fetch(`/api/clubs/{{ club.id }}/meetings/${meetingId}`, {
                                    method: 'DELETE'
                                })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.error) {
                                        showToast('error', data.error);
                                    } else {
                                        showToast('success', 'Meeting deleted successfully');
                                        loadMeetings();
                                    }
                                })
                                .catch(error => {
                                    showToast('error', 'Failed to delete meeting');
                                    console.error('Error:', error);
                                });
                            }
                        }
                        
                        // Load meetings when the schedule tab is shown
                        document.querySelector('a[data-section="schedule"]').addEventListener('click', function() {
                            loadMeetings();
                        });
                    </script>
                </div>
            </div>
        </section>

        <!-- Rewards Tab Content -->
        <section id="rewards" class="club-section">
            <div class="section-header" style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <h2 style="text-align: center;"><i class="fas fa-gift"></i> Rewards</h2>
                <p style="text-align: center; width: 100%;">Claim rewards for club activities and achievements</p>
            </div>

            <div class="rewards-container">
                <div class="rewards-header">
                    <h3>Hack Club Workshops & YSWSs </h3>
                    <p>Complete projects and workshops to earn awesome rewards!</p>
                </div>

                <div class="rewards-grid">
                    <div class="reward-card">
                        <div class="reward-icon">
                            <i class="fas fa-mug-hot"></i>
                        </div>
                        <div class="reward-content">
                            <h3>Boba Workshop</h3>
                            <p>Build a website and get boba drinks for your club meeting!</p>
                            <div class="reward-meta">
                                <span><i class="fas fa-users"></i> For club workshop</span>
                            </div>
                        </div>
                        <div class="reward-actions">
                            <a href="https://forms.hackclub.com/t/5r7VGppu9wus" target="_blank" class="btn-primary">
                                Run Workshop
                            </a>
                        </div>
                    </div>

                    <div class="reward-card">
                        <div class="reward-icon">
                            <i class="fas fa-ice-cream"></i>
                        </div>
                        <div class="reward-content">
                            <h3>Swirl Workshop</h3>
                            <p>Make a website together and get ice cream for your club!</p>
                            <div class="reward-meta">
                                <span><i class="fas fa-users"></i> For club workshop</span>
                            </div>
                        </div>
                        <div class="reward-actions">
                            <a href="https://forms.hackclub.com/t/8JgE9XsQanus" target="_blank" class="btn-primary">
                                Run Workshop
                            </a>
                        </div>
                    </div>
                </div>

                <div class="rewards-guide">
                    <h4>How to claim rewards:</h4>
                    <ol>
                        <li>Complete the required project or workshop with your club</li>
                        <li>Click the corresponding "Claim Reward" or "Run Workshop" button</li>
                        <li>Fill out the form with your project details</li>
                        <li>Wait for Hack Club to process your request</li>
                    </ol>
                    <div class="info-box">
                        <i class="fas fa-info-circle"></i>
                        <p>All rewards are provided by Hack Club and subject to their terms and availability.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Hackatime Tab Content -->
        <section id="hackatime" class="club-section">
            <div class="section-header" style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <h2 style="text-align: center;"><i class="fas fa-clock"></i> Hackatime</h2>
                <p style="text-align: center; width: 100%;">View club members' coding activity and projects</p>
            </div>

            <div class="hackatime-container">
                <div class="hackatime-header">
                    <h3>Club Coding Stats</h3>
                    <div class="hackatime-actions">
                        <a href="https://hackatime.hackclub.com/" target="_blank" class="btn-secondary">
                            <i class="fas fa-external-link-alt"></i> Hackatime Dashboard
                        </a>
                    </div>
                </div>

                <!-- Members with Hackatime section -->
                <div class="hackatime-members-wrapper">
                    <div class="hackatime-panel-header">
                        <h3>Members with Hackatime</h3>
                        <p>Click on a member to view their coding projects</p>
                        <p class="info-note"><i class="fas fa-info-circle"></i> Only members with Hackatime connected will appear here. Ask your members to visit the Integrations page to connect their account.</p>
                    </div>
                    
                    <div class="hackatime-members" id="hackatime-members-list">
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            <p>Loading members with Hackatime...</p>
                        </div>
                    </div>
                </div>

                <!-- Member's projects section (shown when a member is selected) -->
                <div class="hackatime-projects-wrapper" id="hackatime-projects-wrapper" style="display: none;">
                    <div class="hackatime-panel-header">
                        <div class="panel-header-left">
                            <h3 id="hackatime-projects-title">Projects</h3>
                            <button class="btn-back" onclick="hideProjectsPanel()">
                                <i class="fas fa-arrow-left"></i> Back to Members
                            </button>
                        </div>
                        <div class="panel-header-right">
                            <div class="search-box">
                                <input type="text" id="project-search-input" placeholder="Search projects...">
                            </div>
                        </div>
                    </div>
                    
                    <div class="hackatime-member-stats" id="hackatime-member-stats">
                        <!-- Stats will be loaded here -->
                    </div>
                    
                    <div class="hackatime-projects" id="hackatime-projects-list">
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            <p>Loading projects...</p>
                        </div>
                    </div>
                </div>

                <!-- Empty state for when no members have Hackatime -->
                <div class="hackatime-empty-state" id="hackatime-empty-state" style="display: none;">
                    <div class="empty-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h3>No Hackatime Data Available</h3>
                    <p>None of your club members have connected their Hackatime accounts yet.</p>
                    <p>Only members with Hackatime connected will appear here. Please tell your members to visit the <strong>Integrations</strong> page to connect their Hackatime account.</p>
                    <a href="https://hackatime.hackclub.com/" target="_blank" class="btn-primary">
                        Learn About Hackatime
                    </a>
                </div>
            </div>

            <style>
                .hackatime-container {
                    background-color: white;
                    border-radius: 10px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    overflow: hidden;
                    margin-bottom: 20px;
                }
                
                .hackatime-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 20px;
                    border-bottom: 1px solid #eee;
                }
                
                .hackatime-actions {
                    display: flex;
                    gap: 10px;
                }
                
                .hackatime-members-wrapper, 
                .hackatime-projects-wrapper {
                    padding: 20px;
                }
                
                .hackatime-panel-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    margin-bottom: 15px;
                }
                
                .panel-header-left {
                    display: flex;
                    align-items: center;
                    gap: 15px;
                }
                
                .btn-back {
                    background: none;
                    border: none;
                    color: #ec3750;
                    cursor: pointer;
                    font-size: 14px;
                    display: flex;
                    align-items: center;
                    gap: 5px;
                }
                
                .hackatime-members {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                    gap: 15px;
                    margin-top: 15px;
                }
                
                .member-card {
                    background-color: #f8f9fa;
                    border-radius: 8px;
                    padding: 15px;
                    cursor: pointer;
                    transition: transform 0.2s ease, box-shadow 0.2s ease;
                    display: flex;
                    flex-direction: column;
                    border: 1px solid #eee;
                }
                
                .member-card:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                }
                
                .member-header {
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    margin-bottom: 10px;
                }
                
                .member-avatar {
                    width: 40px;
                    height: 40px;
                    border-radius: 50%;
                    background-color: #ec3750;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-size: 18px;
                }
                
                .member-info h4 {
                    margin: 0;
                    font-size: 16px;
                }
                
                .member-role {
                    font-size: 12px;
                    color: #666;
                }
                
                .member-stats {
                    margin-top: 10px;
                }
                
                .stats-row {
                    display: flex;
                    justify-content: space-between;
                    font-size: 13px;
                    margin-bottom: 5px;
                }
                
                .stats-label {
                    color: #666;
                }
                
                .stats-value {
                    font-weight: 500;
                }
                
                .language-tag {
                    display: inline-block;
                    background-color: #e9ecef;
                    padding: 3px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    margin-top: 5px;
                }
                
                .hackatime-member-stats {
                    background-color: #f8f9fa;
                    border-radius: 8px;
                    padding: 15px;
                    margin-bottom: 20px;
                    display: flex;
                    flex-wrap: wrap;
                    gap: 20px;
                }
                
                .stat-box {
                    flex: 1;
                    min-width: 150px;
                    padding: 15px;
                    background-color: white;
                    border-radius: 6px;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
                    text-align: center;
                }
                
                .stat-value {
                    font-size: 24px;
                    font-weight: 700;
                    color: #ec3750;
                    margin-bottom: 5px;
                }
                
                .stat-label {
                    font-size: 14px;
                    color: #666;
                }
                
                .search-box {
                    position: relative;
                    width: 250px;
                }
                
                .search-box input {
                    width: 100%;
                    padding: 8px 12px 8px 35px;
                    border-radius: 20px;
                    border: 1px solid #ddd;
                    font-size: 14px;
                }
                
                .search-box i {
                    position: absolute;
                    left: 12px;
                    top: 50%;
                    transform: translateY(-50%);
                    color: #999;
                }
                
                .hackatime-projects {
                    display: grid;
                    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                    gap: 15px;
                }
                
                .project-card {
                    background-color: white;
                    border-radius: 8px;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
                    overflow: hidden;
                    border: 1px solid #eee;
                    transition: transform 0.2s ease, box-shadow 0.2s ease;
                }
                
                .project-card:hover {
                    transform: translateY(-3px);
                    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                }
                
                .project-header {
                    padding: 15px;
                    border-bottom: 1px solid #f0f0f0;
                    background-color: #f8f9fa;
                }
                
                .project-header h4 {
                    margin: 0;
                    font-size: 16px;
                    color: #333;
                }
                
                .project-body {
                    padding: 15px;
                }
                
                .project-stats {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 10px;
                    margin-bottom: 10px;
                }
                
                .project-stat {
                    flex: 1;
                    min-width: 100px;
                    padding: 8px;
                    background-color: #f8f9fa;
                    border-radius: 4px;
                    text-align: center;
                }
                
                .project-stat-value {
                    font-weight: 500;
                    font-size: 14px;
                }
                
                .project-stat-label {
                    font-size: 12px;
                    color: #666;
                }
                
                .hackatime-empty-state {
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    padding: 40px 20px;
                    text-align: center;
                }
                
                .empty-icon {
                    font-size: 40px;
                    color: #ec3750;
                    opacity: 0.6;
                    margin-bottom: 20px;
                }
                
                .hackatime-empty-state h3 {
                    margin-top: 0;
                }
                
                .hackatime-empty-state p {
                    color: #666;
                    margin-bottom: 20px;
                }
                
                .language-chart {
                    height: 200px;
                    margin-top: 20px;
                }
            </style>

            <script>
                let selectedMemberId = null;
                let currentHackatimeMembers = [];
                
                // Load Hackatime members when tab is active
                document.querySelector('a[data-section="hackatime"]').addEventListener('click', function() {
                    loadHackatimeMembers();
                });
                
                function loadHackatimeMembers() {
                    const membersContainer = document.getElementById('hackatime-members-list');
                    const emptyState = document.getElementById('hackatime-empty-state');
                    
                    membersContainer.innerHTML = '<div class="loading-state"><div class="loading-spinner"></div><p>Loading members with Hackatime...</p></div>';
                    
                    fetch(`/api/hackatime/club/{{ club.id }}/members`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                throw new Error(data.error);
                            }
                            
                            currentHackatimeMembers = data.members || [];
                            
                            if (currentHackatimeMembers.length === 0) {
                                document.querySelector('.hackatime-members-wrapper').style.display = 'none';
                                emptyState.style.display = 'flex';
                                return;
                            }
                            
                            document.querySelector('.hackatime-members-wrapper').style.display = 'block';
                            emptyState.style.display = 'none';
                            
                            membersContainer.innerHTML = '';
                            
                            currentHackatimeMembers.forEach(member => {
                                const memberCard = createMemberCard(member);
                                membersContainer.appendChild(memberCard);
                            });
                        })
                        .catch(error => {
                            console.error('Error loading Hackatime members:', error);
                            membersContainer.innerHTML = `<div class="error-state">Error loading members: ${error.message}</div>`;
                        });
                }
                
                function createMemberCard(member) {
                    const card = document.createElement('div');
                    card.className = 'member-card';
                    card.onclick = () => showMemberProjects(member.id, member.username);
                    
                    // Get first letter of username for avatar
                    const firstLetter = member.username.charAt(0).toUpperCase();
                    
                    // Create avatar element (use member.avatar if available)
                    let avatarHtml;
                    if (member.avatar) {
                        avatarHtml = `<img src="${member.avatar}" alt="${member.username}" class="member-avatar">`;
                    } else {
                        avatarHtml = `<div class="member-avatar">${firstLetter}</div>`;
                    }
                    
                    card.innerHTML = `
                        <div class="member-header">
                            ${avatarHtml}
                            <div class="member-info">
                                <h4>${member.username}</h4>
                                <div class="member-role">${member.role}</div>
                            </div>
                        </div>
                        <div class="member-stats">
                            <div class="stats-row">
                                <span class="stats-label">Total coding time:</span>
                                <span class="stats-value">${member.stats.human_readable_total || '0 hrs'}</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">Daily average:</span>
                                <span class="stats-value">${member.stats.human_readable_daily_average || '0 mins'}</span>
                            </div>
                            ${member.stats.top_language ? 
                              `<div class="language-tag"><i class="fas fa-code"></i> ${member.stats.top_language}</div>` : 
                              ''}
                        </div>
                    `;
                    
                    return card;
                }
                
                function showMemberProjects(userId, username) {
                    selectedMemberId = userId;
                    
                    // Show projects panel - safely access DOM elements
                    const membersWrapper = document.getElementById('hackatime-members-wrapper');
                    const projectsWrapper = document.getElementById('hackatime-projects-wrapper');
                    const projectsTitle = document.getElementById('hackatime-projects-title');
                    const searchInput = document.getElementById('project-search-input');
                    
                    if (membersWrapper) membersWrapper.style.display = 'none';
                    if (projectsWrapper) projectsWrapper.style.display = 'block';
                    
                    // Update title
                    if (projectsTitle) projectsTitle.textContent = `${username}'s Projects`;
                    
                    // Clear search
                    if (searchInput) searchInput.value = '';
                    
                    // Load projects
                    loadMemberProjects();
                }
                
                function hideProjectsPanel() {
                    document.getElementById('hackatime-members-wrapper').style.display = 'block';
                    document.getElementById('hackatime-projects-wrapper').style.display = 'none';
                    selectedMemberId = null;
                }
                
                function loadMemberProjects(searchQuery = '') {
                    if (!selectedMemberId) return;
                    
                    const projectsContainer = document.getElementById('hackatime-projects-list');
                    const statsContainer = document.getElementById('hackatime-member-stats');
                    
                    projectsContainer.innerHTML = '<div class="loading-state"><div class="loading-spinner"></div><p>Loading projects...</p></div>';
                    statsContainer.innerHTML = '<div class="loading-state"><div class="loading-spinner"></div><p>Loading stats...</p></div>';
                    
                    let url = `/api/hackatime/user/${selectedMemberId}/projects`;
                    if (searchQuery) {
                        url += `?q=${encodeURIComponent(searchQuery)}`;
                    }
                    
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                throw new Error(data.error);
                            }
                            
                            // Render stats summary
                            statsContainer.innerHTML = '';
                            
                            const statBoxes = [
                                {
                                    label: 'Total Time',
                                    value: data.human_readable_total || '0 hrs'
                                },
                                {
                                    label: 'Daily Average',
                                    value: data.human_readable_daily_average || '0 mins'
                                },
                                {
                                    label: 'Projects',
                                    value: (data.projects || []).length
                                }
                            ];
                            
                            statBoxes.forEach(stat => {
                                const box = document.createElement('div');
                                box.className = 'stat-box';
                                box.innerHTML = `
                                    <div class="stat-value">${stat.value}</div>
                                    <div class="stat-label">${stat.label}</div>
                                `;
                                statsContainer.appendChild(box);
                            });
                            
                            // Add languages chart if available
                            if (data.languages && data.languages.length > 0) {
                                const languagesBox = document.createElement('div');
                                languagesBox.className = 'stat-box';
                                languagesBox.style.flex = '2';
                                languagesBox.style.minWidth = '300px';
                                
                                let languagesHtml = '<div class="stat-label">Top Languages</div><div class="language-list">';
                                
                                data.languages.slice(0, 5).forEach(lang => {
                                    const percent = Math.round(lang.percent) + '%';
                                    languagesHtml += `
                                        <div class="language-item">
                                            <span>${lang.name}</span>
                                            <div class="language-bar">
                                                <div class="language-progress" style="width: ${percent}; background-color: ${getRandomColor(lang.name)}"></div>
                                            </div>
                                            <span>${percent}</span>
                                        </div>
                                    `;
                                });
                                
                                languagesHtml += '</div>';
                                languagesBox.innerHTML = languagesHtml;
                                statsContainer.appendChild(languagesBox);
                            }
                            
                            // Render projects
                            projectsContainer.innerHTML = '';
                            
                            if (!data.projects || data.projects.length === 0) {
                                projectsContainer.innerHTML = '<div class="empty-state">No projects found.</div>';
                                return;
                            }
                            
                            data.projects.forEach(project => {
                                const projectCard = createProjectCard(project);
                                projectsContainer.appendChild(projectCard);
                            });
                        })
                        .catch(error => {
                            console.error('Error loading projects:', error);
                            projectsContainer.innerHTML = `<div class="error-state">Error loading projects: ${error.message}</div>`;
                            statsContainer.innerHTML = `<div class="error-state">Error loading stats: ${error.message}</div>`;
                        });
                }
                
                function createProjectCard(project) {
                    const card = document.createElement('div');
                    card.className = 'project-card';
                    
                    const totalHours = project.total_seconds ? (project.total_seconds / 3600).toFixed(1) : '0';
                    
                    card.innerHTML = `
                        <div class="project-header">
                            <h4>${project.name}</h4>
                        </div>
                        <div class="project-body">
                            <div class="project-stats">
                                <div class="project-stat">
                                    <div class="project-stat-value">${totalHours} hrs</div>
                                    <div class="project-stat-label">Total Time</div>
                                </div>
                                <div class="project-stat">
                                    <div class="project-stat-value">${project.text || '0'}</div>
                                    <div class="project-stat-label">Text</div>
                                </div>
                            </div>
                            <div class="project-dates">
                                <div class="date-row">
                                    <span class="date-label">Last activity:</span>
                                    <span class="date-value">${formatDate(project.modified_at) || 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    return card;
                }
                
                // Helper: Format date
                function formatDate(timestamp) {
                    if (!timestamp) return '';
                    const date = new Date(timestamp * 1000);
                    return date.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                }
                
                // Helper: Generate color from string
                function getRandomColor(str) {
                    let hash = 0;
                    for (let i = 0; i < str.length; i++) {
                        hash = str.charCodeAt(i) + ((hash << 5) - hash);
                    }
                    
                    const hue = Math.abs(hash % 360);
                    return `hsl(${hue}, 70%, 60%)`;
                }
                
                // Set up project search
                document.getElementById('project-search-input').addEventListener('input', function(e) {
                    const searchQuery = e.target.value.trim();
                    loadMemberProjects(searchQuery);
                });
                
                // Add CSS for language bars
                const styleElement = document.createElement('style');
                styleElement.textContent = `
                    .language-list {
                        margin-top: 10px;
                    }
                    .language-item {
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        margin-bottom: 6px;
                        font-size: 12px;
                    }
                    .language-bar {
                        height: 8px;
                        width: 100px;
                        background-color: #eee;
                        border-radius: 4px;
                        overflow: hidden;
                        margin: 0 8px;
                    }
                    .language-progress {
                        height: 100%;
                        border-radius: 4px;
                    }
                    .date-row {
                        font-size: 13px;
                        margin-top: 10px;
                        color: #666;
                    }
                    .date-label {
                        font-weight: 500;
                        margin-right: 5px;
                    }
                    .info-note {
                        background-color: rgba(var(--primary-rgb), 0.05);
                        border-radius: 6px;
                        padding: 8px 12px;
                        font-size: 13px;
                        color: #666;
                        margin-top: 10px;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                    }
                    .info-note i {
                        color: var(--primary);
                    }
                `;
                document.head.appendChild(styleElement);
            </script>
        </section>


                <script>
                    

                </script>








            </script>
        </section>

        <!-- Pizza Grants Tab Content -->
        <section id="pizza" class="club-section">
            <div class="section-header" style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <h2 style="text-align: center;"><i class="fas fa-pizza-slice"></i> Pizza Grants</h2>
                <p style="text-align: center; width: 100%;">Submit your coding projects for pizza grants</p>
            </div>

            <div class="pizza-container">
                <div class="pizza-logo-container">
                    <img src="{{ url_for('static', filename='images/pizza.png') }}" alt="Pizza Grants" class="pizza-logo">
                </div>
                <div class="pizza-card">
                    <div class="card-header">
                        <h3><i class="fas fa-info-circle"></i> Pizza Grants Info</h3>
                    </div>
                    <div class="card-content">
                        <p>Hack Club offers pizza grants for projects completed during club meetings:</p>
                        <ul class="pizza-info-list">
                            <li><i class="fas fa-dollar-sign"></i> <strong>$5 per person</strong> who ships a 1-hour project</li>
                            <li><i class="fas fa-dollar-sign"></i><i class="fas fa-dollar-sign"></i> <strong>$10 per person</strong> who ships a 2+ hour project</li>
                        </ul>
                        <div class="info-box">
                            <i class="fas fa-lightbulb"></i>
                            <p>Projects must be tracked on Hackatime and be at least 1 hour long to qualify for grants. Make sure to connect your Hackatime account in your profile settings.</p>
                        </div>
                    </div>
                </div>

                <div class="pizza-form-card">
                    <div class="card-header">
                        <h3><i class="fas fa-file-alt"></i> Submit Project for Grant</h3>
                    </div>
                    <div class="card-content">
                        <div id="pizza-grant-form">
                            {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
                            <div class="form-group">
                                <label for="member-select">Select Club Member <span class="required">*</span></label>
                                <select id="member-select" class="form-input" required>
                                    <option value="{{ current_user.id }}" data-username="{{ current_user.username }}">{{ current_user.username }} (You)</option>
                                    {% for membership in club.members %}
                                    <option value="{{ membership.user.id }}" data-username="{{ membership.user.username }}">{{ membership.user.username }}</option>
                                    {% endfor %}
                                </select>
                                <div class="hint">Club leaders can submit grants on behalf of members</div>
                            </div>
                            {% endif %}
                            
                            <div class="form-group">
                                <label for="project-select">Select Your Project <span class="required">*</span></label>
                                <select id="project-select" class="form-input" required>
                                    <option value="" disabled selected>Loading your projects...</option>
                                </select>
                                <div class="hint">Only projects tracked on Hackatime are shown here</div>
                            </div>
                            
                            <div class="form-group">
                                <label for="project-description">Project Description <span class="required">*</span></label>
                                <textarea id="project-description" class="form-textarea" rows="3" placeholder="Briefly describe what you built and what you learned" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="project-url">Github URL <span class="required">*</span></label>
                                <input type="url" id="project-url" class="form-input" placeholder="https://github.com/username/repository" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="live-url">Live URL <span class="required">*</span></label>
                                <input type="url" id="live-url" class="form-input" placeholder="https://example.com" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="screenshot-upload">Upload Screenshot <span class="required">*</span></label>
                                <div class="screenshot-upload-container">
                                    <input type="file" id="screenshot-upload" class="screenshot-input" accept="image/*">
                                    <div class="screenshot-preview" id="screenshot-preview">
                                        <p>No image selected</p>
                                    </div>
                                    <div id="upload-status" style="margin-top: 10px; display: none;">
                                        <div class="loading-spinner" style="display: inline-block; margin-right: 8px;"></div>
                                        <span>Uploading to CDN...</span>
                                    </div>
                                </div>
                                <input type="hidden" id="screenshot" class="form-input">
                                <div class="hint">Upload a screenshot of your project. The image will be uploaded to our database and the URL will be used for submission.</div>
                            </div>
</old_str>
<new_str>

                            <div class="form-group">
                                <label for="who-are-you">What did you learn about while making this project? <span class="required">*</span></label>
                                <textarea id="who-are-you" class="form-textarea" rows="2" placeholder="Share what you learned while making your project!" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="doing-well">What are we doing well? <span class="required">*</span></label>
                                <textarea id="doing-well" class="form-textarea" rows="2" placeholder="What do you like about Hack Club Spaces?" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="improve">How can we improve? <span class="required">*</span></label>
                                <textarea id="improve" class="form-textarea" rows="2" placeholder="How can we make Hack Club Spaces better?" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="firstName">First Name <span class="required">*</span></label>
                                <input type="text" id="firstName" class="form-input" placeholder="Your first name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="lastName">Last Name <span class="required">*</span></label>
                                <input type="text" id="lastName" class="form-input" placeholder="Your last name" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="email">Email <span class="required">*</span></label>
                                <input type="email" id="email" class="form-input" placeholder="Your email address" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="birthday">Birthday <span class="required">*</span></label>
                                <input type="date" id="birthday" class="form-input" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="address1">Address Line 1 <span class="required">*</span></label>
                                <input type="text" id="address1" class="form-input" placeholder="Street address" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="address2">Address Line 2</label>
                                <input type="text" id="address2" class="form-input" placeholder="Apt, Suite, Building (optional)">
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group half">
                                    <label for="city">City <span class="required">*</span></label>
                                    <input type="text" id="city" class="form-input" required>
                                </div>
                                
                                <div class="form-group half">
                                    <label for="state">State/Province <span class="required">*</span></label>
                                    <input type="text" id="state" class="form-input" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group half">
                                    <label for="zip">ZIP/Postal Code <span class="required">*</span></label>
                                    <input type="text" id="zip" class="form-input" required>
                                </div>
                                
                                <div class="form-group half">
                                    <label for="country">Country <span class="required">*</span></label>
                                    <input type="text" id="country" class="form-input" required>
                                </div>
                            </div>
                            
                            <div class="form-group" id="project-details" style="display: none;">
                                <div class="info-card">
                                    <h4>Project Details</h4>
                                    <div class="project-info-row">
                                        <span class="info-label">Total Time:</span>
                                        <span id="project-time" class="info-value">0 hrs</span>
                                    </div>
                                    <div class="project-info-row">
                                        <span class="info-label">Grant Amount:</span>
                                        <span id="grant-amount" class="info-value">$0</span>
                                    </div>
                                </div>
                            </div>
                            
                            <button type="button" class="btn-primary" id="submit-project-btn">
                                <i class="fas fa-paper-plane"></i> Submit Project
                            </button>
                        </div>
                        
                        <div id="pizza-no-hackatime" style="display: none;">
                            <div class="empty-state">
                                <i class="fas fa-exclamation-circle"></i>
                                <h4>Hackatime Not Connected</h4>
                                <p>You need to connect your Hackatime account to submit projects for pizza grants.</p>
                                <a href="/hackatime" class="btn-primary">
                                    <i class="fas fa-link"></i> Connect Hackatime
                                </a>
                            </div>
                        </div>
                        
                        <div id="pizza-success" style="display: none;">
                            <div class="success-state">
                                <i class="fas fa-check-circle"></i>
                                <h4>Project Submitted!</h4>
                                <p>Your project has been submitted for a pizza grant. Your submission is pending review and you will be updated via email.</p>
                                <button type="button" class="btn-secondary" id="submit-another-btn">
                                    <i class="fas fa-plus"></i> Submit Another Project
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <style>
                .pizza-container {
                    display: flex;
                    flex-direction: column;
                    gap: 20px;
                }
                
                .pizza-logo-container {
                    display: flex;
                    justify-content: center;
                    margin-bottom: 15px;
                }
                
                .pizza-logo {
                    max-width: 200px;
                    height: auto;
                    filter: drop-shadow(0px 4px 6px rgba(0,0,0,0.2));
                }
                
                .screenshot-upload-container {
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                }
                
                .screenshot-input {
                    padding: 10px;
                    border: 1px dashed var(--border-color);
                    border-radius: 8px;
                    background-color: #f8f9fa;
                }
                
                .screenshot-preview {
                    min-height: 150px;
                    border: 1px solid var(--border-color);
                    border-radius: 8px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    overflow: hidden;
                    background-color: #f8f9fa;
                }
                
                .screenshot-preview p {
                    color: #777;
                    font-style: italic;
                }
                
                .preview-image {
                    max-width: 100%;
                    max-height: 300px;
                    object-fit: contain;
                }
                
                .pizza-card,
                .pizza-form-card,
                .pizza-history-card {
                    background-color: white;
                    border-radius: 10px;
                    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
                    overflow: hidden;
                    border: 1px solid #eee;
                }
                
                .pizza-info-list {
                    padding-left: 20px;
                    margin: 15px 0;
                }
                
                .pizza-info-list li {
                    margin-bottom: 10px;
                }
                
                .info-box {
                    background-color: rgba(var(--primary-rgb), 0.05);
                    border-radius: 8px;
                    padding: 15px;
                    display: flex;
                    align-items: flex-start;
                    gap: 12px;
                    margin-top: 15px;
                }
                
                .info-box i {
                    color: var(--primary);
                    font-size: 20px;
                    margin-top: 2px;
                }
                
                .empty-state,
                .success-state {
                    text-align: center;
                    padding: 30px 20px;
                }
                
                .empty-state i,
                .success-state i {
                    font-size: 40px;
                    margin-bottom: 15px;
                }
                
                .empty-state i {
                    color: #f39c12;
                }
                
                .success-state i {
                    color: #2ecc71;
                }
                
                .empty-state h4,
                .success-state h4 {
                    margin: 0 0 10px;
                    font-size: 18px;
                }
                
                .empty-state p,
                .success-state p {
                    margin: 0 0 20px;
                    color: #666;
                }
                
                .project-info-row {
                    display: flex;
                    justify-content: space-between;
                    padding: 10px 0;
                    border-bottom: 1px solid #eee;
                }
                
                .project-info-row:last-child {
                    border-bottom: none;
                }
                
                .info-label {
                    font-weight: 500;
                    color: #555;
                }
                
                .info-value {
                    font-weight: 600;
                }
                
                .info-card {
                    background-color: #f8f9fa;
                    border-radius: 8px;
                    padding: 15px;
                    margin-top: 15px;
                }
                
                .info-card h4 {
                    margin: 0 0 10px;
                    font-size: 16px;
                    font-weight: 600;
                }
                
                .submission-item {
                    background-color: #f8f9fa;
                    border-radius: 8px;
                    padding: 15px;
                    margin-bottom: 15px;
                }
                
                .submission-item:last-child {
                    margin-bottom: 0;
                }
                
                .submission-header {
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 10px;
                }
                
                .submission-title {
                    font-weight: 600;
                    font-size: 16px;
                    margin: 0;
                }
                
                .submission-date {
                    font-size: 13px;
                    color: #777;
                }
                
                .submission-status {
                    display: inline-block;
                    padding: 3px 8px;
                    border-radius: 4px;
                    font-size: 12px;
                    font-weight: 500;
                    margin-bottom: 10px;
                }
                
                .status-pending {
                    background-color: #fff3cd;
                    color: #856404;
                }
                
                .status-approved {
                    background-color: #d4edda;
                    color: #155724;
                }
                
                .status-rejected {
                    background-color: #f8d7da;
                    color: #721c24;
                }
                
                .submission-details {
                    font-size: 14px;
                    color: #555;
                }
                
                .submission-amount {
                    font-weight: 600;
                    color: #2ecc71;
                }
            </style>

            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    // Load projects and submissions when the tab is shown
                    document.querySelector('a[data-section="pizza"]').addEventListener('click', function() {
                        loadPizzaTab();
                    });
                    
                    // Setup form submission
                    document.getElementById('submit-project-btn').addEventListener('click', submitPizzaGrant);
                    
                    // Setup submit another button
                    document.getElementById('submit-another-btn').addEventListener('click', resetPizzaForm);
                    
                    // Setup project selection change
                    document.getElementById('project-select').addEventListener('change', updateProjectDetails);
                    
                    // Setup member selection change if exists
                    const memberSelect = document.getElementById('member-select');
                    if (memberSelect) {
                        memberSelect.addEventListener('change', function() {
                            loadUserProjects(this.value);
                        });
                    }
                });
                
                function loadPizzaTab() {
                    // Check if user has Hackatime connected
                    checkHackatimeConnection();
                    
                    // Load user's projects
                    loadUserProjects();
                }
                
                function checkHackatimeConnection() {
                    // This check should be based on the current user's wakatime_api_key status
                    const hasHackatime = {% if current_user.wakatime_api_key %}true{% else %}false{% endif %};
                    
                    if (hasHackatime) {
                        document.getElementById('pizza-grant-form').style.display = 'block';
                        document.getElementById('pizza-no-hackatime').style.display = 'none';
                    } else {
                        document.getElementById('pizza-grant-form').style.display = 'none';
                        document.getElementById('pizza-no-hackatime').style.display = 'block';
                    }
                }
                
                function loadUserProjects(userId = {{ current_user.id }}) {
                    // Get selected user ID if member select exists
                    const memberSelect = document.getElementById('member-select');
                    if (memberSelect) {
                        userId = memberSelect.value;
                    }
                    
                    // Clear project selection
                    const projectSelect = document.getElementById('project-select');
                    projectSelect.innerHTML = '<option value="" disabled selected>Loading projects...</option>';
                    
                    // Use the same API as Hackatime tab
                    fetch(`/api/hackatime/user/${userId}/projects`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Clear existing options
                        projectSelect.innerHTML = '';
                        
                        // Add default option
                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.textContent = 'Select your project';
                        defaultOption.disabled = true;
                        defaultOption.selected = true;
                        projectSelect.appendChild(defaultOption);
                        
                        // Check if we have projects
                        if (data.projects && data.projects.length > 0) {
                            // Sort projects by time spent (descending)
                            data.projects.sort((a, b) => (b.total_seconds || 0) - (a.total_seconds || 0));
                            
                            // Add projects to select
                            data.projects.forEach(project => {
                                const hours = Math.round((project.total_seconds || 0) / 36) / 100; // Convert seconds to hours with 2 decimal places
                                const option = document.createElement('option');
                                option.value = project.name;
                                option.textContent = `${project.name} (${hours} hrs)`;
                                option.dataset.time = project.total_seconds || 0;
                                option.dataset.hours = hours;
                                projectSelect.appendChild(option);
                            });
                        } else {
                            // No projects found
                            const noProjectsOption = document.createElement('option');
                            noProjectsOption.value = '';
                            noProjectsOption.textContent = 'No projects found';
                            noProjectsOption.disabled = true;
                            projectSelect.appendChild(noProjectsOption);
                        }
                        
                        // Hide project details when changing projects
                        document.getElementById('project-details').style.display = 'none';
                    })
                    .catch(error => {
                        console.error('Error loading projects:', error);
                        projectSelect.innerHTML = '<option value="" disabled selected>Error loading projects</option>';
                    });
                }
                
                function updateProjectDetails() {
                    const projectSelect = document.getElementById('project-select');
                    const selectedOption = projectSelect.options[projectSelect.selectedIndex];
                    
                    if (selectedOption && selectedOption.value) {
                        // Show project details
                        document.getElementById('project-details').style.display = 'block';
                        
                        // Get project time in hours
                        const hours = parseFloat(selectedOption.dataset.hours) || 0;
                        
                        // Update project time display
                        document.getElementById('project-time').textContent = `${hours.toFixed(2)} hrs`;
                        
                        // Calculate grant amount
                        let grantAmount = 0;
                        if (hours >= 2) {
                            grantAmount = 10; // $10 for 2+ hour projects
                        } else if (hours >= 1) {
                            grantAmount = 5;  // $5 for 1-hour projects
                        }
                        
                        // Update grant amount display
                        document.getElementById('grant-amount').textContent = `$${grantAmount}`;
                        
                        // Add grant amount class
                        if (grantAmount > 0) {
                            document.getElementById('grant-amount').classList.add('eligible');
                        } else {
                            document.getElementById('grant-amount').classList.remove('eligible');
                        }
                    } else {
                        // Hide project details if no project selected
                        document.getElementById('project-details').style.display = 'none';
                    }
                }
                
                function submitPizzaGrant() {
                    // Get form values
                    const projectSelect = document.getElementById('project-select');
                    const projectDescription = document.getElementById('project-description');
                    const githubUrl = document.getElementById('project-url');
                    const liveUrl = document.getElementById('live-url');
                    const whoAreYou = document.getElementById('who-are-you');
                    const email = document.getElementById('email');
                    const firstName = document.getElementById('firstName');
                    const lastName = document.getElementById('lastName');
                    const birthday = document.getElementById('birthday');
                    const address1 = document.getElementById('address1');
                    const address2 = document.getElementById('address2');
                    const city = document.getElementById('city');
                    const state = document.getElementById('state');
                    const zip = document.getElementById('zip');
                    const country = document.getElementById('country');
                    const screenshotUrl = document.getElementById('screenshot');
                    
                    // Validate form
                    if (!projectSelect.value) {
                        showToast('error', 'Please select a project');
                        return;
                    }
                    
                    // Check if we have screenshot data
                    if (!screenshotUrl.value) {
                        showToast('error', 'Please upload a screenshot of your project');
                        return;
                    }
                    
                    // Get selected project details
                    const selectedOption = projectSelect.options[projectSelect.selectedIndex];
                    const hours = parseFloat(selectedOption.dataset.hours) || 0;
                    
                    // Check if project meets minimum time requirement (1 hour)
                    if (hours < 1) {
                        showToast('error', 'Project must be at least 1 hour long to qualify for a pizza grant');
                        return;
                    }
                    
                    if (!projectDescription.value.trim()) {
                        showToast('error', 'Please enter a project description');
                        return;
                    }

                    if (!whoAreYou.value.trim()) {
                        showToast('error', 'Please enter what you learned with your project!');
                        return;
                    }

                    if (!email.value.trim()) {
                        showToast('error', 'Please enter your email');
                        return;
                    }
                    
                    if (!firstName.value.trim()) {
                        showToast('error', 'Please enter your first name');
                        return;
                    }
                    
                    if (!lastName.value.trim()) {
                        showToast('error', 'Please enter your last name');
                        return;
                    }
                    
                    if (!birthday.value.trim()) {
                        showToast('error', 'Please enter your birthday');
                        return;
                    }

                    if (!address1.value.trim() || !city.value.trim() || !state.value.trim() || !zip.value.trim() || !country.value.trim()) {
                        showToast('error', 'Please fill in all required address fields');
                        return;
                    }
                    
                    // Calculate grant amount based on the project hours
                    let grantAmount = 0;
                    if (hours >= 2) {
                        grantAmount = 10; // $10 for 2+ hour projects
                    } else if (hours >= 1) {
                        grantAmount = 5;  // $5 for 1-hour projects
                    }
                    
                    // Get user ID and username from form or default to current user
                    let userId = {{ current_user.id }};
                    let username = "{{ current_user.username }}";
                    
                    // If member select exists, use its value
                    const memberSelect = document.getElementById('member-select');
                    if (memberSelect) {
                        userId = parseInt(memberSelect.value);
                        const memberOption = memberSelect.options[memberSelect.selectedIndex];
                        username = memberOption.dataset.username;
                    }
                    
                    // Build shipping address object
                    const shippingAddress = {
                        address1: address1.value.trim(),
                        address2: address2.value.trim(),
                        city: city.value.trim(),
                        state: state.value.trim(),
                        zip: zip.value.trim(),
                        country: country.value.trim()
                    };
                    
                    // Prepare submission data
                    const submissionData = {
                        club_id: {{ club.id }},
                        user_id: userId,
                        username: username,
                        project_name: projectSelect.value,
                        project_description: projectDescription.value.trim(),
                        github_url: githubUrl.value.trim(),
                        live_url: liveUrl.value.trim(),
                        screenshot: document.getElementById('screenshot').value.trim(),
                        project_hours: hours,
                        grant_amount: grantAmount,
                        what_learned: whoAreYou.value.trim(),
                        doing_well: document.getElementById('doing-well').value.trim(),
                        improve: document.getElementById('improve').value.trim(),
                        email: email.value.trim(),
                        first_name: firstName.value.trim(),
                        last_name: lastName.value.trim(),
                        birthday: birthday.value.trim(),
                        shipping_address: shippingAddress,
                        status: "pending",
                        submitted_at: new Date().toISOString()
                    };
                    
                    // Submit the grant request
                    fetch('/api/pizza-grants/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(submissionData)
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            // Show success message
                            document.getElementById('pizza-grant-form').style.display = 'none';
                            document.getElementById('pizza-success').style.display = 'block';
                            
                            showToast('success', 'Project submitted successfully. You will be updated via email.');
                        } else {
                            showToast('error', data.message || 'Failed to submit project');
                        }
                    })
                    .catch(error => {
                        console.error('Error submitting project:', error);
                        showToast('error', 'An error occurred while submitting your project');
                    });
                }
                
                function resetPizzaForm() {
                    // Reset form
                    document.getElementById('project-select').value = '';
                    document.getElementById('project-description').value = '';
                    document.getElementById('project-url').value = '';
                    document.getElementById('project-details').style.display = 'none';
                    
                    // Reset screenshot preview
                    document.getElementById('screenshot-preview').innerHTML = '<p>No image selected</p>';
                    document.getElementById('screenshot').value = '';
                    
                    // Show form
                    document.getElementById('pizza-grant-form').style.display = 'block';
                    document.getElementById('pizza-success').style.display = 'none';
                }
                
                // Handle screenshot upload
                document.addEventListener('DOMContentLoaded', function() {
                    const screenshotUpload = document.getElementById('screenshot-upload');
                    const screenshotPreview = document.getElementById('screenshot-preview');
                    const screenshotDataField = document.getElementById('screenshot');
                    const uploadStatus = document.getElementById('upload-status');
                    
                    if (screenshotUpload) {
                        screenshotUpload.addEventListener('change', function(e) {
                            const file = e.target.files[0];
                            if (!file) {
                                screenshotPreview.innerHTML = '<p>No image selected</p>';
                                screenshotDataField.value = '';
                                return;
                            }
                            
                            // Check file type
                            if (!file.type.match('image.*')) {
                                showToast('error', 'Please select an image file');
                                screenshotPreview.innerHTML = '<p>No image selected</p>';
                                screenshotDataField.value = '';
                                return;
                            }
                            
                            // Check file size (max 2MB for free ImgBB)
                            if (file.size > 2 * 1024 * 1024) {
                                showToast('error', 'Image is too large. Maximum size is 2MB');
                                screenshotPreview.innerHTML = '<p>No image selected</p>';
                                screenshotDataField.value = '';
                                return;
                            }
                            
                            // Show preview first
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                // Display preview
                                screenshotPreview.innerHTML = '';
                                const img = document.createElement('img');
                                img.src = event.target.result;
                                img.classList.add('preview-image');
                                screenshotPreview.appendChild(img);
                                
                                // Show uploading status
                                uploadStatus.style.display = 'block';
                                
                                // Upload to ImgBB
                                uploadToImgBB(file);
                            };
                            reader.readAsDataURL(file);
                        });
                    }
                    
                    function uploadToImgBB(file) {
                        const formData = new FormData();
                        formData.append('image', file);
                        
                        // Use the ImgBB API key from the template variable
                    fetch(`https://api.imgbb.com/1/upload?key={{ imgbb_api_key }}`, {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            if (data.success) {
                                // Save the direct image URL to the hidden field
                                screenshotDataField.value = data.data.url;
                                showToast('success', 'Screenshot uploaded successfully');
                            } else {
                                throw new Error('Image upload failed');
                            }
                            uploadStatus.style.display = 'none';
                        })
                        .catch(error => {
                            console.error('Error uploading image:', error);
                            showToast('error', 'Failed to upload screenshot. Please try again.');
                            uploadStatus.style.display = 'none';
                            
                            // Fallback to data URL if upload fails
                            const reader = new FileReader();
                            reader.onload = function(event) {
                                screenshotDataField.value = event.target.result;
                                showToast('info', 'Using local image data as fallback');
                            };
                            reader.readAsDataURL(file);
                        });
                    }
                });
                
                // Submission history function removed as we no longer store submissions locally
            </script>
        </section>

        <!-- Settings Tab Content -->
        <section id="settings" class="club-section">
            <div class="section-header" style="text-align: center; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <h2 style="text-align: center;"><i class="fas fa-cogs"></i> Settings</h2>
                <p style="text-align: center; width: 100%;">Configure club settings and preferences</p>
            </div>

            <div class="settings-container">
                <h3>Club Settings</h3>

                <div class="settings-card">
                    <div class="settings-section">
                        <h4>General Information</h4>
                        <div class="form-group">
                            <label for="editClubName">Club Name <span class="required">*</span></label>
                            <input type="text" id="editClubName" name="editClubName" value="{{ club.name }}" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label for="editClubLocation">Location</label>
                            <input type="text" id="editClubLocation" name="editClubLocation" value="{{ club.location }}" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="editClubDescription">Description</label>
                            <textarea id="editClubDescription" name="editClubDescription" rows="4" class="form-textarea">{{ club.description }}</textarea>
                        </div>
                        <button type="button" class="btn-primary" id="directUpdateButton">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                        
                        <script>
                            // Add the event listener directly
                            document.getElementById('directUpdateButton').addEventListener('click', function() {
                                // Debug output to verify the function is called
                                console.log('Save button clicked!');
                                
                                // Get the form values
                                var name = document.getElementById('editClubName').value;
                                var location = document.getElementById('editClubLocation').value;
                                var description = document.getElementById('editClubDescription').value;
                                
                                // Validation
                                if (!name || name.trim() === '') {
                                    showToast('error', 'Please enter a club name');
                                    return;
                                }
                                
                                console.log('Preparing to send club update: ', {
                                    name: name,
                                    location: location,
                                    description: description
                                });
                                
                                // Show saving toast
                                showToast('info', 'Saving changes...');
                                
                                // Create a very simple direct XMLHttpRequest
                                var xhr = new XMLHttpRequest();
                                xhr.open('PUT', '/api/clubs/current', true);
                                xhr.setRequestHeader('Content-Type', 'application/json');
                                
                                // Handle response
                                xhr.onload = function() {
                                    if (xhr.status >= 200 && xhr.status < 300) {
                                        console.log('Success! Response:', xhr.responseText);
                                        showToast('success', 'Club updated successfully!');
                                        // Wait a moment for user to see toast then reload
                                        setTimeout(function() {
                                            window.location.reload();
                                        }, 1500);
                                    } else {
                                        console.error('Error:', xhr.status, xhr.statusText, xhr.responseText);
                                        showToast('error', 'Error updating club: ' + xhr.status + ' ' + xhr.statusText);
                                    }
                                };
                                
                                // Handle network errors
                                xhr.onerror = function() {
                                    console.error('Network Error');
                                    showToast('error', 'Network error while trying to update club. Please check your connection.');
                                };
                                
                                // Send the data
                                var data = JSON.stringify({
                                    name: name,
                                    location: location,
                                    description: description
                                });
                                
                                console.log('Sending data:', data);
                                xhr.send(data);
                                console.log('Request sent!');
                            });
                        </script>
                    </div>

                    <div class="settings-section danger-zone">
                        <h4>Danger Zone</h4>
                        <p>Deleting a club is permanent and will remove all members, posts, and assignments.</p>
                        <button class="btn-danger" onclick="openDeleteClubModal()">
                            <i class="fas fa-trash"></i> Delete Club
                        </button>
                        
                        <script>
                            function openDeleteClubModal() {
                                if (confirm('Are you sure you want to delete this club? This action cannot be undone.')) {
                                    console.log('Deleting club...');
                                    alert('Deleting club... Please wait.');
                                    
                                    fetch(`/api/clubs/current`, {
                                            method: 'DELETE',
                                            headers: {
                                                'Content-Type': 'application/json'
                                            }
                                        })
                                        .then(response => {
                                            if (!response.ok) {
                                                if (response.status === 403) {
                                                    throw new Error('You do not have permission to delete this club');
                                                } else if (response.status === 404) {
                                                    throw new Error('Club not found. It may have been already deleted.');
                                                } else {
                                                    throw new Error(`HTTP error! Status: ${response.status}`);
                                                }
                                            }
                                            return response.json();
                                        })
                                        .then(data => {
                                            if (data.error) {
                                                showToast('error', data.error);
                                            } else {
                                                showToast('success', 'Club deleted successfully');
                                                // Redirect to the main dashboard after a short delay
                                                setTimeout(() => {
                                                    window.location.href = '/welcome';
                                                }, 1500);
                                            }
                                        })
                                        .catch(error => {
                                            showToast('error', error.message || 'Failed to delete club');
                                            console.error('Error:', error);
                                        });
                                }
                            }
                        </script>
                    </div>
                </div>
            </div>
        </section>
        {% endif %}
    </div>
</div>

<script>
    // Global error handler
    window.addEventListener('error', function(event) {
        console.error('Caught global error:', event.error);
        // Prevent the error from showing in console
        event.preventDefault();
        
        // Custom error handling
        if (event.error && event.error.message) {
            if (event.error.message.includes('null') || 
                event.error.message.includes('undefined') ||
                event.error.message.includes('Cannot set properties')) {
                // DOM element not found errors
                console.log("DOM interaction error - element may not exist:", event.error.message);
            } else {
                // Show toast for other errors if toast function exists
                if (typeof showToast === 'function') {
                    showToast('error', 'An error occurred. Please refresh the page.');
                }
            }
        }
    });
    
    // Test function to check if modals are working
    window.testModal = function(modalId) {
        console.log('Testing modal:', modalId);
        openModal(modalId);
        
        // Log modal state
        const modal = document.getElementById(modalId);
        if (modal) {
            console.log('Modal element found:', modal);
            console.log('Modal display:', modal.style.display);
            console.log('Modal opacity:', modal.style.opacity);
            console.log('Modal visibility:', modal.style.visibility);
            console.log('Modal classList:', modal.classList);
        } else {
            console.error('Modal element not found:', modalId);
        }
    };
    
    // Function to load/reload club data
    function loadClubData() {
        console.log('Loading club data...');
        {% if club %}
        // Fetch club data from API
        fetch('/api/clubs/current', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'same-origin'
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Club data loaded:', data);
            if (!data.error && data.club) {
                // Update form fields
                const nameField = document.getElementById('editClubName');
                const locationField = document.getElementById('editClubLocation');
                const descriptionField = document.getElementById('editClubDescription');
                
                if (nameField && data.club.name) nameField.value = data.club.name;
                if (locationField) locationField.value = data.club.location || '';
                if (descriptionField) descriptionField.value = data.club.description || '';
                
                console.log('Form fields updated with fresh data');
            }
        })
        .catch(error => {
            console.error('Error loading club data:', error);
        });
        {% endif %}
    }
    
    // Initialize dashboard when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        {% if club %}
        // Initialize the main dashboard stats and data
        fetch(`/api/clubs/{{ club.id }}/stats`)
            .then(response => response.json())
            .then(data => {
                if (!data.error) {
                    const projectCountEl = document.getElementById('projectCount');
                    const assignmentCountEl = document.getElementById('assignmentCount');
                    
                    if (projectCountEl) {
                        projectCountEl.textContent = data.project_count || 0;
                    }
                    if (assignmentCountEl) {
                        assignmentCountEl.textContent = data.active_assignments || 0;
                    }
                    
                    // Update member count if needed
                    const memberCountElement = document.querySelector('.dashboard-stats .stat-info h3:first-child');
                    if (memberCountElement) {
                        memberCountElement.textContent = data.member_count || '{{ club.members|length }}';
                    }
                }
            })
            .catch(error => console.error('Error loading dashboard stats:', error));
        
        // Load data for the currently active section
        const activeSection = document.querySelector('.club-section.active');
        if (activeSection) {
            const sectionId = activeSection.id;
            
            if (sectionId === 'stream') {
                loadPosts();
            } else if (sectionId === 'assignments') {
                loadAssignments();
            } else if (sectionId === 'members') {
                // Members are loaded server-side
            } else if (sectionId === 'projects') {
                loadProjects();
            } else if (sectionId === 'resources') {
                loadResources();
            } else if (sectionId === 'schedule') {
                loadMeetings();
            }
        }
        {% endif %}
    });
</script>

<!-- Modals -->
<!-- Create Club Modal -->
<div id="createClubModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-users"></i> Create New Club</h2>
            <button class="close-btn" onclick="closeCreateClubModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="createClubForm">
                <div class="form-group">
                    <label for="clubName">Club Name <span class="required">*</span></label>
                    <input type="text" id="clubName" name="clubName" required placeholder="E.g., Hack Club Central High" class="form-input">
                </div>
                <div class="form-group">
                    <label for="clubLocation">Location</label>
                    <input type="text" id="clubLocation" name="clubLocation" placeholder="E.g., Room 203, Central High School" class="form-input">
                </div>

                <div class="form-group">
                    <label for="clubDescription">Description</label>
                    <textarea id="clubDescription" name="clubDescription" rows="4" placeholder="Tell us about your club..." class="form-textarea"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeCreateClubModal()">Cancel</button>
            <button class="btn-primary" onclick="createClub()">
                <i class="fas fa-plus"></i> Create Club
            </button>
        </div>
    </div>
</div>

<!-- Join Club Modal -->
<div id="joinClubModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-sign-in-alt"></i> Join a Club</h2>
            <button class="close-btn" onclick="closeJoinClubModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label for="joinCode">Club Join Code <span class="required">*</span></label>
                <input type="text" id="joinCode" name="joinCode" required placeholder="Enter the join code provided by your club leader" class="form-input">
            </div>
            <div class="info-box">
                <i class="fas fa-info-circle"></i>
                <p>By joining a club, you grant club leaders access to view and manage your spaces.</p>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeJoinClubModal()">Cancel</button>
            <button class="btn-primary" onclick="joinClub()">
                <i class="fas fa-sign-in-alt"></i> Join Club
            </button>
        </div>
    </div>
</div>

<!-- Edit Club Modal -->
<div id="editClubModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-edit"></i> Edit Club</h2>
            <button class="close-btn" onclick="closeEditClubModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="modalEditClubForm">
                <div class="form-group">
                    <label for="modalEditClubName">Club Name <span class="required">*</span></label>
                    <input type="text" id="modalEditClubName" name="modalEditClubName" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="modalEditClubLocation">Location</label>
                    <input type="text" id="modalEditClubLocation" name="modalEditClubLocation" class="form-input">
                </div>
                <div class="form-group">
                    <label for="modalEditClubDescription">Description</label>
                    <textarea id="modalEditClubDescription" name="modalEditClubDescription" rows="4" class="form-textarea"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeEditClubModal()">Cancel</button>
            <button class="btn-primary" onclick="updateClubFromModal()">
                <i class="fas fa-save"></i> Save Changes
            </button>
        </div>
    </div>
</div>

<!-- Add Member Modal -->
<div id="addMemberModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-user-plus"></i> Add Member</h2>
            <button class="close-btn" onclick="closeAddMemberModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="join-code-info">
                <div class="info-card">
                    <h3><i class="fas fa-key"></i> Join Code</h3>
                    <p>Share your club's join code with members and let them join on their own.</p>
                    <div class="join-code-display">
                        {% if club and club.join_code %}
                            <div class="code-box">{{ club.join_code }}</div>
                            <button class="btn-primary" onclick="copyJoinCode()">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        {% else %}
                            <button class="btn-primary" onclick="generateJoinCode()">
                                <i class="fas fa-key"></i> Generate Join Code
                            </button>
                        {% endif %}
                    </div>
                    <p><small>Members can join by entering this code on their dashboard.</small></p>
                </div>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeAddMemberModal()">Close</button>
        </div>
    </div>
</div>

<!-- Change Role Modal -->
<div id="changeRoleModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-user-tag"></i> Change Member Role</h2>
            <button class="close-btn" onclick="closeChangeRoleModal()">&times;</button>
        </div>
        <div class="modal-body">
            <p>Change role for <span id="roleUsername" class="highlighted-text"></span>:</p>
            <input type="hidden" id="membershipIdForRole">
            <div class="role-selector">
                <label class="role-option">
                    <input type="radio" name="memberRole" value="member" id="roleMember">
                    <span class="role-card">
                        <i class="fas fa-user"></i>
                        <span>Member</span>
                        <span class="role-description">Regular club member with basic privileges</span>
                    </span>
                </label>
                <label class="role-option">
                    <input type="radio" name="memberRole" value="co-leader" id="roleLeader">
                    <span class="role-card">
                        <i class="fas fa-crown"></i>
                        <span>Co-Leader</span>
                        <span class="role-description">Can manage members and club settings</span>
                    </span>
                </label>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeChangeRoleModal()">Cancel</button>
            <button class="btn-primary" onclick="changeRole()">
                <i class="fas fa-save"></i> Save Changes
            </button>
        </div>
    </div>
</div>

<!-- Create Assignment Modal -->
<div id="createAssignmentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-tasks"></i> Create Assignment</h2>
            <button class="close-btn" onclick="closeCreateAssignmentModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="createAssignmentForm">
                <div class="form-group">
                    <label for="assignmentTitle">Title <span class="required">*</span></label>
                    <input type="text" id="assignmentTitle" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="assignmentDescription">Description <span class="required">*</span></label>
                    <textarea id="assignmentDescription" rows="4" required class="form-textarea"></textarea>
                </div>
                <div class="form-group">
                    <label for="assignmentDueDate">Due Date</label>
                    <input type="date" id="assignmentDueDate" class="form-input">
                </div>
                <div class="form-group">
                    <label>Assignment For:</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="assignAllMembers" checked> All Members
                        </label>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeCreateAssignmentModal()">Cancel</button>
            <button class="btn-primary" onclick="createAssignment()">
                <i class="fas fa-plus"></i> Create Assignment
            </button>
        </div>
    </div>
</div>

<!-- Add Resource Modal -->
<div id="addResourceModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-link"></i> Add Resource</h2>
            <button class="close-btn" onclick="closeAddResourceModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="addResourceForm">
                <div class="form-group">
                    <label for="resourceTitle">Title <span class="required">*</span></label>
                    <input type="text" id="resourceTitle" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="resourceUrl">URL <span class="required">*</span></label>
                    <input type="url" id="resourceUrl" required class="form-input">
                </div>
                <div class="form-group">
                    <label for="resourceDescription">Description</label>
                    <textarea id="resourceDescription" rows="3" class="form-textarea"></textarea>
                </div>
                <div class="form-group">
                    <label for="resourceIcon">Icon</label>
                    <select id="resourceIcon" class="form-input">
                        <option value="book">Book</option>
                        <option value="link">Link</option>
                        <option value="file">File</option>
                        <option value="video">Video</option>
                        <option value="code">Code</option>
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeAddResourceModal()">Cancel</button>
            <button class="btn-primary" onclick="addResource()">
                <i class="fas fa-plus"></i> Add Resource
            </button>
        </div>
    </div>
</div>

<!-- Create Channel Modal -->
<div id="createChannelModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-hashtag"></i> Create Channel</h2>
            <button class="close-btn" onclick="closeCreateChannelModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="createChannelForm">
                <div class="form-group">
                    <label for="channelName">Channel Name <span class="required">*</span></label>
                    <input type="text" id="channelName" required placeholder="e.g. homework-help" class="form-input">
                </div>
                <div class="form-group">
                    <label for="channelDescription">Description</label>
                    <textarea id="channelDescription" placeholder="What's this channel about?" rows="3" class="form-textarea"></textarea>
                </div>
            </form>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeCreateChannelModal()">Cancel</button>
            <button class="btn-primary" onclick="createChannel()">
                <i class="fas fa-plus"></i> Create Channel
            </button>
        </div>
    </div>
</div>

<!-- Create Meeting Modal -->
<div id="createMeetingModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-calendar-plus"></i> Schedule Meeting</h2>
            <button class="close-btn" onclick="closeCreateMeetingModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="createMeetingForm">
                <div class="form-group">
                    <label for="meetingTitle">Meeting Title <span class="required">*</span></label>
                    <input type="text" id="meetingTitle" required placeholder="e.g. Weekly Check-in" class="form-input">
                </div>
                <div class="form-group">
                    <label for="meetingDescription">Description</label>
                    <textarea id="meetingDescription" placeholder="What's this meeting about?" rows="3" class="form-textarea"></textarea>
                </div>
                <div class="form-group">
                    <label for="meetingDate">Date <span class="required">*</span></label>
                    <input type="date" id="meetingDate" required class="form-input">
                </div>
                <div class="form-row">
                    <div class="form-group half">
                        <label for="startTime">Start Time <span class="required">*</span></label>
                        <input type="time" id="startTime" required class="form-input">
                    </div>
                    <div class="form-group half">
                        <label for="endTime">End Time</label>
                        <input type="time" id="endTime" class="form-input">
                    </div>
                </div>
                <div class="form-group">
                    <label for="meetingLocation">Location</label>
                    <input type="text" id="meetingLocation" placeholder="e.g. Room 203 or Virtual" class="form-input">
                </div>
                <div class="form-group">
                    <label for="meetingLink">Meeting Link</label>
                    <input type="url" id="meetingLink" placeholder="e.g. Zoom or Google Meet URL" class="form-input">
                </div>
            </form>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeCreateMeetingModal()">Cancel</button>
            <button class="btn-primary" onclick="createMeeting()">
                <i class="fas fa-plus"></i> Schedule Meeting
            </button>
        </div>
    </div>
</div>

<!-- Toast container for notifications -->
<div id="toast-container"></div>

<style>
:root {
    --primary-rgb: 237, 55, 80;
    --primary: #ec3750;
    --primary-dark: #cf142b;
    --primary-light: #ff5a69;
    --secondary: #e83e8c;
    --success: #059669;
    --warning: #d97706;
    --danger: #dc2626;
    --light: #f3f4f6;
    --dark: #1f2937;
    --text-primary: #111827;
    --text-secondary: #4b5563;
    --text-muted: #6b7280;
    --border-color: #e5e7eb;
    --card-bg: #ffffff;
    --body-bg: #f9fafb;
    --gradient-start: #ec3750;
    --gradient-end: #ff8c38;
}

/* ===== Club Dashboard Styles ===== */
.club-dashboard-container {
    display: flex;
    min-height: 100vh;
    background-color: var(--body-bg);
    color: var(--text-primary);
    transition: all 0.3s ease;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
}

/* Sidebar Styles */
.club-sidebar {
    width: 260px;
    background-color: var(--card-bg);
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    z-index: 100;
    transition: all 0.3s ease;
}

.club-profile {
    padding: 1.5rem;
    display: flex;
    align-items: center;
    border-bottom: 1px solid var(--border-color);
    margin-top: 60px;
}

.profile-avatar {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
}

.profile-avatar i {
    font-size: 24px;
    color: white;
}

.profile-info h3 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
}

.club-badge {
    background-color: var(--primary);
    color: white;
    padding: 3px 8px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
    display: inline-block;
    margin-top: 5px;
}

.club-nav {
    flex: 1;
    padding: 1.5rem 0;
    overflow-y: auto;
}

.club-nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.club-nav li {
    margin-bottom: 5px;
}

.club-nav .nav-link {
    display: flex;
    align-items: center;
    padding: 12px 1.5rem;
    color: var(--text-secondary);
    text-decoration: none;
    transition: all 0.2s ease;
    border-left: 3px solid transparent;
}

.club-nav .nav-link i {
    font-size: 18px;
    margin-right: 12px;
    width: 24px;
    text-align: center;
}

.club-nav .nav-link:hover {
    background-color: rgba(255, 255, 255, 0.05);
    color: var(--text-primary);
}

.club-nav .nav-link.active {
    background-color: rgba(var(--primary-rgb), 0.1);
    color: var(--primary);
    border-left-color: var(--primary);
}

.club-sidebar-footer {
    padding: 1rem;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.sidebar-collapse-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: rgba(var(--primary-rgb), 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.sidebar-collapse-btn:hover {
    background-color: rgba(var(--primary-rgb), 0.2);
}

.logout-link {
    color: var(--text-secondary);
    text-decoration: none;
    display: flex;
    align-items: center;
}

.logout-link i {
    margin-right: 8px;
}

.logout-link:hover {
    color: var(--danger);
}

/* Content Area */
.club-content {
    flex: 1;
    padding: 1.5rem 2rem;
    margin-left: 260px;
    transition: all 0.3s ease;
}

/* Horizontal Navbar */
.horizontal-navbar {
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    margin-top: 60px;
    border-bottom: 1px solid var(--border-color);
}

.navbar-title h1 {
    font-size: 1.75rem;
    font-weight: 700;
    margin: 0;
    color: var(--text-primary);
    display: flex;
    align-items: center;
}

.navbar-title h1 i {
    margin-right: 0.75rem;
    color: var(--primary);
}

.navbar-actions {
    display: flex;
    gap: 10px;
}

.btn-edit, .btn-join-code {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-edit {
    background-color: var(--primary);
    color: white;
}

.btn-edit:hover {
    background-color: var(--primary-dark);
}

.btn-join-code, .btn-join-link, .btn-qr-code {
    background-color: var(--light);
    color: var(--text-primary);
    border: none;
    border-radius: 8px;
    padding: 0.5rem 1rem;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-join-code:hover, .btn-join-link:hover, .btn-qr-code:hover {
    background-color: var(--border-color);
}

/* Button Styles */
.btn-primary {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-primary i {
    font-size: 14px;
}

.btn-primary:hover {
    background-color: var(--primary-dark);
}

.btn-secondary {
    background-color: var(--light);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-secondary i {
    font-size: 14px;
}

.btn-secondary:hover {
    background-color: var(--border-color);
}

.btn-danger {
    background-color: var(--danger);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-danger i {
    font-size: 14px;
}

.btn-danger:hover {
    background-color: #b91c1c;
}

.btn-sm {
    padding: 0.35rem 0.7rem;
    font-size: 12px;
}

.btn-icon {
    width: 32px;
    height: 32px;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: none;
    background-color: var(--light);
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-icon:hover {
    background-color: var(--border-color);
}

/* Section Styles */
.club-section {
    background-color: var(--card-bg);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    display: none;
    animation: fadeIn 0.3s ease;
}

.club-section.active {
    display: block;
}

.section-header {
    margin-bottom: 1.5rem;
    text-align: center;
}

.section-header h2 {
    margin-bottom: 5px;
}

.section-header p {
    margin: 0;
    color: #666;
}

/* Dashboard Stats */
.dashboard-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.stat-card {
    background-color: var(--card-bg);
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    align-items: center;
    flex: 1;
    min-width: 200px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border-color);
}

.stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
}

.stat-icon i {
    font-size: 22px;
    color: white;
}

.user-icon {
    background: linear-gradient(135deg, #3498db, #2980b9);
}

.site-icon {
    background: linear-gradient(135deg, #2ecc71, #27ae60);
}

.task-icon {
    background: linear-gradient(135deg, #9b59b6, #8e44ad);
}

.pathway-icon {
    background: linear-gradient(135deg, #4CAF50, #3e8e41);
}

.resources-icon {
    background-color: #ec3750;
}

.stat-info h3 {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0 0 5px;
}

.stat-info p {
    margin: 0;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

/* Dashboard Cards */
.dashboard-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.dashboard-row.single-col {
    grid-template-columns: 1fr;
}

.dashboard-card {
    background-color: var(--card-bg);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border-color);
}

.card-header {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-header h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
}

.card-header h3 i {
    margin-right: 0.75rem;
    color: var(--primary);
}

.card-link {
    color: var(--primary);
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 500;
}

.card-link:hover {
    text-decoration: underline;
}

.card-content {
    padding: 1.25rem;
}

/* Activity List */
.activity-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.activity-item {
    display: flex;
    align-items: flex-start;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--border-color);
}

.activity-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.activity-icon {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background-color: rgba(var(--primary-rgb), 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    flex-shrink: 0;
}

.activity-icon i {
    color: var(--primary);
    font-size: 16px;
}

.activity-details p {
    margin: 0 0 5px;
    font-weight: 500;
}

.activity-time {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

/* Upcoming Events */
.upcoming-meeting {
    display: flex;
    align-items: flex-start;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--border-color);
}

.upcoming-meeting:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.meeting-date {
    width: 50px;
    height: 50px;
    background-color: var(--primary);
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    color: white;
    flex-shrink: 0;
}

.date-num {
    font-size: 1.25rem;
    font-weight: bold;
    line-height: 1;
}

.date-month {
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
}

.meeting-details {
    flex: 1;
}

.meeting-details h4 {
    margin: 0 0 0.5rem;
    font-size: 1rem;
}

.meeting-details p {
    margin: 0 0 0.25rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
}

.meeting-details p i {
    margin-right: 0.5rem;
    width: 16px;
}

.meeting-actions {
    display: flex;
    gap: 5px;
    flex-shrink: 0;
}

/* Assignment Items */
.assignment-item {
    display: flex;
    align-items: flex-start;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--border-color);
}

.assignment-item:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.assignment-status {
    margin-right: 1rem;
    flex-shrink: 0;
}

.status-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
    display: inline-block;
}

.status-badge.status-active {
    background-color: rgba(46, 204, 113, 0.15);
    color: #2ecc71;
}

.assignment-details {
    flex: 1;
}

.assignment-details h4 {
    margin: 0 0 0.5rem;
    font-size: 1rem;
}

.assignment-details p {
    margin: 0;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.assignment-meta {
    font-size: 0.85rem;
    color: var(--text-muted);
}

.assignment-meta span {
    display: inline-flex;
    align-items: center;
    margin-right: 1rem;
}

.assignment-meta span i {
    margin-right: 0.5rem;
}

/* Stream Section */
.stream-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.post-composer {
    background-color: var(--card-bg);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border-color);
}

.composer-header {
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
}

.composer-header h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
}

.composer-header h3 i {
    margin-right: 0.75rem;
    color: var(--primary);
}

.composer-body {
    padding: 1rem;
}

.composer-body textarea {
    width: 100%;
    min-height: 100px;
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    resize: vertical;
    margin-bottom: 1rem;
}

.composer-actions {
    display: flex;
    justify-content: flex-end;
}

.post-card {
    background-color: var(--card-bg);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border-color);
}

.post-header {
    padding: 1rem;
    display: flex;
    align-items: center;
    border-bottom: 1px solid var(--border-color);
}

.post-header .avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 1rem;
}

.post-info {
    flex: 1;
}

.post-info h3 {
    margin: 0 0 0.25rem;
    font-size: 1rem;
    font-weight: 600;
}

.post-date {
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.post-content {
    padding: 1rem;
}

.post-content p {
    margin: 0;
    line-height: 1.5;
}

.post-footer {
    padding: 0.5rem 1rem;
    border-top: 1px solid var(--border-color);
    display: flex;
}

.post-action {
    background: none;
    border: none;
    color: var(--text-secondary);
    padding: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    transition: color 0.2s ease;
}

.post-action:hover {
    color: var(--primary);
}

/* Assignments Section */
.assignments-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.assignments-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.assignments-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
}

.assignment-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
}

.assignment-card {
    background-color: var(--card-bg);
    border-radius: 12px;
    padding: 1.25rem;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
}

.assignment-body {
    flex: 1;
    margin: 1rem 0;
}

.assignment-body h3 {
    margin: 0 0 0.5rem;
    font-size: 1.1rem;
    font-weight: 600;
}

.assignment-body p {
    margin: 0 0 1rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.assignment-actions {
    display: flex;
    gap: 0.5rem;
    justify-content: flex-end;
}

/* Members Section */
.members-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.members-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.members-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
}

.members-table-container {
    overflow-x: auto;
}

.members-table {
    width: 100%;
    border-collapse: collapse;
    text-align: left;
}

.members-table th {
    background-color: var(--light);
    padding: 0.75rem 1rem;
    font-weight: 600;
    color: var(--text-primary);
    border-bottom: 1px solid var(--border-color);
}

.members-table td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--border-color);
}

.members-table tr:last-child td {
    border-bottom: none;
}

.role-badge {
    background-color: var(--light);
    color: var(--text-secondary);
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
    display: inline-block;
}

.role-badge-leader {
    background-color: rgba(var(--primary-rgb), 0.15);
    color: var(--primary);
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
}

/* Projects Section */
.projects-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.projects-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
}

.projects-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
}

.projects-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.search-box {
    position: relative;
}

.search-box input {
    padding: 0.5rem 2.5rem 0.5rem 1rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    min-width: 200px;
}

.search-box i {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
}

.projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

/* Loading State */
.loading-state {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 3rem;
    text-align: center;
    color: var(--text-secondary);
    background: var(--light);
    border-radius: 8px;
    grid-column: 1 / -1;
}

.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(var(--primary-rgb), 0.2);
    border-left-color: var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 1rem;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Resources Section */
.resources-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.resources-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.resources-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
}

.dashboard-card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 15px;
    margin-bottom: 24px;
}

.resource-card {
    background-color: var(--card-bg);
    border-radius: 12px;
    padding: 1.25rem;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border-color);
    display: flex;
    align-items: flex-start;
}

.resource-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background-color: rgba(var(--primary-rgb), 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 1rem;
    flex-shrink: 0;
}

.resource-icon i {
    color: var(--primary);
    font-size: 20px;
}

.resource-content {
    flex: 1;
}

.resource-content h3 {
    margin: 0 0 0.5rem;
    font-size: 1rem;
    font-weight: 600;
}

.resource-content p {
    margin: 0;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.resource-actions {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-left: 1rem;
}

/* Schedule Section */
.schedule-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.schedule-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.schedule-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
}

.meetings-container {
    background-color: var(--card-bg);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
    border: 1px solid var(--border-color);
    margin-bottom: 1.5rem;
}

.meetings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.25rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border-color);
}

.meetings-header h3 {
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
}

.meetings-list-container {
    background-color: #fff;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    padding: 1rem;
}

.filter-controls {
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-select {
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid var(--border-color);
    background-color: #fff;
    font-size: 0.9rem;
    color: var(--text);
    cursor: pointer;
    outline: none;
    transition: border-color 0.2s ease;
}

.form-select:focus {
    border-color: var(--primary);
}

.meetings-list-empty {
    text-align: center;
    padding: 2rem;
    color: var(--text-secondary);
}

.meetings-list-empty i {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: var(--border-color);
}

.meetings-list {
    margin-top: 1.5rem;
}

.meetings-list h4 {
    margin: 0 0 1rem;
    font-size: 1.1rem;
    font-weight: 600;
}

/* Rewards Section */
.rewards-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.rewards-header {
    margin-bottom: 1rem;
}

.rewards-header h3 {
    margin: 0 0 0.5rem;
    font-size: 1.25rem;
    font-weight: 600;
}

.rewards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.reward-card {
    background-color: var(--card-bg);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
}

.reward-icon {
    width: 50px;
    height: 50px;
    border-radius: 10px;
    background-color: rgba(var(--primary-rgb), 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
}

.reward-icon i {
    color: var(--primary);
    font-size: 24px;
}

.reward-content {
    flex: 1;
}

.reward-content h3 {
    margin: 0 0 0.5rem;
    font-size: 1.1rem;
    font-weight: 600;
}

.reward-content p {
    margin: 0 0 1rem;
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.reward-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.reward-meta span {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: var(--text-muted);
}

.rewards-guide {
    background-color: var(--light);
    border-radius: 12px;
    padding: 1.25rem;
}

.rewards-guide h4 {
    margin: 0 0 1rem;
    font-size: 1.1rem;
    font-weight: 600;
}

.rewards-guide ol {
    margin: 0 0 1.5rem;
    padding-left: 1.5rem;
}

.rewards-guide li {
    margin-bottom: 0.5rem;
}

.info-box {
    background-color: rgba(var(--primary-rgb), 0.05);
    border-radius: 8px;
    padding: 1rem;
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
}

.info-box i {
    color: var(--primary);
    font-size: 18px;
    margin-top: 2px;
}

.info-box p {
    margin: 0;
    font-size: 0.9rem;
}

/* Settings Section */
.settings-container {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.settings-container h3 {
    margin: 0 0 1rem;
    font-size: 1.25rem;
    font-weight: 600;
}

.settings-card {
    background-color: var(--card-bg);
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border-color);
}

.settings-section {
    margin-bottom: 2rem;
}

.settings-section:last-child {
    margin-bottom: 0;
}

.settings-section h4 {
    margin: 0 0 1rem;
    font-size: 1.1rem;
    font-weight: 600;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border-color);
}

.form-group {
    margin-bottom: 1.25rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.form-input, 
.form-textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    font-size: 0.95rem;
}

.form-textarea {
    min-height: 120px;
    resize: vertical;
}

.danger-zone {
    background-color: rgba(220, 38, 38, 0.05);
    border-radius: 8px;
    padding: 1.25rem;
}

.danger-zone h4 {
    color: var(--danger);
    border-bottom-color: rgba(220, 38, 38, 0.2);
}

.danger-zone p {
    margin: 0 0 1rem;
    font-size: 0.95rem;
}

/* Empty State */
.club-empty-state {
    background-color: var(--card-bg);
    border-radius: 16px;
    padding: 4rem 2rem;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    text-align: center;
    margin-bottom: 2rem;
}

.empty-icon {
    font-size: 5rem;
    color: var(--text-secondary);
    margin-bottom: 2rem;
    opacity: 0.5;
}

.club-empty-state h2 {
    margin: 0 0 1rem;
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-primary);
}

.club-empty-state p {
    margin: 0 0 2rem;
    color: var(--text-secondary);
    font-size: 1.25rem;
}

.empty-actions {
    display: flex;
    justify-content: center;
    gap: 1rem;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: rgba(0, 0, 0, 0.5);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    backdrop-filter: blur(2px);
    align-items: center;
    justify-content: center;
}

.modal[style*="display: flex"],
.modal.visible {
    display: flex !important;
    opacity: 1 !important;
    visibility: visible !important;
    z-index: 9999 !important;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.modal-content {
    background-color: var(--card-bg);
    margin: auto;
    padding: 0;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    animation: slideUp 0.3s ease;
    border: 1px solid var(--border-color);
    position: relative;
    z-index: 1001;
}

@keyframes slideUp {
    from { transform: translateY(30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--border-color);
}

.modal-header h2 {
    margin: 0;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 12px;
}

.close-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-secondary);
    padding: 0;
    margin: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background-color 0.2s ease;
}

.close-btn:hover {
    background-color: var(--light);
    color: var(--text-primary);
}

.modal-body {
    padding: 2rem;
}

.modal-actions {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    padding: 1.5rem 2rem;
    border-top: 1px solid var(--border-color);
}

.required {
    color: var(--danger);
    margin-left: 3px;
}

.highlighted-text {
    color: var(--primary);
    font-weight: 600;
}

/* Role Selector */
.role-selector {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-top: 1rem;
}

.role-option {
    cursor: pointer;
}

.role-option input {
    display: none;
}

.role-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1.5rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    transition: all 0.2s ease;
}

.role-option input:checked + .role-card {
    border-color: var(--primary);
    background-color: rgba(var(--primary-rgb), 0.05);
}

.role-card i {
    font-size: 2rem;
    margin-bottom: 0.75rem;
    color: var(--text-secondary);
}

.role-option input:checked + .role-card i {
    color: var(--primary);
}

.role-card span:nth-child(2) {
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.role-description {
    font-size: 0.85rem;
    color: var(--text-secondary);
    text-align: center;
}

/* Toast Container */
#toast-container {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999;
}

/* Form Row */
.form-row {
    display: flex;
    gap: 1rem;
}

.form-group.half {
    flex: 1;
}

/* Code Box */
.code-box {
    background-color: var(--light);
    padding: 0.75rem 1rem;
    border-radius: 8px;
    font-family: monospace;
    font-size: 1.1rem;
    margin-right: 0.5rem;
    display: inline-block;
}

.join-code-display {
    display: flex;
    align-items: center;
    margin: 1rem 0;
}

/* Info Card */
.info-card {
    background-color: var(--light);
    border-radius: 12px;
    padding: 1.5rem;
}

.info-card h3 {
    margin: 0 0 1rem;
    font-size: 1.1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.info-card p {
    margin: 0 0 1rem;
    font-size: 0.95rem;
}

.info-card small {
    color: var(--text-secondary);
}

/* Responsive Adjustments */
@media (max-width: 1024px) {
    .dashboard-row {
        grid-template-columns: 1fr;
    }
    
    .role-selector {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .club-sidebar {
        width: 220px;
        transform: translateX(-100%);
    }
    
    .club-content {
        margin-left: 0;
    }
    
    .club-dashboard-container.sidebar-expanded .club-sidebar {
        transform: translateX(0);
    }
    
    .horizontal-navbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .navbar-actions {
        width: 100%;
    }
    
    .form-row {
        flex-direction: column;
        gap: 1rem;
    }
}

@media (max-width: 480px) {
    .club-content {
        padding: 1rem;
    }
    
    .empty-actions {
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .dashboard-stats,
    .assignments-header,
    .members-header,
    .projects-header,
    .resources-header,
    .schedule-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .btn-primary,
    .btn-secondary,
    .btn-danger {
        width: 100%;
    }
    
    .modal-actions {
        flex-direction: column;
    }
}

/* Animation for section transitions */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.section-entrance {
    animation: fadeIn 0.5s ease;
}

</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Navigation between tabs
    const navLinks = document.querySelectorAll('.nav-link');
    const sections = document.querySelectorAll('.club-section');

    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();

            // Update active tab
            navLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');

            // Show corresponding section
            const sectionId = link.getAttribute('data-section');
            sections.forEach(section => {
                section.classList.remove('active');
                if (section.id === sectionId) {
                    section.classList.add('active');
                    section.classList.add('section-entrance');
                    setTimeout(() => {
                        section.classList.remove('section-entrance');
                    }, 500);
                }
            });

            // Update URL hash for direct linking
            window.location.hash = sectionId;
        });
    });

    // Check URL hash on page load
    const hash = window.location.hash.substring(1);
    if (hash) {
        const activeLink = document.querySelector(`.nav-link[data-section="${hash}"]`);
        if (activeLink) {
            activeLink.click();
        }
    }

    // Sidebar collapse functionality
    const sidebarCollapseBtn = document.getElementById('sidebarCollapseBtn');
    const container = document.querySelector('.club-dashboard-container');

    if (sidebarCollapseBtn) {
        sidebarCollapseBtn.addEventListener('click', () => {
            container.classList.toggle('sidebar-collapsed');
            
            // Update sidebar and content styles based on collapsed state
            const sidebar = document.querySelector('.club-sidebar');
            const content = document.querySelector('.club-content');
            
            if (container.classList.contains('sidebar-collapsed')) {
                sidebar.style.width = '80px';
                content.style.marginLeft = '80px';
                
                // Hide text in sidebar
                document.querySelectorAll('.nav-link span, .profile-info, .logout-link span').forEach(el => {
                    el.style.display = 'none';
                });
                
                // Rotate collapse button
                sidebarCollapseBtn.querySelector('i').style.transform = 'rotate(180deg)';
            } else {
                sidebar.style.width = '260px';
                content.style.marginLeft = '260px';
                
                // Show text in sidebar
                document.querySelectorAll('.nav-link span, .profile-info, .logout-link span').forEach(el => {
                    el.style.display = 'block';
                });
                
                // Reset collapse button
                sidebarCollapseBtn.querySelector('i').style.transform = 'rotate(0)';
            }
        });
    }

    // Toggle featured projects
    const toggleFeaturedBtn = document.getElementById('toggle-featured');
    if (toggleFeaturedBtn) {
        toggleFeaturedBtn.addEventListener('click', () => {
            const isShowingFeatured = toggleFeaturedBtn.innerText.includes('Show Featured Only');
            
            if (isShowingFeatured) {
                toggleFeaturedBtn.innerHTML = '<i class="fas fa-list"></i> Show All Projects';
                // Logic to filter projects would go here
            } else {
                toggleFeaturedBtn.innerHTML = '<i class="fas fa-star"></i> Show Featured Only';
                // Logic to show all projects would go here
            }
        });
    }

    // Calendar functionality
    // Meeting filter functionality
    const meetingFilter = document.getElementById('meetingFilter');
    if (meetingFilter) {
        meetingFilter.addEventListener('change', function() {
            const filterValue = this.value;
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            fetch(`/api/clubs/{{ club.id }}/meetings`)
            .then(response => response.json())
            .then(data => {
                let filteredMeetings = data.meetings || [];
                
                if (filterValue === 'upcoming') {
                    filteredMeetings = filteredMeetings.filter(meeting => {
                        const meetingDate = new Date(meeting.meeting_date);
                        return meetingDate >= today;
                    });
                } else if (filterValue === 'past') {
                    filteredMeetings = filteredMeetings.filter(meeting => {
                        const meetingDate = new Date(meeting.meeting_date);
                        return meetingDate < today;
                    });
                }
                
                displayMeetings(filteredMeetings);
            })
            .catch(error => {
                console.error('Error filtering meetings:', error);
            });
        });
    }
    
    // Function to view meeting details
    window.viewMeeting = function(meetingId) {
        try {
            fetch(`/api/clubs/{{ club.id }}/meetings/${meetingId}`)
            .then(response => {
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('Meeting not found');
                    } else {
                        throw new Error(`Server error: ${response.status}`);
                    }
                }
                
                // Check if response is JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error('Invalid response format');
                }
                
                return response.json();
            })
            .then(data => {
                if (data.meeting) {
                    const meeting = data.meeting;
                    const eventData = {
                        eventId: meeting.id,
                        eventTitle: meeting.title,
                        eventDate: meeting.meeting_date,
                        eventTime: `${meeting.start_time}${meeting.end_time ? ` - ${meeting.end_time}` : ''}`,
                        eventLocation: meeting.location || 'Not specified',
                        eventDescription: meeting.description || 'No description provided'
                    };
                    openEventModal(eventData);
                } else {
                    showToast('error', 'Meeting not found');
                }
            })
            .catch(error => {
                showToast('error', error.message || 'Error loading meeting details');
                console.error('Error:', error);
            });
        } catch (error) {
            console.error('Error in viewMeeting:', error);
            showToast('error', 'Failed to view meeting details');
        }
    };
    
    // Function to handle tab switching
    window.openTab = function(tabName) {
        const tabLink = document.querySelector(`.nav-link[data-section="${tabName}"]`);
        if (tabLink) {
            tabLink.click();
        }
    };
    
    // Toast notification system
    window.showToast = function(type, message, duration = 4000) {
        const toastContainer = document.getElementById('toast-container');
        if (!toastContainer) return;
        
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        
        // Select icon based on type
        let icon = '';
        switch (type) {
            case 'success': icon = '<i class="fas fa-check-circle"></i>'; break;
            case 'error': icon = '<i class="fas fa-exclamation-circle"></i>'; break;
            case 'warning': icon = '<i class="fas fa-exclamation-triangle"></i>'; break;
            case 'info': icon = '<i class="fas fa-info-circle"></i>'; break;
        }
        
        toast.innerHTML = `
            <div class="toast-content">
                ${icon}
                <span>${message}</span>
            </div>
            <button class="toast-close" onclick="this.parentElement.remove()">&times;</button>
        `;
        
        toastContainer.appendChild(toast);
        
        // Animate in
        setTimeout(() => {
            toast.style.transform = 'translateX(0)';
            toast.style.opacity = '1';
        }, 10);
        
        // Auto-remove after duration
        setTimeout(() => {
            toast.style.transform = 'translateX(100%)';
            toast.style.opacity = '0';
            setTimeout(() => {
                toast.remove();
            }, 300);
        }, duration);
    };
    
    // Modal functions
    window.openModal = function(modalId) {
        console.log('Opening modal:', modalId);
        const modal = document.getElementById(modalId);
        if (!modal) {
            console.error('Modal not found:', modalId);
            return;
        }
        
        // Force display to flex
        modal.style.display = 'flex';
        modal.classList.add('visible');
        
        // Use setTimeout to ensure the transition works
        setTimeout(() => {
            modal.style.opacity = '1';
            modal.style.visibility = 'visible';
            const modalContent = modal.querySelector('.modal-content');
            if (modalContent) {
                modalContent.style.transform = 'translateY(0)';
            }
        }, 10);
        
        document.body.style.overflow = 'hidden';
    };
    
    window.closeModal = function(modalId) {
        console.log('Closing modal:', modalId);
        const modal = document.getElementById(modalId);
        if (!modal) {
            console.error('Modal not found:', modalId);
            return;
        }
        
        // Animate the modal content out
        const modalContent = modal.querySelector('.modal-content');
        if (modalContent) {
            modalContent.style.transform = 'translateY(-20px)';
        }
        
        // Hide the modal
        modal.style.opacity = '0';
        modal.style.visibility = 'hidden';
        modal.classList.remove('visible');
        
        // After animation completes, set display to none
        setTimeout(() => {
            modal.style.display = 'none';
        }, 300);
        
        document.body.style.overflow = '';
    };
    
    // Create Club Modal functions
    window.openCreateClubModal = function() {
        openModal('createClubModal');
    };
    
    window.closeCreateClubModal = function() {
        closeModal('createClubModal');
        document.getElementById('createClubForm').reset();
    };
    
    // Join Club Modal functions
    window.openJoinClubModal = function() {
        openModal('joinClubModal');
    };
    
    window.closeJoinClubModal = function() {
        closeModal('joinClubModal');
        document.getElementById('joinCode').value = '';
    };
    
    // Edit Club Modal functions
    window.openEditClubModal = function() {
        // Populate form with current club data
        const clubName = document.getElementById('editClubName').value;
        const clubLocation = document.getElementById('editClubLocation').value;
        const clubDescription = document.getElementById('editClubDescription').value;
        
        document.getElementById('modalEditClubName').value = clubName;
        document.getElementById('modalEditClubLocation').value = clubLocation;
        document.getElementById('modalEditClubDescription').value = clubDescription;
        
        openModal('editClubModal');
    };
    
    window.closeEditClubModal = function() {
        closeModal('editClubModal');
    };
    
    window.updateClubFromModal = function() {
        // Transfer values from modal to form
        const modalName = document.getElementById('modalEditClubName').value;
        const modalLocation = document.getElementById('modalEditClubLocation').value;
        const modalDescription = document.getElementById('modalEditClubDescription').value;
        
        document.getElementById('editClubName').value = modalName;
        document.getElementById('editClubLocation').value = modalLocation;
        document.getElementById('editClubDescription').value = modalDescription;
        
        // Call the update function
        updateClub();
        
        // Close modal
        closeEditClubModal();
    };
    
    // Add Member Modal functions
    window.openAddMemberModal = function() {
        openModal('addMemberModal');
    };
    
    window.closeAddMemberModal = function() {
        closeModal('addMemberModal');
    };
    
    // Change Role Modal functions
    window.openChangeRoleModal = function(membershipId, username, currentRole) {
        document.getElementById('membershipIdForRole').value = membershipId;
        document.getElementById('roleUsername').textContent = username;
        
        // Set the current role radio button
        if (currentRole === 'member') {
            document.getElementById('roleMember').checked = true;
        } else if (currentRole === 'co-leader') {
            document.getElementById('roleLeader').checked = true;
        }
        
        openModal('changeRoleModal');
    };
    
    window.closeChangeRoleModal = function() {
        closeModal('changeRoleModal');
    };
    
    // Create Assignment Modal functions
    window.openCreateAssignmentModal = function() {
        openModal('createAssignmentModal');
    };
    
    window.closeCreateAssignmentModal = function() {
        closeModal('createAssignmentModal');
        document.getElementById('createAssignmentForm').reset();
    };
    
    // Add Resource Modal functions
    window.openAddResourceModal = function() {
        openModal('addResourceModal');
    };
    
    window.closeAddResourceModal = function() {
        closeModal('addResourceModal');
        document.getElementById('addResourceForm').reset();
    };
    
    // Create Channel Modal functions
    window.openCreateChannelModal = function() {
        openModal('createChannelModal');
    };
    
    window.closeCreateChannelModal = function() {
        closeModal('createChannelModal');
        document.getElementById('createChannelForm').reset();
    };
    
    // Create Meeting Modal functions
    window.openCreateMeetingModal = function() {
        openModal('createMeetingModal');
    };
    
    window.closeCreateMeetingModal = function() {
        closeModal('createMeetingModal');
        document.getElementById('createMeetingForm').reset();
    };
    
    // Example data functions (placeholders)
    window.createClub = function() {
        const clubName = document.getElementById('clubName').value;
        const clubLocation = document.getElementById('clubLocation').value;
        const clubDescription = document.getElementById('clubDescription').value;
        
        if (!clubName) {
            showToast('error', 'Please enter a club name');
            return;
        }
        
        // Simulate API call
        showToast('info', 'Creating club...');
        
        setTimeout(() => {
            showToast('success', 'Club created successfully!');
            closeCreateClubModal();
            // In a real app, we'd redirect or refresh
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        }, 1500);
    };
    
    window.joinClub = function() {
        const joinCode = document.getElementById('joinCode').value;
        
        if (!joinCode) {
            showToast('error', 'Please enter a join code');
            return;
        }
        
        // Simulate API call
        showToast('info', 'Joining club...');
        
        setTimeout(() => {
            showToast('success', 'Joined club successfully!');
            closeJoinClubModal();
            // In a real app, we'd redirect or refresh
            setTimeout(() => {
                window.location.reload();
            }, 1500);
        }, 1500);
    };
    
    window.updateClub = function() {
        const clubName = document.getElementById('editClubName').value;
        const clubLocation = document.getElementById('editClubLocation').value;
        const clubDescription = document.getElementById('editClubDescription').value;
        
        if (!clubName) {
            showToast('error', 'Please enter a club name');
            return;
        }
        
        // Simulate API call
        showToast('info', 'Updating club...');
        
        setTimeout(() => {
            showToast('success', 'Club updated successfully!');
            // In a real app, we'd update the UI
        }, 1500);
    };
    

    
    window.copyJoinCode = function() {
        const codeDisplay = document.getElementById('join-code-display');
        if (!codeDisplay) return;
        
        // Create temporary element
        const el = document.createElement('textarea');
        el.value = codeDisplay.textContent;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);
        
        showToast('success', 'Join code copied to clipboard!');
    };
    
    window.changeRole = function() {
        const membershipId = document.getElementById('membershipIdForRole').value;
        const username = document.getElementById('roleUsername').textContent;
        const newRole = document.querySelector('input[name="memberRole"]:checked').value;
        
        // Simulate API call
        showToast('info', `Changing role for ${username}...`);
        
        setTimeout(() => {
            showToast('success', `${username}'s role updated to ${newRole}`);
            closeChangeRoleModal();
            // In a real app, we'd update the UI
        }, 1500);
    };
    
    window.createAssignment = function() {
        const title = document.getElementById('assignmentTitle').value;
        const description = document.getElementById('assignmentDescription').value;
        const dueDate = document.getElementById('assignmentDueDate').value;
        
        if (!title || !description) {
            showToast('error', 'Please fill out all required fields');
            return;
        }
        
        showToast('info', 'Creating assignment...');
        
        const assignmentData = {
            title: title,
            description: description,
            due_date: dueDate || null
        };
        
        fetch(`/api/clubs/{{ club.id }}/assignments`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCsrfToken()
            },
            body: JSON.stringify(assignmentData)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            showToast('success', 'Assignment created successfully!');
            closeCreateAssignmentModal();
            loadAssignments(); // Refresh the assignments list
        })
        .catch(error => {
            console.error('Error creating assignment:', error);
            showToast('error', 'Failed to create assignment');
        });
    };
    
    window.addResource = function() {
        const title = document.getElementById('resourceTitle').value;
        const url = document.getElementById('resourceUrl').value;
        const description = document.getElementById('resourceDescription').value;
        
        if (!title || !url) {
            showToast('error', 'Please fill out all required fields');
            return;
        }
        
        showToast('info', 'Adding resource...');
        
        const resourceData = {
            title: title,
            url: url,
            description: description
        };
        
        fetch(`/api/clubs/{{ club.id }}/resources`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCsrfToken()
            },
            body: JSON.stringify(resourceData)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            showToast('success', 'Resource added successfully!');
            closeAddResourceModal();
            loadResources(); // Refresh the resources list
        })
        .catch(error => {
            console.error('Error adding resource:', error);
            showToast('error', 'Failed to add resource');
        });
    };
    
    window.createChannel = function() {
        const channelName = document.getElementById('channelName').value;
        
        if (!channelName) {
            showToast('error', 'Please enter a channel name');
            return;
        }
        
        // Simulate API call
        showToast('info', 'Creating channel...');
        
        setTimeout(() => {
            showToast('success', 'Channel created successfully!');
            closeCreateChannelModal();
            // In a real app, we'd update the UI
        }, 1500);
    };
    
    window.createMeeting = function() {
        const titleElement = document.getElementById('meetingTitle');
        const dateElement = document.getElementById('meetingDate');
        const startTimeElement = document.getElementById('startTime');
        const endTimeElement = document.getElementById('endTime');
        const locationElement = document.getElementById('meetingLocation');
        const linkElement = document.getElementById('meetingLink');
        const descriptionElement = document.getElementById('meetingDescription');
        
        if (!titleElement || !dateElement || !startTimeElement) {
            console.error('Meeting form elements not found');
            showToast('error', 'Form elements not found');
            return;
        }
        
        const title = titleElement.value;
        const date = dateElement.value;
        const startTime = startTimeElement.value;
        const endTime = endTimeElement ? endTimeElement.value : null;
        const location = locationElement ? locationElement.value : null;
        const link = linkElement ? linkElement.value : null;
        const description = descriptionElement ? descriptionElement.value : null;
        
        if (!title || !date || !startTime) {
            showToast('error', 'Please fill out all required fields');
            return;
        }
        
        showToast('info', 'Scheduling meeting...');
        
        const meetingData = {
            title: title,
            meeting_date: date,
            start_time: startTime,
            end_time: endTime || null,
            location: location || null,
            meeting_link: link || null,
            description: description || null
        };
        
        fetch(`/api/clubs/{{ club.id }}/meetings`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCsrfToken()
            },
            body: JSON.stringify(meetingData)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            showToast('success', 'Meeting scheduled successfully!');
            closeCreateMeetingModal();
            loadMeetings(); // Refresh the meetings list
        })
        .catch(error => {
            console.error('Error scheduling meeting:', error);
            showToast('error', 'Failed to schedule meeting');
        });
    };
    
    // Function to get CSRF token from cookies
    function getCsrfToken() {
        const name = 'csrftoken';
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    window.viewClub = function(clubId) {
        // In a real app, we'd navigate to the club page
        window.location.href = `/club-dashboard?club_id=${clubId}`;
    };
    

    
    // Initialize stats counters safely
    try {
        const projectCounter = document.getElementById('projectCount');
        const assignmentCounter = document.getElementById('assignmentCount');
        
        if (projectCounter) {
            projectCounter.textContent = Math.floor(Math.random() * 20) + 5;
        }
        
        if (assignmentCounter) {
            assignmentCounter.textContent = Math.floor(Math.random() * 10) + 1;
        }
    } catch (err) {
        console.log("Could not initialize counters");
    }
});
</script>

<!-- Event Details Modal -->
<div id="eventDetailsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="eventModalTitle">Event Title</h2>
            <span class="close" onclick="closeEventModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div class="event-details">
                <p><i class="fas fa-calendar"></i> <span id="eventDate">Date</span></p>
                <p><i class="fas fa-clock"></i> <span id="eventTime">Time</span></p>
                <p><i class="fas fa-map-marker-alt"></i> <span id="eventLocation">Location</span></p>
                <div class="event-description">
                    <h3>Description</h3>
                    <p id="eventDescription">Event description will appear here.</p>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeEventModal()">Close</button>
            <button class="btn-primary" onclick="editMeeting(currentEventId)">Edit</button>
        </div>
    </div>
</div>

<!-- Edit Meeting Modal -->
<div id="editMeetingModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Edit Meeting</h2>
            <span class="close" onclick="closeModal('editMeetingModal')">&times;</span>
        </div>
        <div class="modal-body">
            <form id="editMeetingForm" class="form-grid">
                <input type="hidden" id="editMeetingId">
                
                <div class="form-group">
                    <label for="editMeetingTitle">Title *</label>
                    <input type="text" id="editMeetingTitle" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="editMeetingDescription">Description</label>
                    <textarea id="editMeetingDescription" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="editMeetingDate">Date *</label>
                    <input type="date" id="editMeetingDate" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="editStartTime">Start Time *</label>
                    <input type="time" id="editStartTime" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="editEndTime">End Time</label>
                    <input type="time" id="editEndTime" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="editMeetingLocation">Location</label>
                    <input type="text" id="editMeetingLocation" class="form-control">
                </div>
                
                <div class="form-group">
                    <label for="editMeetingLink">Meeting Link</label>
                    <input type="url" id="editMeetingLink" class="form-control" placeholder="https://...">
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn-secondary" onclick="closeModal('editMeetingModal')">Cancel</button>
            <button class="btn-primary" onclick="updateMeeting()">Save Changes</button>
        </div>
    </div>
</div>
{% endblock %}

<script>
    // Helper function to check if current user is a club leader or co-leader
    function isClubLeaderOrCoLeader() {
        {% if current_user.id == club.leader_id or (club.members|selectattr('user_id', 'eq', current_user.id)|selectattr('role', 'eq', 'co-leader')|list|length > 0) %}
            return true;
        {% else %}
            return false;
        {% endif %}
    }
</script>