{% extends "base.html" %}

{% block body_class %}editor-page{% endblock %}

{% block head %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/eclipse.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/dialog/dialog.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/matchesonscrollbar.min.css">

<link rel="stylesheet" href="{{ url_for('static', filename='css/editor.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/github.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/hackatime-badge.css') }}">
{% endblock %}

{% block content %}
<div id="loading-overlay" class="loading-overlay">
    <div class="loading-content">
        <div class="loading-image-container">
            <img src="{{ url_for('static', filename='images/typingdino.gif') }}" alt="Loading..." class="loading-dino">
        </div>
        <div class="loading-text-container">
            <h2 class="loading-title">Building Your Space</h2>
            <p class="loading-text">Setting up your coding environment...</p>
        </div>
        <div class="loading-progress-container">
            <div class="loading-progress-bar">
                <div class="loading-progress-fill"></div>
            </div>
        </div>
    </div>
</div>
<div class="editor-container split-layout">
    <div class="editor-topbar">
        <div class="topbar-left">
            <a href="{{ url_for('welcome') }}" class="btn-icon" title="Back to Dashboard">
                <i class="fas fa-arrow-left"></i>
            </a>
            <h1>{{ site.name }}</h1>
        </div>
        <div class="topbar-actions">
            <button id="undoBtn" class="btn-icon" title="Undo (Ctrl+Z)" disabled>
                <i class="fas fa-undo"></i>
            </button>
            <button id="redoBtn" class="btn-icon" title="Redo (Ctrl+Y)" disabled>
                <i class="fas fa-redo"></i>
            </button>

            <div class="dropdown">
                <button class="btn-icon dropdown-toggle" title="Editor Settings">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-section">
                        <label for="themeSelector">Theme:</label>
                        <select id="themeSelector" onchange="changeEditorTheme(this.value)">
                            <option value="eclipse" selected>VS Code Light</option>
                            <option value="mdn-like">MDN-like</option>
                            <option value="solarized light">Solarized Light</option>
                        </select>
                    </div>
                    <div class="dropdown-section">
                        <label for="fontSizeSelector">Font Size:</label>
                        <select id="fontSizeSelector" onchange="changeEditorFontSize(this.value)">
                            <option value="12px">Small</option>
                            <option value="14px" selected>Medium</option>
                            <option value="16px">Large</option>
                            <option value="18px">X-Large</option>
                        </select>
                    </div>
                    <div class="dropdown-section checkbox">
                        <label>
                            <input type="checkbox" id="wordWrapToggle" checked onchange="toggleWordWrap(this.checked)">
                            Word Wrap
                        </label>
                    </div>
                    <div class="dropdown-section checkbox">
                        <label>
                            <input type="checkbox" id="lintToggle" onchange="toggleLinting(this.checked)">
                            Lint Code
                        </label>
                    </div>
                </div>
            </div>

            <button id="searchBtn" class="btn-icon" title="Search (Ctrl+F)" onclick="focusSearch()">
                <i class="fas fa-search"></i>
            </button>

            {% if site.site_type == 'web' %}
            <button id="tutorialBtn" class="btn-primary" onclick="openTutorialModal()" style="background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%);">
                <i class="fas fa-graduation-cap"></i>
                Tutorial
            </button>
            <button id="yswsBtn" class="btn-primary" onclick="openYSWSModal()">
                <i class="fa-solid fa-gift"></i>
                YSWS
            </button>
            <button id="analyticsBtn" class="btn-primary" onclick="openModal('analyticsModal')">
                <i class="fas fa-chart-line"></i>
                Analytics
            </button>
            <button id="orphyBtn" class="btn-primary" onclick="openOrphyChat()">
                <i class="fas fa-magic"></i>
                Orphy
            </button>
            {% elif site.site_type == 'python' %}
            <button id="runBtn" class="btn-primary" onclick="runCode()">
                <i class="fas fa-play"></i>
                Run
            </button>
            <button id="formatterBtn" class="btn-primary" onclick="formatCode()">
                <i class="fas fa-magic"></i>
                Format
            </button>
            {% endif %}

            <button id="saveBtn" class="btn-primary" onclick="saveContent()">
                <i class="fas fa-save"></i>
                Save Changes
            </button>

            <button id="gitBtn" class="btn-primary" onclick="GitHubManager.openModal()" style="background: linear-gradient(135deg, #fa8072 0%, #e57363 100%);">
                <i class="fab fa-github"></i>
                Git
            </button>
        </div>
    </div>
    <div class="editor-main">
        <div class="editor-pane">
            {% if site.site_type == 'web' %}
            <div class="file-tabs">
                <button class="file-tab active" data-filename="index.html" data-filetype="html">index.html</button>
                <button class="file-tab" data-filename="styles.css" data-filetype="css">styles.css</button>
                <button class="file-tab" data-filename="script.js" data-filetype="js">script.js</button>
                <button class="file-tab-add" title="Add new file" id="addFileBtn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div id="new-file-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Create New File</h2>
                        <button class="close-btn">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="newFilename">Filename (include extension):</label>
                            <input type="text" id="newFilename" placeholder="e.g., about.html, styles.css, script.js">
                        </div>
                    </div>
                    <div class="modal-actions">
                        <button class="btn-secondary" id="cancelNewFile">Cancel</button>
                        <button class="btn-primary" id="createNewFile">Create</button>
                    </div>
                </div>
            </div>
            {% endif %}
            <textarea id="editor">{{ site.html_content }}</textarea>
            <input type="hidden" id="site-slug" value="{{ site.slug }}">
            <input type="hidden" id="site-id" value="{{ site.id }}">
            <input type="hidden" id="site-type" value="{{ site.site_type }}">
            <div class="editor-statusbar">
                <div class="status-section">
                    <div class="status-item" id="cursorPosition">
                        <i class="fas fa-map-marker-alt"></i> Line 1, Column 1
                    </div>
                    <div class="status-item" id="fileSizeInfo">
                        <i class="fas fa-file-alt"></i> <span id="fileSize">0</span> bytes
                    </div>
                </div>
                <div class="status-section">
                    <div class="status-item" id="editorMode">
                        {{ site.site_type|upper }}
                    </div>
                    <div class="status-item" id="editorSettings">
                        <i class="fas fa-keyboard"></i>
                        <a href="#" onclick="showKeyboardShortcutsModal(); return false;">Shortcuts</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="preview-pane">
            {% if site.site_type == 'web' %}
            <div class="browser-frame">
                <div class="browser-header">
                    <div class="browser-address" style="display: flex; align-items: center; width: 100%;">
                        <div style="flex: 1"></div>
                        <div style="display: flex; align-items: center; position: absolute; left: 50%; transform: translateX(-50%); z-index: 10;">
                            <i class="fas fa-lock"></i>
                            <span class="browser-url">https://hackclub.space/s/{{ site.slug|default('', true) }}</span>
                            <button id="openDeployedSiteBtn" class="btn-icon" title="Open deployed site in new tab" onclick="openDeployedSite()" style="z-index: 10000;">
                                <i class="fas fa-external-link-alt"></i>
                            </button>
                        </div>
                        <div style="flex: 1; display: flex; justify-content: flex-end; gap: 8px; z-index: 2; position: relative;">
                            <button id="deployBtn" title="Deploy your site" onclick="deploySite()">
                                <i class="fas fa-rocket" style="color: white;"></i> Deploy
                            </button>
                            <button id="runBtn" title="Run your code" onclick="saveContent()" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); color: white; border: none; border-radius: 4px; padding: 5px 12px; font-weight: 500; cursor: pointer; transition: all 0.2s ease;">
                                <i class="fas fa-play" style="color: white;"></i> Run
                            </button>
                        </div>
                    </div>
                </div>
                <iframe id="preview" frameborder="0"></iframe>
            </div>
            {% elif site.site_type == 'python' %}
            <div class="console-frame">
                <div class="console-header">
                    <div class="console-title">
                        <i class="fas fa-terminal"></i>
                        Output Console
                    </div>
                </div>
                <pre id="output" class="console-output">Run your code to see the output here!</pre>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Toast container -->
<div id="toast-container"></div>

<script>
function showToast(type, message) {
    // Import the shared toast.js functionality
    if (window.showToast) {
        window.showToast(type, message);
    } else {
        const toastContainer = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;

        const icon = type === 'success' ? 'check-circle' : 
                     type === 'error' ? 'exclamation-circle' :
                     type === 'warning' ? 'exclamation-triangle' : 'info-circle';

        toast.innerHTML = `
            <div class="toast-content">
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            </div>
        `;

        toastContainer.appendChild(toast);

        // Force reflow
        toast.offsetHeight;

        // Show the toast
        toast.classList.add('show');

        // Automatically remove after 3 seconds
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }
}
</script>

<div id="githubModal" class="modal" style="display: none; opacity: 1; visibility: visible;">
    <div class="github-modal-content">
        <div class="github-modal-header">
            <h2><i class="fab fa-github"></i> GitHub Integration</h2>
            <button class="close-btn" onclick="GitHubManager.closeModal()">&times;</button>
        </div>
        <div class="github-modal-body" id="githubModalBody">
            <!-- Content will be dynamically loaded by GitHubManager -->
        </div>
    </div>
</div>

{% if site.site_type == 'web' %}
<div id="analyticsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Site Analytics</h2>
            <button class="close-btn" onclick="closeModal('analyticsModal')">&times;</button>
        </div>
        <div class="modal-body">
            <div class="analytics-summary">
                <div class="analytics-count">
                    <span>1234</span>
                    <label>Total Views</label>
                </div>
                <div class="analytics-actions">
                    <div class="analytics-toggle">
                        <label for="analytics-toggle">Enable Analytics:</label>
                        <label class="switch">
                            <input type="checkbox" id="analytics-toggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                    <button id="clearAnalyticsBtn" class="btn-danger">
                        <i class="fas fa-trash"></i>
                        Clear Analytics
                    </button>
                </div>
            </div>
            <div class="analytics-info">
                <p><i class="fas fa-info-circle"></i> View count shows total visits to your site.</p>
            </div>
        </div>
    </div>
</div>
{% endif %}

<div id="deployModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-rocket"></i> Deploy Your Site</h2>
            <button class="close-btn" onclick="closeDeployModal()">&times;</button>
        </div>
        <div class="modal-body">
            <p>Your site is available at the following URLs:</p>
            <div id="deployUrlsContainer">
                {% set siteSlug = site.slug %}
                {% set defaultDomain = 'hackclub.space' %}
                {% set domains = ['hackclub.space', 'imahacker.lol', 'myhack.club', 'hackclub.me'] %}

                {% for domain in domains %}
                    {% set url = 'https://' + domain + '/s/' + siteSlug %}
                    <div class="site-url">
                        <input type="text" value="{{ url }}" readonly>
                        <button onclick="navigator.clipboard.writeText('{{ url }}')" class="btn-copy">Copy</button>
                        <a href="{{ url }}" target="_blank" class="btn-icon" title="Open in new tab">
                            <i class="fas fa-external-link-alt"></i>
                        </a>
                    </div>
                {% endfor %}
            </div>
            <div class="modal-info">
                <p><strong>Note:</strong> Your default domain is <code>https://{{ defaultDomain }}/s/{{ siteSlug }}</code></p>
                {% if request.host == 'spaces.hackclub.com' %}
                    <p><strong>Warning:</strong> Public hosting is not available on spaces.hackclub.com domain</p>
                {% endif %}
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" onclick="closeDeployModal()">Close</button>
        </div>
    </div>
</div>


<script src="{{ url_for('static', filename='js/particles.min.js') }}"></script>

<div id="keyboardShortcutsModal" class="modal">
    <div class="modal-content shortcuts-modal">
        <div class="modal-header">
            <h2><i class="fas fa-keyboard"></i> Keyboard Shortcuts</h2>
            <button class="close-btn" onclick="closeKeyboardShortcutsModal()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="shortcuts-list">
                <div class="shortcut-category">
                    <h4>Editor</h4>
                    <div class="shortcut-item">
                        <span>Save</span>
                        <span class="shortcut-key">Ctrl+S</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Undo</span>
                        <span class="shortcut-key">Ctrl+Z</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Redo</span>
                        <span class="shortcut-key">Ctrl+Y</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Fold Code</span>
                        <span class="shortcut-key">Alt+F</span>
                    </div>
                </div>
                <div class="shortcut-category">
                    <h4>Search</h4>
                    <div class="shortcut-item">
                        <span>Find</span>
                        <span class="shortcut-key">Ctrl+F</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Find Next</span>
                        <span class="shortcut-key">Ctrl+G</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Find Previous</span>
                        <span class="shortcut-key">Shift+Ctrl+G</span>
                    </div>
                    <div class="shortcut-item">
                        <span>Replace</span>
                        <span class="shortcut-key">Ctrl+H</span>
                    </div>
                </div>
            </div>
            {% if site.site_type == 'python' %}
            <div class="shortcut-category">
                <h4>Python</h4>
                <div class="shortcut-item">
                    <span>Run Code</span>
                    <span class="shortcut-key">Ctrl+Enter</span>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>


<div id="orphy-widget" class="orphy-widget">
    <div class="orphy-container">
        <div class="orphy-header" id="orphy-header">
            <div class="orphy-title">
                <h2>Orphy <span class="orphy-emoji">🦖</span></h2>
            </div>
            <button class="orphy-close-btn" onclick="closeOrphyChat()">&times;</button>
        </div>
        <div class="orphy-chat">
            <div class="orphy-messages" id="orphyMessages"></div>
        </div>
        <div class="orphy-input">
            <textarea id="orphyInput" placeholder="Ask Orphy a question about your code..." rows="2"></textarea>
            <button class="orphy-send-btn" onclick="sendOrphyMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>
</div>

<!-- Include GitHub CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/github-buttons.css') }}">
<div id="tutorial-widget" style="display: none; position: fixed; width: 600px; max-width: 90%; height: auto; max-height: 80vh; background: white; border-radius: 12px; box-shadow: 0 5px 30px rgba(0, 0, 0, 0.2); z-index: 9999; opacity: 0; transition: opacity 0.3s ease; overflow: hidden;">
    <div class="orphy-header" style="background: linear-gradient(135deg, #4e54c8 0%, #8f94fb 100%); cursor: grab; border-radius: 12px 12px 0 0;">
        <div class="orphy-title">
            <h2>Personal Website Workshop <span class="orphy-emoji">📚</span></h2>
        </div>
        <button class="orphy-close-btn" onclick="closeTutorialModal()">&times;</button>
    </div>
    <div style="overflow-y: auto; max-height: 70vh; background-color: white; padding: 20px; border-radius: 0 0 12px 12px;">
        <div class="tutorial-navigation" style="display: flex; justify-content: center; margin-bottom: 20px;">
            <button id="prev-tutorial" onclick="prevTutorialStep()" class="tutorial-nav-btn tutorial-prev-btn" disabled>
                <i class="fas fa-arrow-left"></i> Previous
            </button>
            <div class="tutorial-step-counter">
                <span id="tutorial-step-indicator">1/10</span>
            </div>
            <button id="next-tutorial" onclick="nextTutorialStep()" class="tutorial-nav-btn tutorial-next-btn">
                Next <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <div class="tutorial-content">
            <div class="tutorial-step" data-step="1" style="display: block;">
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <img src="https://assets.hackclub.com/flag-standalone.svg" height="30" style="margin-right: 10px;">
                    <h3 style="color: #4e54c8; margin: 0;">Personal Website Workshop</h3>
                </div>
                
                <p><i>For a limited time: build your site & <a href="https://hack.club/boba" target="_blank">get a free bubble tea</a></i></p>
                
                <p>Prophet Orpheus, Hack Club's mascot, is here to guide you through making your own personal website!</p>
                
                <div style="margin: 15px 0; text-align: center;">
                    <img src="https://cloud-4zpw37atj-hack-club-bot.vercel.app/2dino_site.png" style="max-width: 100%; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);" alt="Example dinosaur website">
                </div>
                
                <p>This workshop will take about 45 minutes to complete. Let's get started!</p>
            </div>

            <div class="tutorial-step" data-step="2" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Part I: The HTML File</h3>
                <p>HTML stands for Hypertext Markup Language. Every website uses HTML to display content on the web.</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Basic HTML Structure:</h4>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;My First Website&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello World!&lt;/h1&gt;
    &lt;p&gt;This is my first web page.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
                </div>

                <p>This structure is common to all HTML pages. In fact, you can take a look for yourself! Right-click on any web page and select "View page source" to see what's going on behind the scenes.</p>
                
                <p><strong>Try it:</strong> Type this code into your index.html file in the editor to create a basic webpage, then click "Run" to see your page in action!</p>
            </div>

            <div class="tutorial-step" data-step="3" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Adding Content to Your HTML</h3>
                <p>Let's add more content to make your page interesting!</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Common HTML Elements:</h4>
                    <ul style="padding-left: 20px; line-height: 1.6;">
                        <li><strong>&lt;h1&gt; to &lt;h6&gt;</strong> - Headings (h1 is largest, h6 is smallest)</li>
                        <li><strong>&lt;p&gt;</strong> - Paragraph</li>
                        <li><strong>&lt;a&gt;</strong> - Links to other pages</li>
                        <li><strong>&lt;img&gt;</strong> - Images</li>
                        <li><strong>&lt;ul&gt; and &lt;ol&gt;</strong> - Unordered and ordered lists</li>
                        <li><strong>&lt;div&gt;</strong> - Container for grouping elements</li>
                    </ul>
                </div>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Let's add your name and description:</h4>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;My Personal Website&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Prophet Orpheus&lt;/h1&gt;
    &lt;p&gt;Coder Dino&lt;/p&gt;
    &lt;p&gt;Will code for food&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
                </div>
                
                <p><strong>Try it:</strong> Replace the text with your own name and description, then click "Save Changes" and "Run" to see your updates!</p>
            </div>

            <div class="tutorial-step" data-step="4" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Adding Images</h3>
                <p>Let's add an image to make your website more visual!</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">The Image Tag:</h4>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
&lt;img src="https://github.com/hackclub/dinosaurs/raw/main/smart_dinosaur_docs.png" /&gt;</pre>
                    <p>The <code>src</code> attribute specifies the URL where the image is located.</p>
                </div>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Adding it to your page:</h4>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;My Personal Website&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;img src="https://github.com/hackclub/dinosaurs/raw/main/smart_dinosaur_docs.png" /&gt;
    &lt;h1&gt;Prophet Orpheus&lt;/h1&gt;
    &lt;p&gt;Coder Dino&lt;/p&gt;
    &lt;p&gt;Will code for food&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
                </div>
                
                <div style="text-align: center; margin-top: 15px;">
                    <img src="https://cloud-1lgnmk5nw-hack-club-bot.vercel.app/2no_css.png" style="max-width: 80%; border-radius: 8px;" alt="Example of HTML without CSS">
                </div>
                
                <p><strong>Try it:</strong> Update your HTML with this image or find another image URL to use!</p>
            </div>

            <div class="tutorial-step" data-step="5" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Part II: Adding CSS</h3>
                <p>CSS (Cascading Style Sheets) is used to style your HTML elements and make your website look attractive.</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Creating a CSS File:</h4>
                    <p>In Hack Club Spaces, you can click on the "styles.css" tab in the editor to add your CSS. If you're starting from scratch, first you'll need to link your CSS file to your HTML.</p>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
&lt;!-- Add this inside the &lt;head&gt; section of your HTML --&gt;
&lt;link rel="stylesheet" href="styles.css" /&gt;</pre>
                </div>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Basic CSS:</h4>
                    <p>Now add the following to your styles.css file:</p>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
img {
  width: 200px;
}

body {
  text-align: center;
  font-family: 'Arial';
  background: azure;
  color: purple;
}</pre>
                </div>
                
                <p><strong>Try it:</strong> Click on the "styles.css" tab and add these styles, then save your changes and run your page to see the difference!</p>
            </div>

            <div class="tutorial-step" data-step="6" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Styling Your Page</h3>
                <p>Let's add more styles to make your site unique!</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Improved CSS:</h4>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
body {
  text-align: center;
  font-family: 'Arial', sans-serif;
  line-height: 1.5;
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
  background-color: #f0f8ff; /* azure */
  color: #663399; /* purple */
}

img {
  width: 200px;
  border-radius: 10px;
  box-shadow: 0 3px 15px rgba(0, 0, 0, 0.2);
  margin: 20px 0;
}

h1 {
  color: #ff6b6b;
  font-size: 2.5rem;
  margin-bottom: 10px;
}

p {
  font-size: 1.1rem;
  margin: 5px 0;
}</pre>
                </div>
                
                <p>This CSS adds:</p>
                <ul style="padding-left: 20px; line-height: 1.6;">
                    <li>Better spacing with line-height and margins</li>
                    <li>Maximum width and centered content</li>
                    <li>Rounded corners and shadow for the image</li>
                    <li>Different colors and font sizes</li>
                </ul>
                
                <p><strong>Try it:</strong> Update your CSS with these styles or experiment with your own colors and values!</p>
            </div>

            <div class="tutorial-step" data-step="7" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Adding More Content</h3>
                <p>Let's expand your website with more sections and content!</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Enhanced HTML Structure:</h4>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;My Personal Website&lt;/title&gt;
    &lt;link rel="stylesheet" href="styles.css" /&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;header&gt;
      &lt;img src="https://github.com/hackclub/dinosaurs/raw/main/smart_dinosaur_docs.png" alt="Profile picture" /&gt;
      &lt;h1&gt;Prophet Orpheus&lt;/h1&gt;
      &lt;p&gt;Coder Dino&lt;/p&gt;
    &lt;/header&gt;
    
    &lt;section class="about"&gt;
      &lt;h2&gt;About Me&lt;/h2&gt;
      &lt;p&gt;Hello! I'm a coding dinosaur who loves to build websites. When I'm not coding, I enjoy reading books and eating leaves.&lt;/p&gt;
    &lt;/section&gt;
    
    &lt;section class="skills"&gt;
      &lt;h2&gt;My Skills&lt;/h2&gt;
      &lt;ul&gt;
        &lt;li&gt;HTML & CSS&lt;/li&gt;
        &lt;li&gt;JavaScript&lt;/li&gt;
        &lt;li&gt;Python&lt;/li&gt;
        &lt;li&gt;Roaring&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/section&gt;
    
    &lt;section class="contact"&gt;
      &lt;h2&gt;Contact Me&lt;/h2&gt;
      &lt;p&gt;Email: &lt;a href="mailto:dino@example.com"&gt;dino@example.com&lt;/a&gt;&lt;/p&gt;
      &lt;p&gt;&lt;a href="https://github.com"&gt;GitHub&lt;/a&gt; | &lt;a href="https://twitter.com"&gt;Twitter&lt;/a&gt;&lt;/p&gt;
    &lt;/section&gt;
    
    &lt;footer&gt;
      &lt;p&gt;&copy; 2023 Prophet Orpheus. Made with Hack Club Spaces.&lt;/p&gt;
    &lt;/footer&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
                </div>
                
                <p>This HTML uses semantic tags like <code>&lt;header&gt;</code>, <code>&lt;section&gt;</code>, and <code>&lt;footer&gt;</code> to organize content better.</p>
                
                <p><strong>Try it:</strong> Update your HTML with this structure and customize it with your own information!</p>
            </div>

            <div class="tutorial-step" data-step="8" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Styling the New Sections</h3>
                <p>Let's style our new sections to look more organized and attractive!</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Extended CSS:</h4>
                    <pre style="background: #272822; color: #f8f8f2; padding: 10px; border-radius: 5px; overflow-x: auto;">
/* Add these styles to your existing CSS */
header {
  margin-bottom: 40px;
}

section {
  background-color: white;
  border-radius: 8px;
  padding: 20px;
  margin: 30px 0;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  text-align: left;
}

h2 {
  color: #4e54c8;
  border-bottom: 2px solid #8f94fb;
  padding-bottom: 5px;
}

ul {
  list-style-type: none;
  padding: 0;
}

ul li {
  padding: 5px 0;
  margin-left: 20px;
}

ul li:before {
  content: "✓ ";
  color: #4e54c8;
}

footer {
  margin-top: 40px;
  padding: 20px;
  font-size: 0.9rem;
  color: #666;
  border-top: 1px solid #ddd;
}

a {
  color: #4e54c8;
  text-decoration: none;
  transition: color 0.2s;
}

a:hover {
  color: #ff6b6b;
  text-decoration: underline;
}</pre>
                </div>
                
                <p><strong>Try it:</strong> Add these styles to your CSS file to make your sections look more polished and professional!</p>
            </div>

            <div class="tutorial-step" data-step="9" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Part III: Connecting GitHub</h3>
                <p>Before publishing your site, you'll need to connect it to GitHub. This is <strong>required</strong> for YSWS applications (Boba Drops and Swirl)!</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Why GitHub is Important:</h4>
                    <ul style="padding-left: 20px; line-height: 1.6;">
                        <li>Tracks your code changes and history</li>
                        <li>Required for YSWS applications (Boba Drops & Swirl)</li>
                        <li>Industry-standard tool used by professional developers</li>
                        <li>Makes collaboration with others possible</li>
                    </ul>
                </div>
                
                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Connecting to GitHub:</h4>
                    <ol style="padding-left: 20px; line-height: 1.6;">
                        <li>Click the <strong>"Git"</strong> button in the editor toolbar</li>
                        <li>Click <strong>"Link GitHub Account"</strong> and authorize Hack Club Spaces</li>
                        <li>After connecting, you'll need to create a repository:
                            <ul style="padding-left: 20px; margin-top: 5px;">
                                <li>Enter a name for your repository (e.g., "my-personal-website")</li>
                                <li>Optionally add a description</li>
                                <li>Choose whether it should be public or private</li>
                                <li>Click <strong>"Create Repository"</strong></li>
                            </ul>
                        </li>
                        <li>Your site will automatically push its initial files to GitHub</li>
                    </ol>
                </div>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Pushing Changes:</h4>
                    <ol style="padding-left: 20px; line-height: 1.6;">
                        <li>After making changes to your site, click the <strong>"Git"</strong> button again</li>
                        <li>Enter a message describing your changes (e.g., "Update homepage design")</li>
                        <li>Click <strong>"Push Changes"</strong> to update your GitHub repository</li>
                        <li>Make sure to push your latest changes before applying for YSWS!</li>
                    </ol>
                </div>
                
                <div style="margin: 15px 0; text-align: center;">
                    <img src="https://cloud-4zpw37atj-hack-club-bot.vercel.app/0github_tutorial.png" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" alt="GitHub integration screenshot">
                </div>
                
                <p><strong>Remember:</strong> Both Boba Drops and Swirl require your code to be on GitHub. The reviewers will check your repository to verify your work!</p>
            </div>

            <div class="tutorial-step" data-step="10" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Part IV: Publishing Your Site</h3>
                <p>Now that you've created your website and connected GitHub, it's time to share it with the world!</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Deploying with Hack Club Spaces:</h4>
                    <ol style="padding-left: 20px; line-height: 1.6;">
                        <li>Make sure you've saved all your changes</li>
                        <li>Click the "Deploy" button in the browser toolbar above the preview</li>
                        <li>Your site will be available at the URL shown in the deploy modal</li>
                    </ol>
                </div>
                
                <div style="margin: 15px 0; text-align: center;">
                    <img src="https://cloud-4zpw37atj-hack-club-bot.vercel.app/1celebrate_rush_hour.gif" style="max-width: 100%; border-radius: 8px;" alt="Celebration GIF">
                </div>
                
                <p><strong>Remember:</strong> Every time you make changes to your site, you'll need to save and deploy again to update your live site.</p>
                
                <p><i>For a limited time: <a href="https://hack.club/boba" target="_blank">get a free bubble tea</a> after your site deploys!</i></p>
            </div>

            <div class="tutorial-step" data-step="11" style="display: none;">
                <h3 style="color: #4e54c8; margin-top: 0;">Next Steps & Resources</h3>
                <p>Congratulations on creating your personal website! Here are some ways to take it further:</p>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Ideas for Improvement:</h4>
                    <ul style="padding-left: 20px; line-height: 1.6;">
                        <li>Add a dark/light mode toggle using JavaScript</li>
                        <li>Create a photo gallery or portfolio section</li>
                        <li>Add animations to make elements fade in as you scroll</li>
                        <li>Make your site responsive for mobile devices</li>
                        <li>Add a contact form or blog section</li>
                    </ul>
                </div>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Helpful Resources:</h4>
                    <ul style="padding-left: 20px; line-height: 1.6;">
                        <li><a href="https://www.w3schools.com/" target="_blank">W3Schools</a> - Comprehensive tutorials and references</li>
                        <li><a href="https://developer.mozilla.org/en-US/" target="_blank">MDN Web Docs</a> - Detailed documentation for web technologies</li>
                        <li><a href="https://css-tricks.com/" target="_blank">CSS-Tricks</a> - Tips and tricks for CSS</li>
                        <li><a href="https://hackclub.com/" target="_blank">Hack Club</a> - Community and resources for young developers</li>
                    </ul>
                </div>

                <div style="margin: 15px 0; background: #f8f9fa; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <h4 style="margin-top: 0;">Example Websites for Inspiration:</h4>
                    <p>Check out these websites made by other Hack Club members:</p>
                    <ul style="padding-left: 20px; line-height: 1.6;">
                        <li><a href="https://cytronicoder.com/" target="_blank">Zeyu (Peter) Yao</a></li>
                        <li><a href="https://kognise.dev/" target="_blank">Kognise</a></li>
                        <li><a href="https://sarthakmohanty.me/" target="_blank">Sarthak Mohanty</a></li>
                        <li><a href="https://sampoder.com/" target="_blank">Sam Poder</a></li>
                    </ul>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button onclick="openYSWSModal()" class="btn-primary" style="display: inline-block; padding: 10px 20px; background: linear-gradient(135deg, #ff6b6b 0%, #8c52ff 100%);">
                        <i class="fa-solid fa-gift"></i> Apply for YSWS
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="ysws-widget">
    <div class="orphy-header" style="background: linear-gradient(135deg, #ff6b6b 0%, #8c52ff 100%); cursor: grab; border-radius: 12px 12px 0 0;">
        <div class="orphy-title">
            <h2>You Ship, We Ship <span class="orphy-emoji">🎁</span></h2>
        </div>
        <button class="orphy-close-btn" onclick="closeYSWSModal()">&times;</button>
    </div>
    <div style="overflow-y: auto; max-height: 70vh; background-color: white; padding: 20px; border-radius: 0 0 12px 12px;">
        <div class="ysws-section" style="margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #ff6b6b;">
            <h3 style="color: #ff6b6b; margin-top: 0;"><i class="fa-solid fa-mug-hot"></i> Boba Drops</h3>
            <p style="font-size: 16px; line-height: 1.5;">Ship a website, get $5 for Boba!</p>

            <div style="margin: 15px 0; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <h4 style="margin-top: 0;">Requirements:</h4>
                <ul style="padding-left: 20px; line-height: 1.6;">
                    <li>You're a high schooler (or younger)</li>
                    <li>The website was made recently</li>
                    <li>Your website is a static site (uses HTML + CSS)</li>
                    <li>Your website has text, color and an image</li>
                    <li>You haven't gotten Boba Drops before</li>
                    <li>You are in the USA!</li>
                </ul>
            </div>

            <button id="bobaApplyBtn" onclick="checkGitHubAndApplyForBoba()" class="btn-primary" style="display: inline-block; margin-top: 15px; text-decoration: none; padding: 10px 20px; background: linear-gradient(135deg, #ff6b6b 0%, #ff8e8e 100%); color: white; border-radius: 8px; font-weight: bold; transition: all 0.2s ease; border: none; cursor: pointer;">
                <i class="fas fa-external-link-alt"></i> Apply for Boba Drops
            </button>
        </div>

        <div class="ysws-section" style="margin-bottom: 30px; background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #8c52ff;">
            <h3 style="color: #8c52ff; margin-top: 0;"><i class="fa-solid fa-ice-cream"></i> Swirl</h3>
            <p style="font-size: 16px; line-height: 1.5;">Build a website, Get free ice cream!</p>

            <div style="margin: 15px 0; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <h4 style="margin-top: 0;">Requirements:</h4>
                <ul style="padding-left: 20px; line-height: 1.6;">
                    <li>You're a high schooler (or younger)</li>
                    <li>The website was made recently</li>
                    <li>Your website is a static site (uses HTML + CSS)</li>
                    <li>Your website has text, color, and an image</li>
                    <li>Your website includes: 3 html pages, a favicon, at least 5 html tags</li>
                    <li>Your website contains at least one scoop</li>
                    <li>You haven't gotten a Swirl Grant before</li>
                    <li>If your website was submitted for Boba Drops, it has been expanded</li>
                    <li>Your website is original (NO AI or copy-pasting from ANYWHERE)</li>
                </ul>
            </div>

            <button id="swirlApplyBtn" onclick="checkGitHubAndApplyForSwirl()" class="btn-primary" style="display: inline-block; margin-top: 15px; text-decoration: none; padding: 10px 20px; background: linear-gradient(135deg, #8c52ff 0%, #a56fff 100%); color: white; border-radius: 8px; font-weight: bold; transition: all 0.2s ease; border: none; cursor: pointer;">
                <i class="fas fa-external-link-alt"></i> Apply for Swirl
            </button>
        </div>

        <div style="text-align: center; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 12px;">
            <h4 style="margin-top: 0; color: #ff9d00;"><i class="fas fa-lightbulb"></i> Quick Tip</h4>
            <p>Remember to save and deploy your site before applying. Good luck!</p>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closetag.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchtags.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/show-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/javascript-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/css-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/html-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/anyword-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/xml-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/search.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/dialog/dialog.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/matchesonscrollbar.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/scroll/annotatescrollbar.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/selection/active-line.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/match-highlighter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/xml-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/comment-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/lint/lint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/comment/comment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/display/placeholder.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/scroll/simplescrollbars.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/vscode-dark.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/match-highlighter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/jump-to-line.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/tern/tern.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/comment/comment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/selection/active-line.min.js"></script>

{% if site.site_type == 'web' %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closetag.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchtags.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/xml-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/html-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/brace-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/xml-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/comment-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/comment/comment.min.js"></script>
<script src="{{ url_for('static', filename='js/github.js') }}"></script>
{% elif site.site_type == 'python' %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/hint/python-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/foldgutter.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/indent-fold.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/fold/comment-fold.min.js"></script>
<script src="{{ url_for('static', filename='js/github.js') }}"></script>
{% endif %}

<script src="{{ url_for('static', filename='js/editor-core.js') }}"></script>
<script src="{{ url_for('static', filename='js/ui-utils.js') }}"></script>
<script src="{{ url_for('static', filename='js/orphy.js') }}"></script>
<script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
<script src="{{ url_for('static', filename='js/file-handling.js') }}"></script>
{% if current_user.wakatime_api_key %}
<script src="{{ url_for('static', filename='js/hackatime-tracker.js') }}"></script>
{% endif %}

<script>
// Make these functions globally available
window.openYSWSModal = function() {
    const widget = document.getElementById('ysws-widget');
    widget.style.display = 'block';

    // Center the modal initially
    const windowHeight = window.innerHeight;
    const windowWidth = window.innerWidth;
    const modalWidth = 500; // Fixed width
    const modalHeight = 600; // Approximate height

    widget.style.left = (windowWidth / 2 - modalWidth / 2) + 'px';
    widget.style.top = (windowHeight / 2 - modalHeight / 2) + 'px';
    widget.style.transform = 'none';

    setTimeout(() => {
        widget.style.opacity = '1';
    }, 50);

    const dragHandle = widget.querySelector('.orphy-header');
    window.makeDraggable(widget, dragHandle);
};

window.openTutorialModal = function() {
    const widget = document.getElementById('tutorial-widget');
    widget.style.display = 'block';

    // Center the modal initially
    const windowHeight = window.innerHeight;
    const windowWidth = window.innerWidth;
    const modalWidth = 600; // Fixed width
    const modalHeight = 600; // Approximate height

    widget.style.left = (windowWidth / 2 - modalWidth / 2) + 'px';
    widget.style.top = (windowHeight / 2 - modalHeight / 2) + 'px';
    widget.style.transform = 'none';

    setTimeout(() => {
        widget.style.opacity = '1';
    }, 50);

    const dragHandle = widget.querySelector('.orphy-header');
    window.makeDraggable(widget, dragHandle);

    // Reset to first step
    currentTutorialStep = 1;
    updateTutorialStep();
};

window.closeTutorialModal = function() {
    const widget = document.getElementById('tutorial-widget');
    widget.style.opacity = '0';
    setTimeout(() => {
        widget.style.display = 'none';
    }, 300);
};

let currentTutorialStep = 1;
const totalTutorialSteps = 11;

window.nextTutorialStep = function() {
    if (currentTutorialStep < totalTutorialSteps) {
        currentTutorialStep++;
        updateTutorialStep();
    }
};

window.prevTutorialStep = function() {
    if (currentTutorialStep > 1) {
        currentTutorialStep--;
        updateTutorialStep();
    }
};

function updateTutorialStep() {
    // Update step indicator
    document.getElementById('tutorial-step-indicator').textContent = `${currentTutorialStep}/${totalTutorialSteps}`;

    // Enable/disable navigation buttons
    document.getElementById('prev-tutorial').disabled = (currentTutorialStep === 1);
    document.getElementById('next-tutorial').disabled = (currentTutorialStep === totalTutorialSteps);

    // Show current step, hide others
    document.querySelectorAll('.tutorial-step').forEach(step => {
        const stepNum = parseInt(step.getAttribute('data-step'));
        step.style.display = (stepNum === currentTutorialStep) ? 'block' : 'none';
    });
}

window.closeYSWSModal = function() {
    const widget = document.getElementById('ysws-widget');
    widget.style.opacity = '0';
    setTimeout(() => {
        widget.style.display = 'none';
    }, 300);
};

window.makeDraggable = function(element, dragHandle) {
    let offsetX = 0, offsetY = 0;
    let isDragging = false;

    const startDrag = function(e) {
        isDragging = true;
        const rect = element.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
        dragHandle.style.cursor = 'grabbing';
        e.preventDefault();
    };

    const moveDrag = function(e) {
        if (!isDragging) return;

        const x = e.clientX - offsetX;
        const y = e.clientY - offsetY;

        // Set boundaries to keep the modal within viewport
        const maxX = window.innerWidth - element.offsetWidth;
        const maxY = window.innerHeight - element.offsetHeight;

        element.style.left = Math.min(Math.max(0, x), maxX) + 'px';
        element.style.top = Math.min(Math.max(0, y), maxY) + 'px';
        element.style.transform = 'none';
        e.preventDefault();
    };

    const endDrag = function() {
        isDragging = false;
        dragHandle.style.cursor = 'grab';
    };

    dragHandle.addEventListener('mousedown', startDrag);
    document.addEventListener('mousemove', moveDrag);
    document.addEventListener('mouseup', endDrag);
};

// Function to check GitHub connection and open GitHub modal for Boba Drops
function checkGitHubAndApplyForBoba() {
    const bobaBtn = document.getElementById('bobaApplyBtn');
    
    // Disable the button temporarily
    bobaBtn.disabled = true;
    bobaBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking GitHub connection...';
    
    // Get the site ID
    const siteId = document.getElementById('site-id').value || sessionStorage.getItem('current_site_id');
    
    if (!siteId) {
        showToast('error', 'Could not determine site ID. Please refresh the page.');
        bobaBtn.disabled = false;
        bobaBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> Apply for Boba Drops';
        return;
    }
    
    // Check if GitHub is connected
    fetch(`/api/github/status?site_id=${siteId}`)
        .then(response => response.json())
        .then(data => {
            if (!data.connected) {
                showToast('error', 'Please connect your GitHub account first!');
                bobaBtn.disabled = false;
                bobaBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> Connect GitHub First';
                
                // Open GitHub modal to help user connect
                setTimeout(() => {
                    GitHubManager.openModal();
                }, 1000);
                return;
            }
            
            if (!data.repo_connected) {
                showToast('error', 'Please create or connect a GitHub repository first!');
                bobaBtn.disabled = false;
                bobaBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> Create Repository First';
                
                // Open GitHub modal to help user create repo
                setTimeout(() => {
                    GitHubManager.openModal();
                }, 1000);
                return;
            }
            
            // If we get here, GitHub is connected and repo exists
            // Show a toast message prompting to push changes first
            showToast('info', 'Remember to push your latest changes before applying!');
            
            // Open the GitHub modal for the user to manually push changes
            GitHubManager.openModal();
            
            // Set a message that appears in the commit message box
            const commitMsgElement = document.getElementById('commitMessage');
            if (commitMsgElement) {
                commitMsgElement.value = 'Update before Boba Drops application';
            }
            
            // Create a new toast with application link
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast toast-success';
            toast.innerHTML = `
                <div class="toast-content">
                    <i class="fas fa-info-circle"></i>
                    <span>
                        After pushing your changes, 
                        <a href="https://forms.hackclub.com/t/tLf8GYVBqSus" target="_blank" 
                           style="color: #333333; text-decoration: underline; font-weight: bold;">
                           click here to apply for Boba Drops
                        </a>
                    </span>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            toast.offsetHeight; // Force reflow
            toast.classList.add('show');
            
            // Reset the button
            bobaBtn.disabled = false;
            bobaBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> Apply for Boba Drops';
        })
        .catch(error => {
            showToast('error', 'Error checking GitHub status: ' + error.message);
            bobaBtn.disabled = false;
            bobaBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> Apply for Boba Drops';
        });
}

// Function to check GitHub connection and open GitHub modal for Swirl
function checkGitHubAndApplyForSwirl() {
    const swirlBtn = document.getElementById('swirlApplyBtn');
    
    // Disable the button temporarily
    swirlBtn.disabled = true;
    swirlBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking GitHub connection...';
    
    // Get the site ID
    const siteId = document.getElementById('site-id').value || sessionStorage.getItem('current_site_id');
    
    if (!siteId) {
        showToast('error', 'Could not determine site ID. Please refresh the page.');
        swirlBtn.disabled = false;
        swirlBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> Apply for Swirl';
        return;
    }
    
    // Check if GitHub is connected
    fetch(`/api/github/status?site_id=${siteId}`)
        .then(response => response.json())
        .then(data => {
            if (!data.connected) {
                showToast('error', 'Please connect your GitHub account first!');
                swirlBtn.disabled = false;
                swirlBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> Connect GitHub First';
                
                // Open GitHub modal to help user connect
                setTimeout(() => {
                    GitHubManager.openModal();
                }, 1000);
                return;
            }
            
            if (!data.repo_connected) {
                showToast('error', 'Please create or connect a GitHub repository first!');
                swirlBtn.disabled = false;
                swirlBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> Create Repository First';
                
                // Open GitHub modal to help user create repo
                setTimeout(() => {
                    GitHubManager.openModal();
                }, 1000);
                return;
            }
            
            // If we get here, GitHub is connected and repo exists
            // Show a toast message prompting to push changes first
            showToast('info', 'Remember to push your latest changes before applying!');
            
            // Open the GitHub modal for the user to manually push changes
            GitHubManager.openModal();
            
            // Set a message that appears in the commit message box
            const commitMsgElement = document.getElementById('commitMessage');
            if (commitMsgElement) {
                commitMsgElement.value = 'Update before Swirl application';
            }
            
            // Create a new toast with application link
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast toast-success';
            toast.innerHTML = `
                <div class="toast-content">
                    <i class="fas fa-info-circle"></i>
                    <span>
                        After pushing your changes, 
                        <a href="https://forms.hackclub.com/t/t1UL6ZK4Nyus" target="_blank" 
                           style="color: #333333; text-decoration: underline; font-weight: bold;">
                           click here to apply for Swirl
                        </a>
                    </span>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            toast.offsetHeight; // Force reflow
            toast.classList.add('show');
            
            // Reset the button
            swirlBtn.disabled = false;
            swirlBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> Apply for Swirl';
        })
        .catch(error => {
            showToast('error', 'Error checking GitHub status: ' + error.message);
            swirlBtn.disabled = false;
            swirlBtn.innerHTML = '<i class="fas fa-external-link-alt"></i> Apply for Swirl';
        });
}

// Initialize the modals when the document is ready
document.addEventListener('DOMContentLoaded', function() {
    // Initialize YSWS widget
    const yswsWidget = document.getElementById('ysws-widget');
    if (yswsWidget) {
        const yswsDragHandle = yswsWidget.querySelector('.orphy-header');
        if (yswsDragHandle) {
            window.makeDraggable(yswsWidget, yswsDragHandle);
        }
    }
    
    // Initialize tutorial widget
    const tutorialWidget = document.getElementById('tutorial-widget');
    if (tutorialWidget) {
        const tutorialDragHandle = tutorialWidget.querySelector('.orphy-header');
        if (tutorialDragHandle) {
            window.makeDraggable(tutorialWidget, tutorialDragHandle);
        }
    }
});
</script>

{% if additional_scripts %}
{{ additional_scripts|safe }}
{% endif %}
{% endblock %}